<!DOCTYPE html>
<html>
<head>
    <title>MCHP_PWM_HighSpeed_Override - MCHP Blockset</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../../assets/css/navigation.css">
    <script src="../../assets/js/navigation.js"></script>
</head>
<body>
    <!-- Mobile Navigation Toggle -->
    <button class="nav-toggle" aria-label="Toggle navigation">☰</button>

    <!-- Left Navigation Panel -->
    <nav class="doc-nav-container">
        <div class="doc-nav-header">
            <a href="../../index.html">MCHP Blockset Docs</a>
        </div>
        <ul class="doc-nav-menu">
            <li class="nav-item">
                <a href="../../index.html" class="nav-link">Home</a>
            </li>

            <!-- Getting Started Section -->
            <li class="nav-item">
                <div class="nav-category">Getting Started <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../getting_started/overview.html" class="nav-link">Overview</a></li>
                    <li><a href="../../getting_started/installation.html" class="nav-link">Installation</a></li>
                    <li><a href="../../getting_started/quick_start.html" class="nav-link">Quick Start</a></li>
                    <li><a href="../../getting_started/board_templates.html" class="nav-link">Board Templates</a></li>
                    <li><a href="../../getting_started/supported_devices.html" class="nav-link">Supported Devices</a></li>
                </ul>
            </li>

            <!-- User Guide Section -->
            <li class="nav-item">
                <div class="nav-category">User Guide <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../user_guide/index.html" class="nav-link">User Guide Overview</a></li>
                    <li><a href="../../user_guide/code_generation.html" class="nav-link">Code Generation</a></li>
                    <li><a href="../../user_guide/external_mode.html" class="nav-link">External Mode</a></li>
                </ul>
            </li>

            <!-- Block Reference Section -->
            <li class="nav-item">
                <div class="nav-category">Block Reference <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../block_reference/index.html" class="nav-link">Block Reference Overview</a></li>
                </ul>
            </li>

            <!-- Examples Section -->
            <li class="nav-item">
                <div class="nav-category">Examples <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../examples/field_weakening.html" class="nav-link">Field Weakening</a></li>
                </ul>
            </li>

            <!-- Release Notes -->
            <li class="nav-item">
                <a href="../../release_notes.html" class="nav-link">Release Notes</a>
            </li>
        </ul>
    </nav>

    <div class="doc-content-wrapper">
    <h1>MCHP_PWM_HighSpeed_Override - PWM Override Control Block</h1>

    
    <!-- Block Icon -->
    <div class="block-image">
        <img src="../assets/images/blocks/pwm/PWM_HS_Override.svg"
             alt="PWM_HS_Override Block Icon"
             onerror="this.onerror=null; this.src='../assets/images/blocks/pwm/PWM_HS_Override.png';">
        <div class="block-image-caption">
            PWM_HS_Override Block Icon
        </div>
    </div>
<h2>Block Description</h2>
    <p>The MCHP_PWM_HighSpeed_Override block provides direct control over PWM outputs, bypassing the normal PWM generator logic. This block allows manual control of PWM pin states for diagnostic purposes, safe state entry, or custom switching patterns.</p>

    <p>The override block works in conjunction with the <strong>MCHP_PWM_HighSpeed</strong> block and can force PWM outputs to specific logic levels regardless of the PWM generator state.</p>

    <div class="important">
        <strong>Important:</strong> Override control should be used with extreme caution in motor control applications, as improper use can cause hardware damage or create hazardous conditions.
    </div>

    <h2>Supported Device Families</h2>
    <p>This block supports the same device families as MCHP_PWM_HighSpeed:</p>
    <ul>
        <li><strong>dsPIC33F (selected)</strong> - with high-speed PWM module</li>
        <li><strong>dsPIC33EP (GS)</strong> - with auxiliary clock support</li>
        <li><strong>dsPIC33C/CH/CK</strong> - full-featured implementations</li>
    </ul>

    <h2>Key Features</h2>
    <ul>
        <li>Direct control of PWM output pins (PWMxH and PWMxL)</li>
        <li>Individual or grouped override control</li>
        <li>Override enable/disable per channel</li>
        <li>Synchronization with PWM generator (optional)</li>
        <li>Support for safe state configuration</li>
        <li>Runtime override value modification</li>
    </ul>

    <h2>Configuration Parameters</h2>

    <h3>Override Channel Selection</h3>
    <table>
        <tr>
            <th>Parameter</th>
            <th>Description</th>
            <th>Values</th>
        </tr>
        <tr>
            <td><code>OverrideChannels</code></td>
            <td>Select which PWM channels are controlled by override</td>
            <td>Vector of channel numbers [1 2 3 ...]</td>
        </tr>
        <tr>
            <td><code>OverrideMode</code></td>
            <td>Override application mode</td>
            <td>
                • Individual (per channel control)<br>
                • Grouped (all selected channels together)
            </td>
        </tr>
    </table>

    <h3>Override State Configuration</h3>
    <table>
        <tr>
            <th>Parameter</th>
            <th>Description</th>
            <th>Values</th>
        </tr>
        <tr>
            <td><code>DefaultState_H</code></td>
            <td>Default state for high-side outputs when override active</td>
            <td>0 (Low), 1 (High)</td>
        </tr>
        <tr>
            <td><code>DefaultState_L</code></td>
            <td>Default state for low-side outputs when override active</td>
            <td>0 (Low), 1 (High)</td>
        </tr>
        <tr>
            <td><code>SyncMode</code></td>
            <td>Synchronization with PWM timebase</td>
            <td>
                • Immediate (override applied immediately)<br>
                • Synchronized (applied at PWM period boundary)
            </td>
        </tr>
    </table>

    <h2>Block Inputs</h2>

    <h3>Individual Override Mode</h3>
    <table>
        <tr>
            <th>Input</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
        <tr>
            <td><code>Override_En 1..N</code></td>
            <td>boolean</td>
            <td>Enable override for channel N (1=override active, 0=normal PWM)</td>
        </tr>
        <tr>
            <td><code>Override_H 1..N</code></td>
            <td>boolean</td>
            <td>High-side output state when override enabled for channel N</td>
        </tr>
        <tr>
            <td><code>Override_L 1..N</code></td>
            <td>boolean</td>
            <td>Low-side output state when override enabled for channel N</td>
        </tr>
    </table>

    <h3>Grouped Override Mode</h3>
    <table>
        <tr>
            <th>Input</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
        <tr>
            <td><code>Override_En</code></td>
            <td>boolean</td>
            <td>Enable override for all selected channels</td>
        </tr>
        <tr>
            <td><code>Override_Value</code></td>
            <td>uint16</td>
            <td>Bitfield: override state for all channels<br>
                Bit 0: PWM1H, Bit 1: PWM1L, Bit 2: PWM2H, etc.</td>
        </tr>
    </table>

    <h2>Block Outputs</h2>
    <table>
        <tr>
            <th>Output</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
        <tr>
            <td><code>Override_Status</code></td>
            <td>uint16</td>
            <td>Current override register value (IOCONx.OVRDAT bits)</td>
        </tr>
        <tr>
            <td><code>Override_Active</code></td>
            <td>boolean</td>
            <td>Indicates if any override is currently active</td>
        </tr>
    </table>

    <h2>Implementation Details</h2>

    <h3>Hardware Registers</h3>
    <p>The override block configures the following registers:</p>

    <table>
        <tr>
            <th>Register</th>
            <th>Bits</th>
            <th>Purpose</th>
        </tr>
        <tr>
            <td><code>IOCONx</code></td>
            <td>OVRENH, OVRENL</td>
            <td>Enable override for high and low outputs</td>
        </tr>
        <tr>
            <td><code>IOCONx</code></td>
            <td>OVRDAT[1:0]</td>
            <td>Override data (output pin states when override enabled)</td>
        </tr>
        <tr>
            <td><code>IOCONx</code></td>
            <td>OSYNC</td>
            <td>Override synchronization (0=immediate, 1=sync with PWM)</td>
        </tr>
    </table>

    <h3>Override Priority</h3>
    <p>When multiple control mechanisms are active, the priority order is:</p>
    <ol>
        <li><strong>Fault override</strong> (highest priority) - hardware fault forces outputs to safe state</li>
        <li><strong>Manual override</strong> (this block) - software controlled override</li>
        <li><strong>Normal PWM</strong> (lowest priority) - PWM generator output</li>
    </ol>

    <h2>Usage Examples</h2>

    <h3>Example 1: Emergency Shutdown</h3>
    <pre><code>% Configuration:
% OverrideChannels = [1 2 3];  % All motor phases
% OverrideMode = 'Grouped';
% DefaultState_H = 0;           % All high-sides OFF
% DefaultState_L = 0;           % All low-sides OFF
% SyncMode = 'Immediate';       % Fastest response

% Model logic:
% Connect emergency stop button -> Override_En input
% When E-stop pressed: all outputs forced LOW immediately

% Simulink implementation:
%  [E_Stop] ──→ [Override_En]
%  [0]      ──→ [Override_Value]  % All bits 0 = all outputs LOW
</code></pre>

    <h3>Example 2: Diagnostic Mode - Individual Phase Test</h3>
    <pre><code>% Configuration:
% OverrideChannels = [1 2 3];
% OverrideMode = 'Individual';

% Test sequence (executed by state machine):
% 1. Override PWM1: High-side ON, Low-side OFF
% 2. Measure current
% 3. Override PWM1: High-side OFF, Low-side ON
% 4. Measure current
% 5. Repeat for PWM2, PWM3

% Block inputs:
%  Override_En_1 = test_active && (phase == 1);
%  Override_H_1 = test_state == HIGH_SIDE_TEST;
%  Override_L_1 = test_state == LOW_SIDE_TEST;
</code></pre>

    <h3>Example 3: Custom Commutation Pattern (BLDC)</h3>
    <pre><code>% For 6-step BLDC commutation with hall sensors:
% OverrideChannels = [1 2 3];
% OverrideMode = 'Grouped';

% Commutation table (hall sensor state -> override value):
% Hall = 001: PWM1H=1, PWM1L=0, PWM2H=0, PWM2L=1, PWM3H/L=0
% Hall = 010: ...

commutationTable = [
    bin2dec('000000'),  % Hall 000 (invalid)
    bin2dec('100001'),  % Hall 001
    bin2dec('001100'),  % Hall 010
    bin2dec('101100'),  % Hall 011
    bin2dec('110010'),  % Hall 100
    bin2dec('110001'),  % Hall 101
    bin2dec('011010'),  % Hall 110
    bin2dec('000000')   % Hall 111 (invalid)
];

% Model:
%  [Hall_State] ──→ [Lookup Table] ──→ [Override_Value]
%                   (commutationTable)
%  [BLDC_Mode]  ──→ [Override_En]  % Enable override in BLDC mode
</code></pre>

    <h3>Example 4: Shoot-Through Protection</h3>
    <pre><code>% Prevent both high and low side ON simultaneously:
% OverrideChannels = [1 2 3];
% OverrideMode = 'Individual';
% SyncMode = 'Synchronized';  % Avoid glitches

% Protection logic (for each channel):
%  if (PWM_H_command && PWM_L_command)  % Illegal state
%      Override_En = 1;
%      Override_H = 0;
%      Override_L = 0;
%  else
%      Override_En = 0;  % Normal PWM operation
%  end
</code></pre>

    <h2>Safety Considerations</h2>

    <div class="important">
        <h3>⚠️ Critical Safety Guidelines</h3>
        <ul>
            <li><strong>Never enable both high and low side simultaneously</strong> unless using push-pull mode with appropriate hardware</li>
            <li><strong>Always configure safe default states</strong> before enabling override</li>
            <li><strong>Test override logic thoroughly</strong> on bench before motor connection</li>
            <li><strong>Implement timeout protection</strong> to revert to safe state if control loop fails</li>
            <li><strong>Use hardware fault inputs</strong> as primary protection; override is secondary</li>
        </ul>
    </div>

    <h3>Recommended Safe States</h3>
    <table>
        <tr>
            <th>Application</th>
            <th>Safe State</th>
            <th>Rationale</th>
        </tr>
        <tr>
            <td>Motor Drive (Half-bridge)</td>
            <td>All outputs LOW</td>
            <td>Prevents shoot-through, allows motor to freewheel via body diodes</td>
        </tr>
        <tr>
            <td>Buck Converter</td>
            <td>High-side OFF, Low-side ON</td>
            <td>Maintains inductor current path, prevents voltage spikes</td>
        </tr>
        <tr>
            <td>Boost Converter</td>
            <td>High-side OFF, Low-side ON</td>
            <td>Prevents output overvoltage</td>
        </tr>
        <tr>
            <td>Push-Pull Transformer</td>
            <td>Both sides OFF</td>
            <td>Prevents transformer saturation</td>
        </tr>
    </table>

    <h2>Troubleshooting</h2>

    <h3>Override Not Working</h3>
    <div class="warning">
        <strong>Symptom:</strong> Override_En = 1 but PWM outputs follow normal PWM pattern
    </div>
    <p><strong>Possible Causes:</strong></p>
    <ul>
        <li>Fault input active (fault has higher priority than override)</li>
        <li>Incorrect channel numbering (check enabled channels in PWM_HighSpeed block)</li>
        <li>Override disabled in IOCONx register (check TLC code generation)</li>
    </ul>

    <h3>Unexpected Output States</h3>
    <div class="warning">
        <strong>Symptom:</strong> Outputs are not in expected states when override active
    </div>
    <p><strong>Solutions:</strong></p>
    <ul>
        <li>Verify Override_Value bitfield mapping matches hardware PWM numbering</li>
        <li>Check for conflicts with PWM output polarity settings (PENH/PENL in IOCONx)</li>
        <li>Ensure synchronized mode is used if immediate override causes glitches</li>
    </ul>

    <h3>Shoot-Through During Override Transition</h3>
    <div class="important">
        <strong>Symptom:</strong> Momentary short circuit during override enable/disable
    </div>
    <p><strong>Solutions:</strong></p>
    <ul>
        <li>Use synchronized mode (SyncMode = 'Synchronized')</li>
        <li>Implement software dead-time in override logic</li>
        <li>Sequence override transitions: first disable old state, wait dead-time, then enable new state</li>
    </ul>

    <h2>Related Blocks</h2>
    <ul>
        <li><a href="pwm_high_speed.html"><strong>MCHP_PWM_HighSpeed</strong></a> - Main PWM block (required for override block to function)</li>
        <li><a href="pwm_standard.html"><strong>MCHP_PWM</strong></a> - Standard PWM (has built-in OVDCON register control)</li>
        <li><a href="pwm_sam7x_override.html"><strong>MCHP_PWM_SAM7x_Override</strong></a> - Override block for SAM7x devices</li>
        <li><strong>MCHP_Comparator</strong> - Hardware fault generation</li>
    </ul>

    <h2>See Also</h2>
    <ul>
        <li><a href="../peripheral_overview.html">Peripheral Block Overview</a></li>
        <li><a href="../safety_guide.html">Safety and Fault Handling Guide</a></li>
        <li>dsPIC33F/EP Family Reference Manual - PWM Override Control</li>
        <li>dsPIC33C Family Reference Manual - Output Override and Polarity Control</li>
    </ul>

    <hr>
    <p><small>Last updated: January 2025 | MCHP Blockset Documentation</small></p>
    </div>
</body>
</html>
