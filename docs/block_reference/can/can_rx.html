<!DOCTYPE html>
<html>
<head>
    <title>CAN Rx - MCHP Blockset</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../../assets/css/navigation.css">
    <script src="../../assets/js/navigation.js"></script>
</head>
<body>
    <!-- Mobile Navigation Toggle -->
    <button class="nav-toggle" aria-label="Toggle navigation">☰</button>

    <!-- Left Navigation Panel -->
    <nav class="doc-nav-container">
        <div class="doc-nav-header">
            <a href="../../index.html">MCHP Blockset Docs</a>
        </div>
        <ul class="doc-nav-menu">
            <li class="nav-item">
                <a href="../../index.html" class="nav-link">Home</a>
            </li>

            <!-- Getting Started Section -->
            <li class="nav-item">
                <div class="nav-category">Getting Started <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../getting_started/overview.html" class="nav-link">Overview</a></li>
                    <li><a href="../../getting_started/installation.html" class="nav-link">Installation</a></li>
                    <li><a href="../../getting_started/quick_start.html" class="nav-link">Quick Start</a></li>
                    <li><a href="../../getting_started/board_templates.html" class="nav-link">Board Templates</a></li>
                    <li><a href="../../getting_started/supported_devices.html" class="nav-link">Supported Devices</a></li>
                </ul>
            </li>

            <!-- User Guide Section -->
            <li class="nav-item">
                <div class="nav-category">User Guide <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../user_guide/index.html" class="nav-link">User Guide Overview</a></li>
                    <li><a href="../../user_guide/code_generation.html" class="nav-link">Code Generation</a></li>
                    <li><a href="../../user_guide/external_mode.html" class="nav-link">External Mode</a></li>
                </ul>
            </li>

            <!-- Block Reference Section -->
            <li class="nav-item">
                <div class="nav-category">Block Reference <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../block_reference/index.html" class="nav-link">Block Reference Overview</a></li>
                </ul>
            </li>

            <!-- Examples Section -->
            <li class="nav-item">
                <div class="nav-category">Examples <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../examples/field_weakening.html" class="nav-link">Field Weakening</a></li>
                </ul>
            </li>

            <!-- Release Notes -->
            <li class="nav-item">
                <a href="../../release_notes.html" class="nav-link">Release Notes</a>
            </li>
        </ul>
    </nav>

    <div class="doc-content-wrapper">
    <div class="container">
        <div class="breadcrumb">
            <a href="../index.html">Block Reference</a> &gt;
            <a href="./can.html">CAN Blocks</a> &gt;
            CAN Rx
        </div>

        <h1>CAN Rx</h1>

        
    <!-- Block Icon -->
    <div class="block-image">
        <img src="../assets/images/blocks/bus_can/CAN_Rx.svg"
             alt="CAN_Rx Block Icon"
             onerror="this.onerror=null; this.src='../assets/images/blocks/bus_can/CAN_Rx.png';">
        <div class="block-image-caption">
            CAN_Rx Block Icon
        </div>
    </div>
<h2>Description</h2>
        <p>
            The <strong>CAN Rx</strong> block receives CAN messages from the CAN bus network and outputs the message ID,
            data length, and payload data. The block supports flexible message filtering with standard (11-bit) and
            extended (29-bit) identifiers, multiple filter types (exact match, range, mask), and configurable storage
            in dedicated buffers or FIFOs.
        </p>

        <p>
            This block requires a <strong>CAN Config</strong> block in the same model to configure the CAN peripheral.
            Multiple CAN Rx blocks can be used to receive different messages on the same CAN module, each with its own
            filter configuration.
        </p>

        <h2>Block Ports</h2>

        <h3>Output Ports</h3>
        <table>
            <thead>
                <tr>
                    <th>Port Name</th>
                    <th>Data Type</th>
                    <th>Size</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="port-label">MsgID</span></td>
                    <td>uint16 or uint32</td>
                    <td>Scalar (1)</td>
                    <td>Received message identifier (uint16 for standard, uint32 for extended)</td>
                </tr>
                <tr>
                    <td><span class="port-label">MsgLen</span></td>
                    <td>uint8</td>
                    <td>Scalar (1)</td>
                    <td>Number of data bytes received (0-8 for CAN 2.0, 0-64 for CAN-FD)</td>
                </tr>
                <tr>
                    <td><span class="port-label">Rx[N]</span></td>
                    <td>uint8</td>
                    <td>Vector (1-64)</td>
                    <td>Received message data bytes</td>
                </tr>
            </tbody>
        </table>

        <div class="note">
            <strong>Note:</strong> The MsgID port data type depends on the message type: <strong>uint16</strong> for standard
            11-bit IDs, <strong>uint32</strong> for extended 29-bit IDs. The Rx data port size is configured in block parameters.
        </div>

        <h2>Block Parameters</h2>

        <h3>CAN Module Selection</h3>
        <table>
            <thead>
                <tr>
                    <th>Parameter</th>
                    <th>Description</th>
                    <th>Valid Values</th>
                    <th>Default</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="param-type">CAN Module</span></td>
                    <td>Selects which CAN peripheral to use (must match CAN Config block)</td>
                    <td>CAN0, CAN1, MCAN0, MCAN1 (device-dependent)</td>
                    <td>CAN0 or MCAN0</td>
                </tr>
            </tbody>
        </table>

        <h3>Message Configuration</h3>
        <table>
            <thead>
                <tr>
                    <th>Parameter</th>
                    <th>Description</th>
                    <th>Valid Values</th>
                    <th>Default</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="param-type">Message Type</span></td>
                    <td>Identifier format to receive</td>
                    <td>Standard (11-bit ID), Extended (29-bit ID)</td>
                    <td>Standard</td>
                </tr>
                <tr>
                    <td><span class="param-type">Filter Type</span></td>
                    <td>How to match incoming messages</td>
                    <td>Classic (Mask), Dual ID, Range</td>
                    <td>Classic</td>
                </tr>
            </tbody>
        </table>

        <h3>Filter Configuration (Classic Mode)</h3>
        <table>
            <thead>
                <tr>
                    <th>Parameter</th>
                    <th>Description</th>
                    <th>Valid Values</th>
                    <th>Default</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="param-type">Message ID</span></td>
                    <td>CAN identifier to match (hexadecimal)</td>
                    <td>0x000-0x7FF (standard), 0x00000000-0x1FFFFFFF (extended)</td>
                    <td>0x100</td>
                </tr>
                <tr>
                    <td><span class="param-type">Message ID Mask</span></td>
                    <td>Bitwise mask (1=must match, 0=don't care)</td>
                    <td>0x000-0x7FF (standard), 0x00000000-0x1FFFFFFF (extended)</td>
                    <td>0x7FF (exact match)</td>
                </tr>
            </tbody>
        </table>

        <h3>Filter Configuration (Dual ID Mode)</h3>
        <table>
            <thead>
                <tr>
                    <th>Parameter</th>
                    <th>Description</th>
                    <th>Valid Values</th>
                    <th>Default</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="param-type">Message ID 1</span></td>
                    <td>First CAN identifier to accept</td>
                    <td>0x000-0x7FF (standard), 0x00000000-0x1FFFFFFF (extended)</td>
                    <td>0x100</td>
                </tr>
                <tr>
                    <td><span class="param-type">Message ID 2</span></td>
                    <td>Second CAN identifier to accept</td>
                    <td>0x000-0x7FF (standard), 0x00000000-0x1FFFFFFF (extended)</td>
                    <td>0x101</td>
                </tr>
            </tbody>
        </table>

        <h3>Filter Configuration (Range Mode)</h3>
        <table>
            <thead>
                <tr>
                    <th>Parameter</th>
                    <th>Description</th>
                    <th>Valid Values</th>
                    <th>Default</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="param-type">Message ID 1 (Min)</span></td>
                    <td>Minimum CAN identifier in range</td>
                    <td>0x000-0x7FF (standard), 0x00000000-0x1FFFFFFF (extended)</td>
                    <td>0x100</td>
                </tr>
                <tr>
                    <td><span class="param-type">Message ID 2 (Max)</span></td>
                    <td>Maximum CAN identifier in range</td>
                    <td>0x000-0x7FF (standard), 0x00000000-0x1FFFFFFF (extended)</td>
                    <td>0x10F</td>
                </tr>
            </tbody>
        </table>

        <h3>Buffer Configuration</h3>
        <table>
            <thead>
                <tr>
                    <th>Parameter</th>
                    <th>Description</th>
                    <th>Options</th>
                    <th>Default</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="param-type">Data Store</span></td>
                    <td>Reception buffer type</td>
                    <td>RX FIFO 0, RX FIFO 1, Rx Buffer</td>
                    <td>RX FIFO 0</td>
                </tr>
            </tbody>
        </table>

        <div class="tip">
            <strong>Tip:</strong> Use <strong>Rx Buffer</strong> for single high-priority messages that must never be lost.
            Use <strong>RX FIFO 0/1</strong> for multiple messages of the same type that can be queued.
        </div>

        <h3>Data Configuration</h3>
        <table>
            <thead>
                <tr>
                    <th>Parameter</th>
                    <th>Description</th>
                    <th>Valid Values</th>
                    <th>Default</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="param-type">Data Type</span></td>
                    <td>Data output port type</td>
                    <td>uint8, uint16, uint32</td>
                    <td>uint8</td>
                </tr>
                <tr>
                    <td><span class="param-type">Data Size</span></td>
                    <td>Size of data output port</td>
                    <td>1-8 (CAN 2.0), 1-64 (CAN-FD)</td>
                    <td>8</td>
                </tr>
            </tbody>
        </table>

        <h2>Message Filtering</h2>

        <h3>Filter Types Explained</h3>

        <h4>1. Classic Filter (Mask-Based)</h4>
        <p>
            Compares incoming message ID with configured ID using bitwise AND with mask:
        </p>

        <pre><code>Filter Logic:
  Accept if: (Incoming_ID & Mask) == (Filter_ID & Mask)

Example 1 - Exact Match:
  Filter ID:  0x123
  Mask:       0x7FF (all bits must match)
  Accepts:    0x123 only
  Rejects:    0x122, 0x124, all others

Example 2 - Partial Match:
  Filter ID:  0x100
  Mask:       0x7F0 (ignore lower 4 bits)
  Accepts:    0x100, 0x101, 0x102...0x10F (16 IDs)
  Rejects:    0x110, 0x0FF, all others

Example 3 - Don't Care Bits:
  Filter ID:  0x200
  Mask:       0x700 (only check upper 3 bits)
  Accepts:    0x200-0x2FF (256 IDs)
  Rejects:    0x100, 0x300, all others</code></pre>

        <h4>2. Dual ID Filter</h4>
        <p>
            Accepts messages matching either of two specific IDs:
        </p>

        <pre><code>Filter Logic:
  Accept if: (Incoming_ID == ID1) OR (Incoming_ID == ID2)

Example:
  ID1:        0x200
  ID2:        0x300
  Accepts:    0x200, 0x300 only
  Rejects:    All other IDs

Use Case:
  - Two related messages to same processing
  - Status from two different sources
  - Command and acknowledgment pairing</code></pre>

        <h4>3. Range Filter</h4>
        <p>
            Accepts any message ID within a specified range (inclusive):
        </p>

        <pre><code>Filter Logic:
  Accept if: (ID1 <= Incoming_ID <= ID2)

Example:
  ID1 (Min):  0x100
  ID2 (Max):  0x10F
  Accepts:    0x100, 0x101, 0x102...0x10F (16 IDs)
  Rejects:    0x0FF, 0x110, all others

Use Case:
  - Group of related sensors (0x200-0x20F)
  - Module address range (0x300-0x3FF)
  - Priority band filtering</code></pre>

        <h3>Filter Priority and Matching Order</h3>
        <p>
            When multiple filters are configured, the CAN controller processes them in order:
        </p>

        <div class="block-diagram">
<pre>
Incoming Message (ID: 0x105)
        │
        ▼
   ┌─────────────────┐
   │ Standard Filters │ (processed first)
   │  Filter 1: 0x100-0x10F (Range) → MATCH! → RX FIFO 0
   │  Filter 2: 0x105 (Exact)       → (not checked, already matched)
   └─────────────────┘
        │
        ▼
   ┌─────────────────┐
   │ Extended Filters │ (only if no standard match)
   │  Filter 3: ...
   └─────────────────┘

Result: Message accepted by Filter 1, stored in RX FIFO 0
</pre>
        </div>

        <div class="note">
            <strong>Note:</strong> First matching filter wins. If Filter 1 accepts a message to FIFO 0, Filter 2 will not
            be evaluated even if it would also match. Order filters from most specific to most general.
        </div>

        <h2>Buffer Modes Comparison</h2>

        <table>
            <thead>
                <tr>
                    <th>Feature</th>
                    <th>RX FIFO 0/1</th>
                    <th>Rx Buffer</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Storage Type</strong></td>
                    <td>First-In-First-Out queue</td>
                    <td>Dedicated single message buffer</td>
                </tr>
                <tr>
                    <td><strong>Capacity</strong></td>
                    <td>Multiple messages (configured depth)</td>
                    <td>One message per buffer</td>
                </tr>
                <tr>
                    <td><strong>Overflow Behavior</strong></td>
                    <td>Newest message overwrites oldest (watermark)</td>
                    <td>New message rejected if not read</td>
                </tr>
                <tr>
                    <td><strong>Use Case</strong></td>
                    <td>Multiple messages of same type, bursty traffic</td>
                    <td>Single critical message, guaranteed delivery</td>
                </tr>
                <tr>
                    <td><strong>Filter Sharing</strong></td>
                    <td>Multiple filters can target same FIFO</td>
                    <td>One filter per buffer</td>
                </tr>
                <tr>
                    <td><strong>Read Access</strong></td>
                    <td>Sequential (FIFO order)</td>
                    <td>Direct (always latest)</td>
                </tr>
            </tbody>
        </table>

        <h2>Implementation Details</h2>

        <h3>Reception Process (SAM E7x MCAN)</h3>
        <pre><code>/* CAN Rx Implementation */
void CAN_Receive(MCHP_MCAN_RxBuf_t *rxBuf, CANMessage_t *msg) {
    /* Invalidate cache if using cached memory */
    SCB_InvalidateDCache_by_Addr((uint32_t*)rxBuf, sizeof(*rxBuf));

    /* Extract message header */
    msg->id = rxBuf->ID;
    msg->extended = rxBuf->XTD;
    msg->rtr = rxBuf->RTR;
    msg->dlc = rxBuf->DLC;

    /* Determine actual data length from DLC */
    if (rxBuf->FDF) {  // CAN-FD
        const uint8_t dlc_to_len[] = {
            0,1,2,3,4,5,6,7,8,12,16,20,24,32,48,64
        };
        msg->len = dlc_to_len[msg->dlc];
    } else {  // CAN 2.0
        msg->len = (msg->dlc <= 8) ? msg->dlc : 8;
    }

    /* Copy data from buffer */
    for (int i = 0; i < msg->len; i++) {
        msg->data[i] = rxBuf->buffer.c[i];
    }

    /* Get filter index that matched */
    msg->filter_idx = rxBuf->FIDX;

    /* Acknowledge reception */
    if (useFIFO) {
        MCAN0_REGS->MCAN_RXF0A = fifoIndex;  // Acknowledge FIFO 0
    }
}</code></pre>

        <h3>Filter Configuration (SAM E5x/C2x)</h3>
        <pre><code>/* Standard ID Filter Setup */
void CAN_ConfigStandardFilter(uint8_t filterIdx,
                               uint16_t id1, uint16_t id2,
                               FilterType_t type,
                               FilterAction_t action) {
    mcan_sidfe_registers_t *filter = &MCHP_CAN0.StdFilter[filterIdx];

    /* Configure filter based on type */
    switch (type) {
        case FILTER_RANGE:
            filter->MCAN_SIDFE_0 =
                MCAN_SIDFE_0_SFT(0) |        // Range filter
                MCAN_SIDFE_0_SFID1(id1) |    // Min ID
                MCAN_SIDFE_0_SFID2(id2) |    // Max ID
                MCAN_SIDFE_0_SFEC(action);   // Store in FIFO 0/1 or buffer
            break;

        case FILTER_DUAL:
            filter->MCAN_SIDFE_0 =
                MCAN_SIDFE_0_SFT(1) |        // Dual ID filter
                MCAN_SIDFE_0_SFID1(id1) |    // First ID
                MCAN_SIDFE_0_SFID2(id2) |    // Second ID
                MCAN_SIDFE_0_SFEC(action);
            break;

        case FILTER_CLASSIC:
            filter->MCAN_SIDFE_0 =
                MCAN_SIDFE_0_SFT(2) |        // Classic filter
                MCAN_SIDFE_0_SFID1(id1) |    // Filter ID
                MCAN_SIDFE_0_SFID2(id2) |    // Mask
                MCAN_SIDFE_0_SFEC(action);
            break;
    }

    /* Flush cache to ensure filter is written */
    SCB_CleanDCache_by_Addr((uint32_t*)filter, sizeof(*filter));
}</code></pre>

        <h2>Block Usage Examples</h2>

        <h3>Example 1: Single ID Reception</h3>
        <p><strong>Application:</strong> Receive motor speed command (ID 0x100)</p>

        <div class="block-diagram">
<pre>
Simulink Model:
                      CAN Rx
                    (ID: 0x100)
                    ┌──────────┐
  CAN Bus ─────────→│  MsgID   │────→ [Check ID = 0x100]
                    │  MsgLen  │────→ [Validate length]
                    │  Rx[8]   │────→ [speed_cmd, mode, ...]
                    └──────────┘

Configuration:
  - CAN Module: CAN0
  - Message Type: Standard (11-bit)
  - Filter Type: Classic
  - Message ID: 0x100
  - Mask: 0x7FF (exact match)
  - Data Store: Rx Buffer
  - Data Size: 8 bytes

Filter Behavior:
  Accepts: ID 0x100 only
  Rejects: All other IDs
</pre>
        </div>

        <h3>Example 2: ID Range Reception</h3>
        <p><strong>Application:</strong> Receive sensor data from multiple nodes (ID 0x200-0x20F)</p>

        <div class="block-diagram">
<pre>
Simulink Model:
                      CAN Rx
                   (ID: 0x200-0x20F)
                    ┌──────────┐
  CAN Bus ─────────→│  MsgID   │────→ [Node ID = MsgID - 0x200]
                    │  MsgLen  │────→ [Validate]
                    │  Rx[4]   │────→ [temp, hum, pres, rsv]
                    └──────────┘
                           │
                           ▼
                    ┌─────────────┐
                    │ Demux by ID │
                    │  (Switch)   │
                    └─────────────┘
                      │  │  │  │
                      ▼  ▼  ▼  ▼
                    Node0...Node15

Configuration:
  - Message Type: Standard
  - Filter Type: Range
  - ID1 (Min): 0x200
  - ID2 (Max): 0x20F
  - Data Store: RX FIFO 0
  - Data Size: 4 bytes

Filter Behavior:
  Accepts: 0x200, 0x201, 0x202...0x20F (16 IDs)
  Rejects: 0x1FF, 0x210, all others
</pre>
        </div>

        <h3>Example 3: Broadcast Reception</h3>
        <p><strong>Application:</strong> Receive network-wide broadcast messages</p>

        <div class="block-diagram">
<pre>
Network Topology:
  ┌──────┐   ┌──────┐   ┌──────┐   ┌──────┐
  │Node 1│   │Node 2│   │Node 3│   │Node 4│
  └───┬──┘   └───┬──┘   └───┬──┘   └───┬──┘
      └──────────┴──────────┴──────────┘
                CAN Bus (250 kbps)

Master broadcasts: ID 0x000 (time sync, emergency stop)
All nodes receive using CAN Rx:

Configuration:
  - Message Type: Standard
  - Filter Type: Classic
  - Message ID: 0x000
  - Mask: 0x7FF (exact match)
  - Data Store: RX FIFO 0 (all nodes)

Broadcast Use Cases:
  - Network time synchronization
  - Emergency stop commands
  - Configuration updates
  - State machine transitions
</pre>
        </div>

        <h3>Example 4: Multi-Filter Node</h3>
        <p><strong>Application:</strong> Motor controller receiving commands and status</p>

        <div class="block-diagram">
<pre>
Motor Control Node:
  ┌────────────────────────────────────┐
  │                                    │
  │  CAN Rx (0x100)                    │
  │  → Motor Command                   │
  │  [speed_setpoint][mode][enable]    │
  │                                    │
  │  CAN Rx (0x200-0x20F)              │
  │  → Sensor Feedback Range           │
  │  [sensor_id][value][status]        │
  │                                    │
  │  CAN Rx (0x000)                    │
  │  → Emergency Broadcast             │
  │  [emergency_stop][reason]          │
  │                                    │
  └────────────────────────────────────┘
           ▲
           │
       CAN Bus

Filter Configuration (3 CAN Rx blocks):
  1. Command:    ID=0x100, Mask=0x7FF → Rx Buffer
  2. Sensors:    ID1=0x200, ID2=0x20F (Range) → RX FIFO 0
  3. Emergency:  ID=0x000, Mask=0x7FF → Rx Buffer

Priority:
  - 0x000: Highest (emergency - dedicated buffer)
  - 0x100: High (command - dedicated buffer)
  - 0x200-0x20F: Medium (sensors - FIFO queue)
</pre>
        </div>

        <h3>Example 5: CAN-FD Reception (SAM E7x)</h3>
        <p><strong>Application:</strong> Receive firmware update packets with 64-byte payload</p>

        <div class="block-diagram">
<pre>
Firmware Update Protocol:
                      CAN Rx (CAN-FD)
                      (ID: 0x500)
                    ┌──────────────┐
  CAN-FD Bus ──────→│  MsgID       │────→ 0x500 (update packet)
  (2 Mbps data)     │  MsgLen      │────→ 64 (bytes)
                    │  Rx[64]      │────→ [packet_data]
                    └──────────────┘
                           │
                           ▼
                    ┌──────────────┐
                    │ Packet Parser│
                    │ [seq][data]  │
                    └──────────────┘

Configuration:
  - CAN Module: MCAN0
  - Enable CAN-FD: On
  - Message Type: Standard
  - Filter Type: Classic
  - Message ID: 0x500
  - Mask: 0x7FF
  - Data Store: RX FIFO 0
  - Data Size: 64 bytes

Performance:
  - 64 bytes per packet
  - ~1000 packets/sec @ 2 Mbps data phase
  - ~64 kB/sec throughput
  - Firmware update time: ~16 sec for 1 MB
</pre>
        </div>

        <h2>Troubleshooting</h2>

        <h3>Common Reception Issues</h3>

        <div class="warning">
            <strong>No Messages Received</strong>
            <p><strong>Symptoms:</strong> CAN Rx block outputs never update, MsgLen = 0</p>
            <p><strong>Possible Causes:</strong></p>
            <ul>
                <li>Missing CAN Config block in model</li>
                <li>CAN module mismatch between Config and Rx blocks</li>
                <li>Incorrect filter configuration (ID/mask mismatch)</li>
                <li>No messages with matching ID on bus</li>
                <li>Bus-off error state or physical connection issue</li>
            </ul>
            <p><strong>Solutions:</strong></p>
            <ul>
                <li>Verify CAN Config block exists and matches Rx block CAN module</li>
                <li>Use CAN bus analyzer to confirm expected messages are present</li>
                <li>Test with broadest filter first (mask=0x000, accept all)</li>
                <li>Check filter type matches incoming message type (standard vs extended)</li>
                <li>Verify bus termination and hardware connections</li>
            </ul>
        </div>

        <div class="warning">
            <strong>Incorrect Data Received</strong>
            <p><strong>Symptoms:</strong> MsgLen correct but data values wrong</p>
            <p><strong>Possible Causes:</strong></p>
            <ul>
                <li>Cache coherency issues (ARM Cortex-M7 with DCache)</li>
                <li>Data type mismatch between Tx and Rx</li>
                <li>Buffer overrun (FIFO overflow)</li>
                <li>Endianness mismatch (multi-byte values)</li>
            </ul>
            <p><strong>Solutions:</strong></p>
            <ul>
                <li>Place CAN buffers in non-cached memory (TCM) on SAM E7x</li>
                <li>Use cache invalidate before reading (SCB_InvalidateDCache_by_Addr)</li>
                <li>Ensure consistent data types across network nodes</li>
                <li>Increase FIFO depth or use dedicated Rx buffer</li>
                <li>Verify byte order for 16/32-bit values</li>
            </ul>
        </div>

        <div class="warning">
            <strong>Filter Not Working</strong>
            <p><strong>Symptoms:</strong> Receives wrong messages or none at all</p>
            <p><strong>Solutions:</strong></p>
            <ul>
                <li>Verify message type matches (standard vs extended ID)</li>
                <li>Check mask calculation: 1=must match, 0=don't care</li>
                <li>Test with exact match first (mask=0x7FF or 0x1FFFFFFF)</li>
                <li>Verify ID1 ≤ ID2 for range filters</li>
                <li>Check for filter ordering conflicts (first match wins)</li>
            </ul>
        </div>

        <h3>FIFO Overflow Handling</h3>

        <table>
            <thead>
                <tr>
                    <th>Issue</th>
                    <th>Symptom</th>
                    <th>Solution</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Messages lost</td>
                    <td>Missing sequence numbers, gaps in data</td>
                    <td>Increase FIFO depth, reduce message rate, process faster</td>
                </tr>
                <tr>
                    <td>FIFO full error</td>
                    <td>Overflow interrupt, watermark exceeded</td>
                    <td>Monitor fill level, implement flow control</td>
                </tr>
                <tr>
                    <td>Old data received</td>
                    <td>Stale messages processed</td>
                    <td>Flush FIFO on overflow, timestamp validation</td>
                </tr>
                <tr>
                    <td>Unpredictable behavior</td>
                    <td>Intermittent message loss</td>
                    <td>Use dedicated buffer for critical messages</td>
                </tr>
            </tbody>
        </table>

        <h3>Debug Checklist</h3>
        <ul>
            <li>✓ Verify CAN Config block present and configured correctly</li>
            <li>✓ Check CAN module selection matches between Config and Rx blocks</li>
            <li>✓ Confirm message type (standard/extended) matches filter configuration</li>
            <li>✓ Test filter with broadest setting first (accept all IDs)</li>
            <li>✓ Use CAN bus analyzer to verify transmitted messages</li>
            <li>✓ Check filter mask calculation (1=match, 0=ignore)</li>
            <li>✓ Verify data size matches expected message length</li>
            <li>✓ Monitor FIFO fill level for overflow conditions</li>
            <li>✓ Test with simple constant ID before complex filtering</li>
            <li>✓ Check cache coherency on ARM Cortex-M7 devices</li>
        </ul>

        <h2>Filter Configuration Examples</h2>

        <h3>Common Filter Patterns</h3>

        <pre><code>/* Example 1: Accept single ID (0x123) */
Message ID:   0x123
Mask:         0x7FF  (all bits must match)
Result:       Accepts 0x123 only

/* Example 2: Accept range (0x100-0x10F) */
Filter Type:  Range
ID1 (Min):    0x100
ID2 (Max):    0x10F
Result:       Accepts 16 IDs from 0x100 to 0x10F

/* Example 3: Accept two specific IDs */
Filter Type:  Dual
ID1:          0x200
ID2:          0x300
Result:       Accepts 0x200 or 0x300 only

/* Example 4: Accept group (0x200-0x2FF, ignore lower byte) */
Message ID:   0x200
Mask:         0x700  (check upper 3 bits only)
Result:       Accepts 0x200-0x2FF (256 IDs)

/* Example 5: Accept all (broadcast receiver) */
Message ID:   0x000
Mask:         0x000  (no bits need to match)
Result:       Accepts all IDs (0x000-0x7FF)</code></pre>

        <h2>Related Blocks</h2>
        <ul>
            <li><a href="can_config.html">CAN Config</a> - Configure CAN peripheral and buffers</li>
            <li><a href="can_tx.html">CAN Tx</a> - Transmit CAN messages</li>
            <li><a href="../digital_io/digital_output.html">Digital Output</a> - Control CAN transceiver enable pins</li>
            <li><a href="../interrupts/interrupt_config.html">Interrupt Config</a> - Configure CAN reception interrupts</li>
        </ul>

        <h2>References</h2>
        <ul>
            <li>ISO 11898-1:2015 - CAN Protocol Specification</li>
            <li>Bosch CAN FD Specification Version 1.0</li>
            <li><a href="https://www.microchip.com/DS60001527">SAM E70/S70/V70/V71 Family Datasheet (DS60001527)</a> - MCAN Module</li>
            <li><a href="https://www.microchip.com/DS60001507">SAM E5x/D5x Family Datasheet (DS60001507)</a> - CAN Module</li>
            <li>Application Note: CAN Message Filtering and Buffer Management (search <a href="https://www.microchip.com/en-us/search">Microchip Portal</a>)</li>
            <li>Application Note: CAN-FD Implementation and Migration (search <a href="https://www.microchip.com/en-us/search">Microchip Portal</a>)</li>
        </ul>

        <footer>
            <p>&copy; 2025 Microchip Technology Inc. - MPLAB Device Blocks for Simulink</p>
        </footer>
    </div>
    </div>
</body>
</html>
