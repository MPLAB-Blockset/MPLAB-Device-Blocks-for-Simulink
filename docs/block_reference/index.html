<!doctype html><html lang=en><head><title>Block Reference - MPLAB Blockset for MATLAB/Simulink</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Microchip Blockset for MATLAB/Simulink - Embedded Code Generation for dsPIC, PIC32, and SAM Microcontrollers"><meta name=keywords content="Microchip,MPLAB,MATLAB,Simulink,dsPIC,PIC32,Embedded,Code Generation,Motor Control"><meta name=author content="Microchip Technology Inc."><meta name=robots content="index, follow"><meta http-equiv=X-UA-Compatible content="IE=edge"><link rel=canonical href=https://mplab-blockset.github.io/MPLAB-Device-Blocks-for-Simulink/block_reference/index.html><link rel=icon type=image/x-icon href=../favicon.ico><style>:root{--bg-primary:#f8f9fa;--bg-secondary:white;--bg-tertiary:#f8f9fa;--text-primary:#2c3e50;--text-secondary:#666;--text-tertiary:#6c757d;--text-heading:#003d5c;--border-color:#dee2e6;--border-light:#e1e8ed;--border-medium:#e9ecef;--accent-primary:#0076A8;--accent-secondary:#005a85;--accent-hover:#005580;--accent-light:#e3f2fd;--code-bg:#f4f4f4;--code-text:#c7254e;--pre-bg:linear-gradient(to bottom, #e8e8e8 0%, #f0f0f0 100%);--pre-border:#d0d0d0;--table-hover:#e3f2fd;--table-stripe:#f8f9fa;--note-bg:linear-gradient(to right, #e7f3fe 0%, #f5fbff 100%);--note-border:#2196F3;--note-text:#1976D2;--warning-bg:linear-gradient(to right, #fff9e6 0%, #fffcf0 100%);--warning-border:#ff9800;--warning-text:#f57c00;--shadow-sm:0 2px 4px rgba(0,0,0,0.05);--shadow-md:0 2px 8px rgba(0,0,0,0.08);--shadow-lg:0 2px 12px rgba(0,0,0,0.08)}[data-theme=dark]{--bg-primary:#1a1d23;--bg-secondary:#242831;--bg-tertiary:#2d3139;--text-primary:#e4e6eb;--text-secondary:#adb5bd;--text-tertiary:#8b95a1;--text-heading:#e4e6eb;--border-color:#3a3f4b;--border-light:#3a3f4b;--border-medium:#404654;--accent-primary:#4da6d6;--accent-secondary:#3d8ab5;--accent-hover:#60b4e0;--accent-light:#2d4556;--code-bg:#2d3139;--code-text:#ff6b9d;--pre-bg:linear-gradient(to bottom, #2d3139 0%, #2d3139 100%);--pre-border:#3a3f4b;--table-hover:#2d4556;--table-stripe:#2d3139;--note-bg:linear-gradient(to right, #1e3a52 0%, #1e3a52 100%);--note-border:#4da6d6;--note-text:#66b3e0;--warning-bg:linear-gradient(to right, #3d3520 0%, #3d3520 100%);--warning-border:#ffb347;--warning-text:#ffc870;--shadow-sm:0 2px 4px rgba(0,0,0,0.3);--shadow-md:0 2px 8px rgba(0,0,0,0.4);--shadow-lg:0 2px 12px rgba(0,0,0,0.5)}:root{--content-max-width:1000px;--content-margin-horizontal:30px;--content-margin-vertical:15px;--container-border-radius:8px}*{transition:background-color .3s ease,color .3s ease,border-color .3s ease}body{font-family:-apple-system,BlinkMacSystemFont,segoe ui,roboto,oxygen,ubuntu,cantarell,sans-serif;margin:0;padding:0;line-height:1.6;color:var(--text-primary);background-color:var(--bg-primary);font-size:15px}.doc-wrapper{display:flex;max-width:1600px;margin:0 auto;min-height:100vh}.sidebar{width:280px;background-color:var(--bg-secondary);border-right:1px solid var(--border-color);position:sticky;top:0;height:100vh;overflow-y:auto;overflow-x:hidden;flex-shrink:0}.sidebar::-webkit-scrollbar{width:8px}.sidebar::-webkit-scrollbar-track{background:var(--bg-tertiary)}.sidebar::-webkit-scrollbar-thumb{background:var(--border-color);border-radius:4px}.sidebar::-webkit-scrollbar-thumb:hover{background:var(--accent-primary)}.content-wrapper{flex:1;min-width:0;background-color:var(--bg-primary)}.container{max-width:var(--content-max-width);margin:var(--content-margin-vertical)var(--content-margin-horizontal);background-color:var(--bg-secondary);padding:30px;box-shadow:var(--shadow-lg);border-radius:var(--container-border-radius)}.sidebar-header{padding:20px;border-bottom:2px solid var(--border-light);background:linear-gradient(135deg,var(--accent-primary) 0%,var(--accent-secondary) 100%)}.sidebar-title{color:#fff;font-size:16px;font-weight:700;margin:0;text-align:center}.sidebar-nav{padding:15px 0}.nav-section{margin-bottom:8px}.nav-section-title{display:flex;align-items:center;justify-content:space-between;padding:10px 20px;color:var(--text-primary);font-weight:600;font-size:14px;cursor:pointer;border-left:3px solid transparent;transition:all .2s ease}.nav-section-title:hover{background-color:var(--bg-tertiary);border-left-color:var(--accent-primary);color:var(--accent-primary)}.nav-section-title .icon{font-size:16px;margin-right:8px}.nav-section-title .toggle-icon{font-size:12px;transition:transform .2s ease}.nav-section.expanded .toggle-icon{transform:rotate(90deg)}.nav-section-children{display:none;padding-left:15px}.nav-section.expanded>.nav-section-children{display:block}.nav-link{display:block;padding:8px 20px;padding-left:45px;color:var(--text-secondary);font-size:13px;text-decoration:none;border-left:3px solid transparent;transition:all .2s ease}.nav-link:hover{background-color:var(--bg-tertiary);color:var(--accent-primary);border-left-color:var(--accent-light)}.nav-link.active{background-color:var(--accent-light);color:var(--accent-primary);border-left-color:var(--accent-primary);font-weight:600}.nav-subsection{margin-bottom:4px}.nav-subsection-title{display:flex;align-items:center;justify-content:space-between;padding:8px 20px;padding-left:35px;color:var(--text-primary);font-weight:600;font-size:13px;cursor:pointer;border-left:3px solid transparent;transition:all .2s ease;background-color:var(--bg-tertiary)}.nav-subsection-title:hover{background-color:var(--bg-primary);border-left-color:var(--accent-secondary);color:var(--accent-secondary)}.nav-subsection-title .icon{font-size:14px;margin-right:6px}.nav-subsection-title .toggle-icon{font-size:10px;transition:transform .2s ease}.nav-subsection.expanded .toggle-icon{transform:rotate(90deg)}.nav-subsection .nav-section-children{display:none;padding-left:10px}.nav-subsection.expanded>.nav-section-children{display:block}.nav-block-link{display:block;padding:6px 20px;padding-left:55px;color:var(--text-secondary);font-size:12px;text-decoration:none;border-left:3px solid transparent;transition:all .2s ease}.nav-block-link:hover{background-color:var(--accent-light);color:var(--accent-primary);border-left-color:var(--accent-secondary)}.nav-block-link.active{background-color:var(--accent-light);color:var(--accent-primary);border-left-color:var(--accent-primary);font-weight:600}.mobile-nav-toggle{display:none;position:fixed;bottom:20px;right:20px;width:56px;height:56px;border-radius:50%;background:var(--accent-primary);color:#fff;border:none;font-size:24px;cursor:pointer;box-shadow:var(--shadow-lg);z-index:1000}.mobile-nav-toggle:hover{background:var(--accent-hover)}.theme-toggle{display:inline-flex;align-items:center;gap:6px;cursor:pointer;background:var(--bg-tertiary);border:1px solid var(--border-color);border-radius:20px;padding:6px 12px;font-size:13px;color:var(--text-secondary);margin-left:16px;user-select:none}.theme-toggle:hover{background:var(--accent-light);border-color:var(--accent-primary);color:var(--accent-primary)}.theme-icon{font-size:16px}.page-header{display:flex;justify-content:space-between;align-items:center;padding:16px 0 12px;margin-bottom:20px;border-bottom:3px solid var(--border-light);position:relative}.page-header::after{content:'';position:absolute;bottom:-3px;left:0;width:120px;height:3px;background:linear-gradient(90deg,var(--accent-primary),var(--accent-secondary))}.page-header h1{margin:0;color:var(--text-heading);font-size:32px;font-weight:700;letter-spacing:-.5px}.page-header-right{display:flex;align-items:center}.microchip-logo{height:55px}.breadcrumbs{display:flex;align-items:center;font-size:13px;color:var(--text-secondary);margin-bottom:16px;padding:10px 14px;background:var(--bg-tertiary);border-radius:6px;border-left:3px solid var(--accent-primary)}.breadcrumbs a{color:var(--accent-primary);text-decoration:none;padding:4px 8px;border-radius:3px}.breadcrumbs a:hover{background-color:var(--accent-light);color:var(--accent-hover)}.breadcrumbs span{margin:0 8px;color:var(--text-tertiary)}h2{color:var(--text-heading);font-weight:600;font-size:22px;letter-spacing:-.5px;margin-top:32px;margin-bottom:12px;padding-bottom:6px;border-bottom:2px solid var(--border-light);position:relative}h2::before{content:'';position:absolute;bottom:-2px;left:0;width:60px;height:2px;background:linear-gradient(90deg,var(--accent-primary),var(--accent-secondary))}h3{color:var(--text-primary);font-weight:600;font-size:17px;margin-top:24px;margin-bottom:10px}h4{color:var(--text-primary);font-weight:500;font-size:15px;margin-top:18px;margin-bottom:8px}p{margin-bottom:12px;line-height:1.6;color:var(--text-primary)}table{border-collapse:separate;border-spacing:0;width:100%;margin:18px 0;border:1px solid var(--border-color);border-radius:6px;overflow:hidden;box-shadow:var(--shadow-md)}th{background:linear-gradient(to bottom,var(--accent-primary) 0%,var(--accent-secondary) 100%);color:#fff;padding:14px 16px;text-align:left;font-weight:600;font-size:13px;text-transform:uppercase;letter-spacing:.5px;border-bottom:2px solid var(--accent-secondary)}td{padding:12px 16px;border-bottom:1px solid var(--border-medium);vertical-align:top;color:var(--text-primary);background-color:var(--bg-secondary)}tr:last-child td{border-bottom:none}tr:nth-child(even) td{background-color:var(--table-stripe)}tbody tr:hover td{background-color:var(--table-hover)}code{background-color:var(--code-bg);padding:3px 6px;border-radius:3px;font-family:consolas,monaco,courier new,monospace;color:var(--code-text);font-size:14px}pre{background:var(--pre-bg);border:1px solid var(--pre-border);border-left:4px solid var(--accent-primary);border-radius:6px;padding:16px;margin:18px 0;box-shadow:var(--shadow-sm);overflow-x:auto;line-height:1.5}pre code{background-color:initial;padding:0;color:var(--text-primary);font-family:consolas,monaco,courier new,monospace;font-size:14px}.note{background:var(--note-bg);border-left:5px solid var(--note-border);border-radius:4px;padding:14px 16px;margin:18px 0;box-shadow:var(--shadow-md);position:relative}.note::before{content:'\2139\FE0F  Note';display:block;font-weight:600;color:var(--note-text);margin-bottom:6px;font-size:14px}.note p{color:var(--text-primary)}.warning{background:var(--warning-bg);border-left:5px solid var(--warning-border);border-radius:4px;padding:14px 16px;margin:18px 0;box-shadow:var(--shadow-md);position:relative}.warning::before{content:'\26A0\FE0F  Warning';display:block;font-weight:600;color:var(--warning-text);margin-bottom:6px;font-size:14px}.warning p{color:var(--text-primary)}ul,ol{margin:12px 0;padding-left:30px;line-height:1.6}li{margin:6px 0;color:var(--text-primary)}a{color:var(--accent-primary);text-decoration:none}a:hover{color:var(--accent-hover);text-decoration:underline}.nav-footer{margin-top:48px;padding:20px 0 12px;border-top:2px solid var(--border-light);font-size:11px;color:var(--text-tertiary);text-align:center}.nav-footer p{margin:0;font-size:11px}.block-icon-container{display:table;width:100%;background:var(--bg-tertiary);border:1px solid var(--border-color);border-radius:8px;margin:24px 0;padding:20px;box-shadow:var(--shadow-md);table-layout:fixed}.block-icon-image{display:table-cell;width:220px;vertical-align:middle;padding-right:20px}.block-icon-image img{width:200px;height:auto;display:block}.block-icon-description{display:table-cell;vertical-align:middle;font-size:16px;line-height:1.7;color:var(--text-primary)}p img,.container>img{max-width:100%;height:auto;display:block;margin:20px auto;border:1px solid var(--border-light);border-radius:4px;box-shadow:var(--shadow-sm)}@media(max-width:768px){body{padding:10px 20px}.container{padding:20px}.page-header{flex-direction:column;align-items:flex-start;gap:16px}.microchip-logo{height:40px}.page-header h1{font-size:24px}h2{font-size:20px}h3{font-size:16px}}@media(max-width:1024px){.sidebar{position:fixed;left:-280px;top:0;height:100vh;z-index:999;transition:left .3s ease;box-shadow:2px 0 8px rgba(0,0,0,.15)}.sidebar.mobile-visible{left:0}.mobile-nav-toggle{display:flex;align-items:center;justify-content:center}.content-wrapper{width:100%}.container{margin:10px 15px;padding:20px}.sidebar.mobile-visible::after{content:'';position:fixed;top:0;left:280px;right:0;bottom:0;background:rgba(0,0,0,.5);z-index:-1}}@media(max-width:768px){.container{margin:10px;padding:15px}.page-header h1{font-size:22px}.breadcrumbs{font-size:12px;padding:8px 12px}.nav-section-title{font-size:13px;padding:8px 15px}.nav-link{font-size:12px;padding:6px 15px;padding-left:35px}}.under-construction-banner{background:linear-gradient(135deg,#ff9800 0%,#f57c00 100%);color:#fff;padding:12px 20px;text-align:center;font-size:14px;font-weight:600;border-bottom:3px solid #e65100;box-shadow:0 2px 8px rgba(0,0,0,.15);margin-bottom:20px}.under-construction-banner .icon{font-size:18px;margin-right:8px}.under-construction-banner strong{color:#fff;text-transform:uppercase;letter-spacing:.5px}</style><script type=application/ld+json>{"@context":"https://schema.org","@type":"TechArticle","name":"Block Reference","description":"Microchip Blockset for MATLAB\/Simulink - Embedded Code Generation for dsPIC, PIC32, and SAM Microcontrollers","url":"https://mplab-blockset.github.io/MPLAB-Device-Blocks-for-Simulink\/block_reference\/index.html","author":{"@type":"Organization","name":"Microchip Technology Inc."},"datePublished":"2025-10-16","dateModified":"2025-10-16","inLanguage":"en-US"}</script></head><body><div class=doc-wrapper><nav class=sidebar><div class=sidebar-header><h2 class=sidebar-title>MPLAB Blockset</h2></div><div class=sidebar-nav><div class=nav-section><a href=../ class=nav-section-title style="display:block;border-left:3px solid transparent"><span><span class=icon>🏠</span>Home</span></a></div><div class=nav-section id=section-getting-started><div class=nav-section-title onclick='toggleSection("getting-started")'><span><span class=icon>🚀</span>Getting Started</span>
<span class=toggle-icon>▶</span></div><div class=nav-section-children><a href=../getting_started/overview.html class=nav-link>Overview</a>
<a href=../getting_started/installation.html class=nav-link>Installation</a>
<a href=../getting_started/quick_start.html class=nav-link>Quick Start Guide</a>
<a href=../getting_started/board_templates.html class=nav-link>Board Templates</a>
<a href=../getting_started/motor_control_examples.html class=nav-link>Motor Control Examples</a>
<a href=../getting_started/scheduler_multitasking.html class=nav-link>Scheduler & Multitasking</a>
<a href=../getting_started/external_mode_pil.html class=nav-link>External Mode & PIL</a>
<a href=../getting_started/data_visualization.html class=nav-link>Data Visualization</a>
<a href=../getting_started/supported_devices.html class=nav-link>Supported Devices</a></div></div><div class=nav-section id=section-user-guide><div class=nav-section-title onclick='toggleSection("user-guide")'><span><span class=icon>📚</span>User Guide</span>
<span class=toggle-icon>▶</span></div><div class=nav-section-children><a href=../user_guide/code_generation.html class=nav-link>Code Generation</a>
<a href=../user_guide/compiler_setup.html class=nav-link>Compiler Setup</a>
<a href=../user_guide/external_mode.html class=nav-link>External Mode</a>
<a href=../user_guide/pil_testing.html class=nav-link>PIL Testing</a></div></div><div class=nav-section id=section-block-reference><div class=nav-section-title onclick='toggleSection("block-reference")'><span><span class=icon>🧩</span>Block Reference</span>
<span class=toggle-icon>▶</span></div><div class=nav-section-children><div class=nav-subsection id=section-pwm-timers><div class=nav-subsection-title onclick='toggleSection("pwm-timers")'><span><span class=icon>⚡</span>PWM & Timers</span>
<span class=toggle-icon>▶</span></div><div class=nav-section-children><a href=../block_reference/pwm_io/pwm.html class=nav-block-link>PWM</a>
<a href=../block_reference/pwm_io/pwm_highspeed.html class=nav-block-link>PWM High-Speed</a>
<a href=../block_reference/pwm_io/pwm_hs_fep.html class=nav-block-link>PWM HS FEP</a>
<a href=../block_reference/pwm_io/pwm_highspeed_override.html class=nav-block-link>PWM HS Override</a>
<a href=../block_reference/pwm_io/mcpwm.html class=nav-block-link>MCPWM (PIC32)</a>
<a href=../block_reference/pwm_io/pwm_sam7x.html class=nav-block-link>PWM SAM7x</a>
<a href=../block_reference/pwm_io/pwm_sam7x_override.html class=nav-block-link>PWM SAM7x Override</a>
<a href=../block_reference/pwm_io/tcc_pwm.html class=nav-block-link>TCC PWM (SAM)</a></div></div><div class=nav-subsection id=section-timers><div class=nav-subsection-title onclick='toggleSection("timers")'><span><span class=icon>⏱️</span>Timers</span>
<span class=toggle-icon>▶</span></div><div class=nav-section-children><a href=../block_reference/timers/timer_config.html class=nav-block-link>Timer Config</a>
<a href=../block_reference/timers/input_capture.html class=nav-block-link>Input Capture</a>
<a href=../block_reference/timers/output_compare_hw.html class=nav-block-link>Output Compare (HW)</a>
<a href=../block_reference/timers/output_compare_sw.html class=nav-block-link>Output Compare (SW)</a>
<a href=../block_reference/timers/timer_pil_profiling.html class=nav-block-link>PIL Profiling Timer</a></div></div><div class=nav-subsection id=section-adc><div class=nav-subsection-title onclick='toggleSection("adc")'><span><span class=icon>📊</span>ADC</span>
<span class=toggle-icon>▶</span></div><div class=nav-section-children><a href=../block_reference/adc/adc.html class=nav-block-link>ADC (dsPIC)</a>
<a href=../block_reference/adc/adc_hs_12b.html class=nav-block-link>ADC HS 12-bit</a>
<a href=../block_reference/adc/adc_highspeed_sar.html class=nav-block-link>ADC High-Speed SAR</a>
<a href=../block_reference/adc/adc_highspeed_sar_dspic.html class=nav-block-link>ADC HS SAR (dsPIC)</a>
<a href=../block_reference/adc/adc_same5x.html class=nav-block-link>ADC (SAM E5x)</a>
<a href=../block_reference/adc/adc_samrh707x.html class=nav-block-link>ADC (SAMRH707x)</a>
<a href=../block_reference/adc/afec_sam7x.html class=nav-block-link>AFEC (SAM7x)</a></div></div><div class=nav-subsection id=section-communication><div class=nav-subsection-title onclick='toggleSection("communication")'><span><span class=icon>📡</span>Communication</span>
<span class=toggle-icon>▶</span></div><div class=nav-section-children><div class=nav-subsection id=section-uart><div class=nav-subsection-title onclick='toggleSection("uart")'><span><span class=icon></span>UART</span>
<span class=toggle-icon>▶</span></div><div class=nav-section-children><a href=../block_reference/communication/uart/uart_config.html class=nav-block-link>UART Config</a>
<a href=../block_reference/communication/uart/uart_tx.html class=nav-block-link>UART Tx</a>
<a href=../block_reference/communication/uart/uart_rx.html class=nav-block-link>UART Rx</a>
<a href=../block_reference/communication/uart/uart_txmatlab.html class=nav-block-link>UART Tx MATLAB</a>
<a href=../block_reference/communication/uart/uart_break_and_autobaud.html class=nav-block-link>UART Break & Autobaud</a></div></div><div class=nav-subsection id=section-can><div class=nav-subsection-title onclick='toggleSection("can")'><span><span class=icon></span>CAN</span>
<span class=toggle-icon>▶</span></div><div class=nav-section-children><a href=../block_reference/communication/can/can_config.html class=nav-block-link>CAN Config</a>
<a href=../block_reference/communication/can/can_tx.html class=nav-block-link>CAN Tx</a>
<a href=../block_reference/communication/can/can_rx.html class=nav-block-link>CAN Rx</a></div></div><a href=../block_reference/communication/i2c.html class=nav-block-link>I2C Master/Slave</a>
<a href=../block_reference/communication/spi.html class=nav-block-link>SPI Master/Slave</a></div></div><div class=nav-subsection id=section-digital-io><div class=nav-subsection-title onclick='toggleSection("digital-io")'><span><span class=icon>🔌</span>Digital I/O</span>
<span class=toggle-icon>▶</span></div><div class=nav-section-children><a href=../block_reference/digital_io/digital_input.html class=nav-block-link>Digital Input</a>
<a href=../block_reference/digital_io/digital_output.html class=nav-block-link>Digital Output</a>
<a href=../block_reference/digital_io/digital_output_read.html class=nav-block-link>Digital Output Read</a>
<a href=../block_reference/digital_io/digital_output_write.html class=nav-block-link>Digital Output Write</a></div></div><div class=nav-subsection id=section-encoders><div class=nav-subsection-title onclick='toggleSection("encoders")'><span><span class=icon>🔄</span>Encoders</span>
<span class=toggle-icon>▶</span></div><div class=nav-section-children><a href=../block_reference/encoders_counters/qei.html class=nav-block-link>QEI (Quadrature Encoder)</a>
<a href=../block_reference/encoders_counters/pdec.html class=nav-block-link>PDEC (SAM)</a>
<a href=../block_reference/encoders_counters/qdec_samx.html class=nav-block-link>QDEC (SAM)</a>
<a href=../block_reference/encoders_counters/change_notification.html class=nav-block-link>Change Notification</a></div></div><div class=nav-subsection id=section-analog-io><div class=nav-subsection-title onclick='toggleSection("analog-io")'><span><span class=icon>📉</span>Analog I/O</span>
<span class=toggle-icon>▶</span></div><div class=nav-section-children><a href=../block_reference/analog_io/comparator_opamps_volt_ref/highspeed_analogcomparator.html class=nav-block-link>High-Speed Comparator</a>
<a href=../block_reference/analog_io/comparator_opamps_volt_ref/highspeed_analogcomparator_wslope.html class=nav-block-link>Comparator w/ Slope</a>
<a href=../block_reference/analog_io/comparator_opamps_volt_ref/op_amp.html class=nav-block-link>Op-Amp</a>
<a href=../block_reference/analog_io/comparator_opamps_volt_ref/pga.html class=nav-block-link>PGA (Programmable Gain Amp)</a>
<a href=../block_reference/analog_io/dac_samx.html class=nav-block-link>DAC (SAM)</a></div></div><div class=nav-subsection id=section-system-config><div class=nav-subsection-title onclick='toggleSection("system-config")'><span><span class=icon>⚙️</span>System Config</span>
<span class=toggle-icon>▶</span></div><div class=nav-section-children><a href=../block_reference/system_configuration/master.html class=nav-block-link>Master</a>
<a href=../block_reference/system_configuration/interrupt.html class=nav-block-link>Interrupt</a>
<a href=../block_reference/system_configuration/compiler_options.html class=nav-block-link>Compiler Options</a>
<a href=../block_reference/system_configuration/scheduler_options.html class=nav-block-link>Scheduler Options</a>
<a href=../block_reference/system_configuration/idle_task.html class=nav-block-link>Idle Task</a>
<a href=../block_reference/system_configuration/mcu_load.html class=nav-block-link>MCU Load</a>
<a href=../block_reference/system_configuration/mcu_overload.html class=nav-block-link>MCU Overload</a>
<a href=../block_reference/system_configuration/tasks_state.html class=nav-block-link>Tasks State</a>
<a href=../block_reference/system_configuration/secondary_core.html class=nav-block-link>Secondary Core</a></div></div><div class=nav-subsection id=section-utility><div class=nav-subsection-title onclick='toggleSection("utility")'><span><span class=icon>🔧</span>Utility Blocks</span>
<span class=toggle-icon>▶</span></div><div class=nav-section-children><a href=../block_reference/user_functions/c_function_call.html class=nav-block-link>C Function Call</a>
<a href=../block_reference/utility/doc.html class=nav-block-link>Documentation Block</a>
<a href=../block_reference/utility/msi.html class=nav-block-link>MSI (Model Sample Info)</a>
<a href=../block_reference/utility/port_info.html class=nav-block-link>Port Info</a>
<a href=../block_reference/utility/timer_info.html class=nav-block-link>Timer Info</a>
<a href=../block_reference/utility/simulink_reset_config.html class=nav-block-link>Simulink Reset Config</a></div></div></div></div><div class=nav-section id=section-examples><div class=nav-section-title onclick='toggleSection("examples")'><span><span class=icon>📖</span>Examples</span>
<span class=toggle-icon>▶</span></div><div class=nav-section-children><a href=../examples/field_weakening.html class=nav-link>Field Weakening</a></div></div><div class=nav-section id=section-github><a href=https://github.com/microchip-technology/mplab-blockset class=nav-section-title style="display:block;border-left:3px solid transparent"><span><span class=icon>💻</span>GitHub</span></a></div></div></nav><div class=content-wrapper><div class=container><div class=breadcrumbs><a href=../>Home</a>
<span>></span>
<a href=../index.html></a><span>></span>
<span>Block Reference</span></div><div class=under-construction-banner><span class=icon>⚠️</span>
<strong>Documentation Under Construction</strong> —
This documentation is currently being developed. All information has not been validated by Microchip yet.</div><div class=page-header><h1>Block Reference</h1><div class=page-header-right><img src=../images/microchip-logo.png alt="Microchip Logo" class=microchip-logo>
<button class=theme-toggle onclick=toggleTheme() aria-label="Toggle dark mode">
<span class=theme-icon id=theme-icon>☀️</span>
<span id=theme-text>Light</span></button></div></div><h1>Block Reference</h1><p>Complete reference for all MCHP Blockset blocks</p><h2><a href=../block_reference/adc/index.html>ADC Blocks</a></h2><p>Analog-to-Digital Converter peripheral blocks</p><h2><a href=../block_reference/adc_blocks.html>ADC Blocks - Analog-to-Digital Converter Reference</a></h2><p>The MCHP Blockset provides comprehensive ADC support for all Microchip microcontroller families. Each family has optimized ADC blocks tailored to the specific peripheral architecture and capabilities.</p><h2 id=dspic--pic24-family-adc-blocks>dsPIC & PIC24 Family ADC Blocks</h2><p>[MCHP_ADC] Standard ADC for dsPIC30F, dsPIC33F, dsPIC33E, dsPIC33C, and PIC24 families. <strong>Resolution:</strong> 10/12-bit<strong>Features:</strong> Scan mode, simultaneous sampling, DMA support<strong>Best for:</strong> General-purpose acquisition, motor control [MCHP_ADC_HighSpeed_SAR_dsPIC] High-speed SAR ADC for dsPIC33C with dedicated cores and shared ADC7. <strong>Resolution:</strong> 6/8/10/12-bit<strong>Cores:</strong> 3-6 dedicated + shared ADC7<strong>Speed:</strong> Up to 3.25 Msps per core<strong>Best for:</strong> High-speed multi-channel, simultaneous sampling [MCHP_ADC_HS_12b] 12-bit high-speed ADC with software sequencing for dsPIC33A family. <strong>Resolution:</strong> 12-bit fixed<strong>Cores:</strong> 2-5 (variant dependent)<strong>Sequencing:</strong> 6 sequences × 6 conversions<strong>Devices:</strong> Perseus, Pegasus, Blue Ridge, Serpens (33AK series)<strong>Best for:</strong> Advanced FOC motor control, flexible multi-channel</p><h2><a href=../block_reference/analog.html>Analog Signal Conditioning Blocks Documentation</a></h2><p>Integrated analog peripherals for signal amplification, buffering, and voltage generation</p><h2 id=overview>Overview</h2><p>Analog signal conditioning blocks provide access to integrated analog peripherals in Microchip microcontrollers, enabling precision signal processing without external components. These blocks eliminate the need for discrete amplifiers, comparators, and DACs in many applications, reducing BOM cost, board space, and improving signal integrity.</p><pre><code>                Integrated signal chain reduces external component count
                Direct connection to ADC for optimized analog front-end
                Software-configurable gain and operating modes
                Low noise and high precision for measurement applications
                Calibration capabilities for enhanced accuracy
</code></pre><h2 id=available-blocks>Available Blocks</h2><p>[</p><h2><a href=../block_reference/user_functions/c_function_call.html>Block Reference</a></h2><div class=block-icon-container><picture class=block-icon-image><source srcset=../assets/images/blocks/user_functions/C_Function_Call.svg type=image/svg+xml><img src=../assets/images/blocks/user_functions/C_Function_Call.png alt="C Function Call Block Icon"></picture><div class=block-icon-description>Complete reference for all MCHP Blockset peripheral blocks.</div></div><h3 id=pwm-blocks>[PWM Blocks]</h3><p>Pulse Width Modulation blocks for motor control and power conversion.</p><h3 id=adc-blocks>[ADC Blocks]</h3><p>Analog-to-Digital Converter blocks for sensor interfaces.</p><h3 id=communication-blocks>[Communication Blocks]</h3><p>UART, SPI, I2C, CAN, and other communication interfaces.</p><h3 id=timer-blocks>[Timer Blocks]</h3><p>Timer and interrupt configuration blocks.</p><h2 id=see-also>See Also</h2><p><a href=../getting_started.html>Getting Started</a> | <a href=../user_guide.html>User Guide</a></p><h2><a href=../block_reference/can.html>CAN Communication Blocks</a></h2><h2 id=overview>Overview</h2><p>The <strong>CAN (Controller Area Network)</strong> block family enables robust, multi-master communication on CAN bus networks. CAN is widely used in automotive, industrial automation, and embedded systems for reliable data exchange in electrically noisy environments.</p><p>The MCHP Blockset provides three blocks for CAN communication: <strong>CAN Config</strong> for peripheral setup, <strong>CAN Tx</strong> for message transmission, and <strong>CAN Rx</strong> for message reception with flexible filtering. These blocks support both CAN 2.0 (standard) and CAN-FD (flexible data-rate) protocols.</p><h2><a href=../block_reference/encoders_counters/change_notification.html>CN - Change Notification (Pin Interrupt)</a></h2><div class=block-icon-container><picture class=block-icon-image><source srcset=../assets/images/blocks/digital/ChangeNotification.svg type=image/svg+xml><img src=../assets/images/blocks/digital/ChangeNotification.png alt="Change Notification Block Icon"></picture><div class=block-icon-description>Change Notification - Pin State Change Interrupts and Timing</div></div><h2 id=overview>Overview</h2><p>The MCHP_CN block provides an interface to the Change Notification (CN) peripheral, which detects pin state changes and measures transition timing. While primarily used for GPIO interrupts (buttons, switches), CN can also serve as a simple encoder interface or pulse counter.
<strong>Key Features:</strong></p><ul><li>Multi-pin state change detection (up to 32 CN pins)</li><li>Edge detection: rising, falling, or both</li><li>Transition timing measurement (time between edges)</li><li>Period measurement (rising-to-rising or falling-to-falling)</li><li>Programmable pull-up/pull-down resistors</li><li>Interrupt generation on pin change</li><li>Wake from sleep on pin change</li><li>Can be used for simple rotary encoders or pulse counting</li></ul><h3 id=device-support>Device Support</h3><table><thead><tr><th>Family</th><th>CN Type</th><th>CN Pins</th><th>Notes</th></tr></thead><tbody><tr><td>dsPIC30F</td><td>Type 0</td><td>CN0-CN15</td><td>Dedicated CN peripheral</td></tr><tr><td>dsPIC33F</td><td>Type 0</td><td>CN0-CN23</td><td>Dedicated CN peripheral</td></tr><tr><td>dsPIC33E</td><td>Type 1</td><td>All GPIO pins</td><td>All ports have CN capability</td></tr><tr><td>dsPIC33C</td><td>Type 1</td><td>All GPIO pins</td><td>All ports have CN capability</td></tr><tr><td>PIC32MK</td><td>Type 2</td><td>Port-based</td><td>One interrupt per port</td></tr><tr><td>PIC24F</td><td>Type 0/1</td><td>Varies</td><td>Family dependent</td></tr></tbody></table><h2 id=block-parameters>Block Parameters</h2><h3 id=channel-selection>Channel Selection</h3><table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody><tr><td>CN Channels (dsPIC30F/33F)</td><td>Vector of CN channel numbers, e.g., [0 1 2] for CN0, CN1, CN2</td></tr><tr><td>CN Port (dsPIC33E/C, PIC32MK)</td><td>Port pin list, e.g., [A0 A1 B5] for PA0, PA1, PB5</td></tr></tbody></table><h3 id=measurement-configuration-per-channel>Measurement Configuration (per channel)</h3><table><thead><tr><th>Mode Value</th><th>Measurement</th><th>Output Ports</th></tr></thead><tbody><tr><td>0</td><td>Change detect only</td><td>Change detected flag only</td></tr><tr><td>1</td><td>Measure time UP (rising edge to falling edge)</td><td>T_Up (pulse width high)</td></tr><tr><td>2</td><td>Measure time DOWN (falling edge to rising edge)</td><td>T_Down (pulse width low)</td></tr><tr><td>3</td><td>Measure UP & DOWN</td><td>T_Up, T_Down</td></tr><tr><td>4</td><td>Period on rising edge</td><td>P_Rising (time between rising edges)</td></tr><tr><td>8</td><td>Period on falling edge</td><td>P_Falling (time between falling edges)</td></tr><tr><td>5</td><td>UP + Period on rising</td><td>T_Up, P_Rising</td></tr><tr><td>10</td><td>DOWN + Period on falling</td><td>T_Down, P_Falling</td></tr></tbody></table><h3 id=change-detection-per-channel>Change Detection (per channel)</h3><table><thead><tr><th>Value</th><th>Detection Mode</th><th>Output</th></tr></thead><tbody><tr><td>0</td><td>No change detection</td><td>-</td></tr><tr><td>1</td><td>Rising edge</td><td>CNx_Rise (timestamp)</td></tr><tr><td>2</td><td>Falling edge</td><td>CNx_Fall (timestamp)</td></tr><tr><td>3</td><td>Both edges</td><td>CNx_Rise&amp;Fall (timestamp)</td></tr></tbody></table><h3 id=advanced-configuration>Advanced Configuration</h3><table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody><tr><td>Output Port Value</td><td>Enable current pin state output (boolean per channel)</td></tr><tr><td>Max Channel</td><td>Maximum expected time for measurements (seconds, per channel)</td></tr><tr><td>Safe Margin</td><td>Percentage margin for timer overflow protection (per channel)</td></tr><tr><td>Interrupt Priority</td><td>CN interrupt priority level (1-7)</td></tr></tbody></table><h2 id=cn-peripheral-registers>CN Peripheral Registers</h2><h3 id=dspic30f33f-type-0>dsPIC30F/33F (Type 0)</h3><p>// Enable CN module CNCONbits.ON = 1; // Enable specific CN pins CNEN1bits.CN0IE = 1; // Enable CN0 CNEN1bits.CN1IE = 1; // Enable CN1// Enable pull-ups CNPU1bits.CN0PUE = 1; // Pull-up on CN0// Interrupt configuration IFS1bits.CNIF = 0; // Clear interrupt flag IEC1bits.CNIE = 1; // Enable CN interrupt IPC4bits.CNIP = 5; // Priority level// Read current state state = PORTBbits.RB0; // Read pin state (if CN0 is on RB0)</p><h2><a href=../block_reference/analog_io/dac_samx.html>MCHP DAC SAMx Documentation</a></h2><div class=block-icon-container><picture class=block-icon-image><source srcset=../assets/images/blocks/analog/DAC_SAMx.svg type=image/svg+xml><img src=../assets/images/blocks/analog/DAC_SAMx.png alt="DAC SAMx Block Icon"></picture><div class=block-icon-description>High-performance DAC for waveform generation and precision voltage output</div></div><h2 id=block-overview>Block Overview</h2><p>The <strong>MCHP_DACC_SAMx</strong> block provides access to the Digital-to-Analog Converter Controller (DACC) available in SAM E5x, SAM E7x, and SAM C2x microcontrollers. This peripheral enables high-quality analog voltage generation for applications including waveform synthesis, precision voltage references, audio output, and control signal generation.</p><pre><code>                10-bit or 12-bit resolution (device-dependent)
                Dual-channel independent or differential output modes
                Up to 1 MSPS conversion rate
                Internal or external voltage reference options
                Built-in waveform generation capabilities
                DMA support for continuous waveform streaming
                Low glitch energy and monotonic output
</code></pre><h3 id=supported-device-families>Supported Device Families</h3><table><thead><tr><th>Family</th><th>Representative Devices</th><th>Resolution</th><th>Channels</th><th>Max Rate</th></tr></thead><tbody><tr><td>SAM E5x</td><td>SAME54P20A, SAME53J18A</td><td>12-bit</td><td>2 (DAC0, DAC1)</td><td>1 MSPS</td></tr><tr><td>SAM E7x</td><td>SAME70Q21B, SAMV71Q21B</td><td>12-bit</td><td>2 (DAC0, DAC1)</td><td>1 MSPS</td></tr><tr><td>SAM C2x</td><td>SAMC21G18A, SAMC20G18A</td><td>10-bit</td><td>2 (DAC0, DAC1)</td><td>350 kSPS</td></tr></tbody></table><p><strong>Output Modes:</strong> The DACC supports both single-ended outputs (DAC0 and DAC1 independent) and differential output mode (DAC0 - DAC1), providing flexibility for various signal generation requirements.</p><h2><a href=../block_reference/analog_io/comparator_opamps_volt_ref/highspeed_analogcomparator.html>MCHP High-Speed Analog Comparator Documentation</a></h2><div class=block-icon-container><picture class=block-icon-image><source srcset=../assets/images/blocks/analog/HighSpeed_AnalogComparator.svg type=image/svg+xml><img src=../assets/images/blocks/analog/HighSpeed_AnalogComparator.png alt="High-Speed Analog Comparator Block Icon"></picture><div class=block-icon-description>Fast threshold detection and PWM integration for motor control and power applications</div></div><h2 id=overview>Overview</h2><p>The <strong>MCHP High-Speed Analog Comparator</strong> block configures the on-chip analog comparators for fast threshold detection applications. These comparators provide critical real-time monitoring for motor control overcurrent protection, power supply fault detection, and zero-crossing detection. With response times in the nanosecond range, they can directly trigger PWM fault events without CPU intervention.</p><pre><code>                Sub-microsecond response time for critical fault protection
                Multiple comparator instances (up to 4 per device)
                Internal DAC reference or external voltage reference
                Programmable hysteresis for noise immunity
                Direct PWM fault input integration
                Configurable output state monitoring
</code></pre><h3 id=typical-applications>Typical Applications</h3><ul><li><strong>Overcurrent Protection:</strong> Motor drive current limit detection</li><li><strong>Overvoltage/Undervoltage:</strong> DC bus voltage monitoring</li><li><strong>Zero-Crossing Detection:</strong> AC line synchronization</li><li><strong>PWM Blanking:</strong> Noise immunity during switching</li><li><strong>Peak Detection:</strong> Signal peak monitoring</li></ul><h2 id=device-family-support>Device Family Support</h2><h4 id=dspic33ep>dsPIC33EP</h4><p>1-4 Comparators</p><h2><a href=../block_reference/analog_io/comparator_opamps_volt_ref/highspeed_analogcomparator_wslope.html>MCHP High-Speed Analog Comparator with Slope Compensation Documentation</a></h2><div class=block-icon-container><picture class=block-icon-image><source srcset=../assets/images/blocks/analog/HighSpeed_AnalogComparator_wSlope.svg type=image/svg+xml><img src=../assets/images/blocks/analog/HighSpeed_AnalogComparator_wSlope.png alt="High-Speed Analog Comparator with Slope Block Icon"></picture><div class=block-icon-description>Advanced peak current mode control with programmable slope compensation</div></div><h2 id=overview>Overview</h2><p>The <strong>MCHP High-Speed Analog Comparator with Slope Compensation</strong> block extends the standard comparator with integrated slope compensation capabilities for peak current mode control applications. This advanced feature prevents sub-harmonic oscillation in current-mode DC-DC converters and motor drives operating at duty cycles above 50%.</p><pre><code>                All standard comparator features plus slope compensation
                Programmable compensation ramp generation
                Automatic ramp synchronization with PWM
                Variable slope adjustment for optimal stability
                Sub-microsecond response for high-frequency switching
                Integrated peak current mode control logic
</code></pre><h3 id=peak-current-mode-control>Peak Current Mode Control</h3><p>Peak current mode control regulates output by controlling the peak inductor current in each switching cycle. Slope compensation stabilizes the control loop when duty cycle exceeds 50%, preventing period-doubling oscillations.
<strong>Why Slope Compensation?</strong>
In peak current mode control with D > 50%, the inductor current slope creates a positive feedback loop leading to sub-harmonic oscillation. Adding a compensation ramp to the current sense signal stabilizes the loop.</p><h2><a href=../block_reference/analog_io/comparator_opamps_volt_ref/op_amp.html>MCHP Op-Amp Documentation</a></h2><div class=block-icon-container><picture class=block-icon-image><source srcset=../assets/images/blocks/analog/OpAmp.svg type=image/svg+xml><img src=../assets/images/blocks/analog/OpAmp.png alt="OpAmp Block Icon"></picture><div class=block-icon-description>Integrated operational amplifiers for signal conditioning and analog processing</div></div><h2 id=block-overview>Block Overview</h2><p>The <strong>MCHP_OP_AMP</strong> block provides access to the integrated operational amplifiers available in dsPIC33C, dsPIC33CH, and dsPIC33CK microcontrollers. These on-chip op-amps eliminate the need for external amplification circuitry in many applications, reducing BOM cost and board space while improving signal integrity.</p><pre><code>                Integrated signal conditioning eliminates external op-amps
                Direct connection to ADC for optimized signal chain
                Configurable gain settings for flexible amplification
                Rail-to-rail operation for maximum dynamic range
                Low offset and drift for precision measurements
</code></pre><h3 id=supported-device-families>Supported Device Families</h3><pre tabindex=0><code>| Family | DOS Module | Op-Amp Instances | Key Features |
|---|---|---|---|
| dsPIC33C/CH/CK | DOS_03349_amp_pad_opamp_ctrl_upb_v1 | Up to 3 op-amps | Basic amplification, fixed gain |
| dsPIC33A | DOS_03495_amp_pad_opamp_ctrl_upb_v2_dspic33a | Up to 3 op-amps | Enhanced features, programmable gain |

**Pin Mapping:** The block automatically displays pin assignments for each op-amp instance (IN+, IN-, OUT) based on the selected device. Pin assignments are fixed in hardware and cannot be remapped. 
## Operating Modes

### 1. Voltage Follower (Buffer)
**Configuration:** Enabled with negative input internally set to 0 
- **Gain:** Unity (1×)
- **Input:** IN+ connected to signal source
- **Feedback:** Output internally connected to IN-
- **Use Case:** High-impedance buffer, isolation amplifier

### 2. Non-Inverting Amplifier
**Configuration:** Enabled with positive and negative inputs 
- **Gain:** Configured by external resistor network
- **Input:** Signal applied to IN+
- **Feedback:** Resistor divider on IN- for gain setting
- **Use Case:** Signal amplification, sensor conditioning

### 3. Inverting Amplifier
**Configuration:** Enabled with positive and negative inputs 
- **Gain:** Set by input/feedback resistor ratio
- **Input:** Signal applied to IN- through input resistor
- **Reference:** IN+ connected to ground or reference voltage
- **Use Case:** Phase inversion, current-to-voltage conversion

### 4. Differential Amplifier
**Configuration:** Enabled with positive and negative inputs 
- **Gain:** Matched resistor network for CMRR
- **Input:** Differential signal on IN+ and IN-
- **Output:** Single-ended amplified difference
- **Use Case:** Differential sensor signals, noise rejection

## Block Parameters

| Parameter | Options | Description |
|---|---|---|
| OpAmp1 | • Disabled | • Enabled with negative input internally set to 0 | • Enabled with positive and negative inputs | Configuration for first op-amp instance. When enabled, the block automatically                         configures AMPON (master enable) and AMPEN[0] (instance enable) bits. The mode                         selection determines NCHDIS[0] setting (0 = internal connection, 1 = external pins). |
| OpAmp2 | • Disabled | • Enabled with negative input internally set to 0 | • Enabled with positive and negative inputs | Configuration for second op-amp instance. Independent control of AMPEN[1] and                         NCHDIS[1] bits. Can be used simultaneously with OpAmp1 for dual-channel applications. |
| OpAmp3 | • Disabled | • Enabled with negative input internally set to 0 | • Enabled with positive and negative inputs | Configuration for third op-amp instance (if available on device). Controls AMPEN[2]                         and NCHDIS[2]. Useful for three-phase motor control or multi-channel data acquisition. |


## Register Configuration

### AMPCON1 Register
 // Op-Amp Control Register 1 AMPCON1 = (AMPON &lt;&lt; 15) | // Master enable (1 = enabled) (AMPSIDL &lt;&lt; 13) | // Stop in idle (0 = continue in idle) (NCHDIS2 &lt;&lt; 10) | // OpAmp3 negative channel (1 = external pin) (NCHDIS1 &lt;&lt; 9) | // OpAmp2 negative channel (1 = external pin) (NCHDIS0 &lt;&lt; 8) | // OpAmp1 negative channel (1 = external pin) (AMPEN2 &lt;&lt; 2) | // OpAmp3 enable (1 = enabled) (AMPEN1 &lt;&lt; 1) | // OpAmp2 enable (1 = enabled) (AMPEN0 &lt;&lt; 0); // OpAmp1 enable (1 = enabled) 
### Port Configuration
## Application Examples

### Example 1: Voltage Follower for ADC Input Buffering
**Application:** High-impedance sensor buffer  // Configuration: // - OpAmp1 = &#34;Enabled with negative input internally set to 0&#34; // - OpAmp2 = Disabled // - OpAmp3 = Disabled // Hardware connections: // - Sensor output → OA1_IN+ (high impedance input) // - OA1_OUT → ADC channel (low impedance) // - Feedback is internal (unity gain) // Block automatically configures: AMPCON1bits.AMPON = 1; // Enable op-amp module AMPCON1bits.AMPEN0 = 1; // Enable OpAmp1 AMPCON1bits.NCHDIS0 = 0; // Internal feedback (voltage follower) // Result: Buffered sensor signal with no loading effect 
### Example 2: Non-Inverting Amplifier (Gain = 10)
**Application:** Thermocouple amplification  // Configuration: // - OpAmp1 = &#34;Enabled with positive and negative inputs&#34; // - External resistors: R1 = 1kΩ (to GND), R2 = 9kΩ (feedback) // - Gain = 1 + (R2/R1) = 1 + (9k/1k) = 10 // Hardware connections: // - Thermocouple → OA1_IN+ // - OA1_OUT → R2 → OA1_IN- // - OA1_IN- → R1 → GND // - OA1_OUT → ADC channel // Block configuration: AMPCON1bits.AMPON = 1; // Enable op-amp module AMPCON1bits.AMPEN0 = 1; // Enable OpAmp1 AMPCON1bits.NCHDIS0 = 1; // External pin for feedback network // Result: 10× amplified thermocouple signal // Input: 5mV → Output: 50mV 
### Example 3: Differential Amplifier for Current Sensing
**Application:** High-side current measurement  // Configuration: // - OpAmp1 = &#34;Enabled with positive and negative inputs&#34; // - Shunt resistor: 0.01Ω (100mΩ) // - Matched resistor network: R1 = R3 = 1kΩ, R2 = R4 = 10kΩ // - Differential gain = 10 // Hardware connections: // - Motor high-side → Shunt (0.01Ω) → Motor // - Shunt_High → R1 → OA1_IN+ // - Shunt_Low → R3 → GND // - OA1_IN+ → R2 → OA1_OUT // - OA1_IN- → R4 → GND // - OA1_OUT → ADC // Block configuration: AMPCON1bits.AMPON = 1; // Enable op-amp module AMPCON1bits.AMPEN0 = 1; // Enable OpAmp1 AMPCON1bits.NCHDIS0 = 1; // External resistor network // Current measurement: // Motor current: 10A → Shunt voltage: 100mV // Op-amp output: 100mV × 10 = 1V → ADC 
### Example 4: Multi-Channel Instrumentation Amplifier
**Application:** Three-phase current sensing  // Configuration: // - OpAmp1 = &#34;Enabled with positive and negative inputs&#34; (Phase A) // - OpAmp2 = &#34;Enabled with positive and negative inputs&#34; (Phase B) // - OpAmp3 = &#34;Enabled with positive and negative inputs&#34; (Phase C) // Hardware connections (per channel): // - Shunt resistor: 0.01Ω per phase // - Differential gain: 20 (configured by external resistors) // - OA1_OUT → ADC_CH1 // - OA2_OUT → ADC_CH2 // - OA3_OUT → ADC_CH3 // Block configuration: AMPCON1bits.AMPON = 1; // Enable op-amp module AMPCON1bits.AMPEN0 = 1; // Enable OpAmp1 (Phase A) AMPCON1bits.AMPEN1 = 1; // Enable OpAmp2 (Phase B) AMPCON1bits.AMPEN2 = 1; // Enable OpAmp3 (Phase C) AMPCON1bits.NCHDIS0 = 1; // External network for all AMPCON1bits.NCHDIS1 = 1; AMPCON1bits.NCHDIS2 = 1; // Synchronized three-phase current measurement // Sample all three ADC channels simultaneously for accurate FOC 
## Design Considerations

### Gain Configuration

- **Voltage Follower:** No external components required, unity gain (1×), high input impedance
- **Non-Inverting:** Gain = 1 + (R2/R1), input impedance ≈ op-amp input impedance (very high)
- **Inverting:** Gain = -(R2/R1), input impedance = R1 (finite), inverted output phase
- **Differential:** Gain = (R2/R1) for matched resistors, requires precision resistor matching

### Bandwidth and Slew Rate


                
                    Op-amp bandwidth typically ranges from 1 MHz to 10 MHz (device-dependent)
                    Gain-bandwidth product limits useful frequency range at higher gains
                    Slew rate limits large signal response (typically 1-10 V/μs)
                    Check device datasheet for specific performance parameters

### Offset and Calibration

- **Input Offset Voltage:** Typically ±1-5 mV (device-dependent)
- **Temperature Drift:** Consider offset drift over operating temperature range
- **Calibration:** Some devices support offset trim registers (check DOS module features)
- **Mitigation:** Use AC coupling or software offset correction for critical applications

### Power Supply Considerations
**Rail-to-Rail Operation:**
- Input common-mode range typically extends from VSS to VDD - 1.5V
- Output swing typically VSS + 100mV to VDD - 100mV under light loads
- Ensure signal levels stay within op-amp linear range
- Headroom required for proper operation, especially at high frequencies

### PCB Layout Guidelines

- **Short Traces:** Keep op-amp input and feedback traces as short as possible
- **Ground Plane:** Use solid ground plane under op-amp circuitry
- **Decoupling:** Place 100nF ceramic capacitor close to VDD pin
- **Separation:** Separate analog and digital ground returns
- **Shielding:** Shield sensitive inputs from switching noise sources

## Integration with Other Blocks

### Op-Amp + ADC Chain
**Optimized Signal Path:**
- Configure MCHP_OP_AMP block for desired gain and mode
- Connect op-amp output pin to dedicated ADC input channel
- Configure MCHP_ADC block to sample from op-amp output pin
- Synchronize ADC sampling with control loop timing
- Apply digital calibration/offset correction if needed

### Op-Amp + PWM Synchronization
**Motor Control Application:**
- Use op-amps to amplify shunt resistor voltages (current sensing)
- Trigger ADC from PWM events to sample at optimal timing
- Avoid sampling during PWM switching transitions
- Use ADC trigger delay to account for op-amp settling time

### Multi-Instance Coordination
 // Example: Three-phase motor current sensing // OpAmp1 → ADC_CH1 (Phase A current) // OpAmp2 → ADC_CH2 (Phase B current) // OpAmp3 → ADC_CH3 (Phase C current) // Configure all op-amps with identical gain // Sample all ADC channels simultaneously // Ensures phase alignment for FOC algorithm 
## Troubleshooting

| Issue | Possible Causes | Solution |
|---|---|---|
| No output signal | • AMPON not set | • AMPENx not set | • Pin not configured as analog | Verify block configuration enables the desired op-amp instance.                         Check that MCHP_PORT is correctly configured (automatic in INITIALISATION). |
| Saturated output | • Excessive input signal | • Incorrect gain setting | • Insufficient supply headroom | Reduce input amplitude, check resistor values for correct gain,                         ensure VDD provides adequate headroom for output swing. |
| Oscillation | • Poor PCB layout | • Missing decoupling | • Capacitive load | Add series resistor to output (10-50Ω), improve ground plane,                         add decoupling capacitor close to VDD pin, reduce trace lengths. |
| DC offset error | • Input offset voltage | • Bias current effects | • Temperature drift | Apply software offset calibration, use AC coupling if DC accuracy                         not required, check for trim registers in device datasheet. |
| Incorrect gain | • Wrong resistor values | • Incorrect mode selection | • Loading effects | Verify resistor network matches desired gain formula, ensure                         NCHDIS bit matches mode (0 = internal, 1 = external), check                         output load impedance is much higher than feedback resistors. |

## Related Blocks

- [MCHP_HighSpeed_AnalogComparator] - Fast analog comparator for threshold detection
- [MCHP_PGA] - Programmable Gain Amplifier with digital gain control
- [MCHP_ADC_HS_SAR_dsPIC33] - High-speed ADC for digitizing op-amp outputs
- [MCHP_PWM_HS_FEP] - PWM for motor control synchronization
[← Back to Analog Blocks]
</code></pre><h2><a href=../block_reference/analog_io/comparator_opamps_volt_ref/pga.html>MCHP PGA Documentation</a></h2><div class=block-icon-container><picture class=block-icon-image><source srcset=../assets/images/blocks/analog/PGA.svg type=image/svg+xml><img src=../assets/images/blocks/analog/PGA.png alt="PGA Block Icon"></picture><div class=block-icon-description>Digitally-controlled gain amplifier with calibration for precision analog signal conditioning</div></div><h2 id=block-overview>Block Overview</h2><p>The <strong>MCHP_PGA</strong> block provides access to the Programmable Gain Amplifier (PGA) peripheral available in select dsPIC33C, dsPIC33CH, and dsPIC33CK devices. The PGA offers digitally-controlled gain settings with calibration capabilities, enabling precision signal conditioning for sensor inputs and ADC front-end applications.</p><pre><code>                Software-configurable gain: 1×, 2×, 4×, 8×, 16×, 32× (device-dependent)
                Runtime gain adjustment via block input or register write
                Offset and gain calibration registers for precision measurements
                Direct connection to DACOUT pins or internal ADC inputs
                Single-ended or differential input modes
                Eliminates external amplifier circuits and reduces BOM cost
</code></pre><h3 id=supported-device-families>Supported Device Families</h3><table><thead><tr><th>Family</th><th>DOS Module</th><th>PGA Instances</th><th>Gain Range</th><th>Output Options</th></tr></thead><tbody><tr><td>dsPIC33C/CH/CK</td><td>DOS_02291_PGA</td><td>2 PGA channels</td><td>1×, 2×, 4×, 8×, 16×, 32×</td><td>DACOUT1, DACOUT2, Internal</td></tr></tbody></table><p><strong>Output Routing:</strong> PGA outputs can be routed to DACOUT pins (for external ADC or monitoring) or kept internal (for direct connection to on-chip ADC). The block automatically configures pin assignments based on your selection.</p><h2><a href=../block_reference/encoders_counters/pdec.html>PDEC - Position Decoder for SAM Devices</a></h2><div class=block-icon-container><picture class=block-icon-image><source srcset=../assets/images/blocks/digital/PDEC.svg type=image/svg+xml><img src=../assets/images/blocks/digital/PDEC.png alt="PDEC Block Icon"></picture><div class=block-icon-description>Position Decoder - Hall Sensors and Stepper Motor Interface</div></div><h2 id=overview>Overview</h2><p>The MCHP_PDEC block provides an interface to the Position Decoder (PDEC) peripheral on SAM E5x and E7x microcontrollers. Unlike traditional quadrature encoders, PDEC is optimized for Hall effect sensors (3-phase BLDC motors) and stepper motor position tracking, with specialized features for these applications.
<strong>Key Features:</strong></p><ul><li>3-input position decoder (Hall sensors: A, B, C)</li><li>Quadrature encoder mode (X2/X4)</li><li>Counter with direction input mode</li><li>Configurable position counter and revolution counter</li><li>Auto-correction for phase errors</li><li>Programmable digital filtering</li><li>Index pulse support</li><li>Angular position calculation (9-bit + configurable resolution)</li></ul><h3 id=device-support>Device Support</h3><table><thead><tr><th>Family</th><th>PDEC Module</th><th>Features</th></tr></thead><tbody><tr><td>SAM E54/E53/E51</td><td>1</td><td>Hall sensor, quadrature, stepper position</td></tr><tr><td>SAM E70/S70/V71</td><td>1</td><td>Hall sensor, quadrature, stepper position</td></tr></tbody></table><h2 id=block-parameters>Block Parameters</h2><h3 id=operating-mode>Operating Mode</h3><table><thead><tr><th>Parameter</th><th>Options</th><th>Description</th></tr></thead><tbody><tr><td>Mode</td><td>• Quadrature Encoder</td><td>• Counter with direction</td></tr></tbody></table><h3 id=position-configuration>Position Configuration</h3><table><thead><tr><th>Parameter</th><th>Options</th><th>Description</th></tr></thead><tbody><tr><td>Counter Output</td><td>on/off</td><td>Enable position counter output</td></tr><tr><td>Counter Datatype</td><td>unsigned/signed</td><td>Position counter sign</td></tr><tr><td>Revolution Output</td><td>on/off</td><td>Enable revolution counter</td></tr><tr><td>Revolution Datatype</td><td>unsigned/signed</td><td>Revolution counter sign</td></tr><tr><td>Counter Revolution Length</td><td>• Counter is 16-bit (9+7 bit resolution)</td><td>• Counter is 17-bit (9+8 bit resolution)</td></tr></tbody></table><h3 id=index-and-reset>Index and Reset</h3><table><thead><tr><th>Parameter</th><th>Options</th><th>Description</th></tr></thead><tbody><tr><td>Index</td><td>• Not used</td><td>• Reset counter</td></tr><tr><td>Max Counter Reset</td><td>Integer value</td><td>Modulo limit for position counter</td></tr><tr><td>Max Position Input</td><td>on/off</td><td>Enable dynamic modulo limit via block input</td></tr><tr><td>Reset Input</td><td>on/off</td><td>Enable external reset input</td></tr></tbody></table><h3 id=signal-configuration>Signal Configuration</h3><table><thead><tr><th>Pin</th><th>Function (Quadrature)</th><th>Function (Hall Sensor)</th></tr></thead><tbody><tr><td>QDI0</td><td>Phase A</td><td>Hall A</td></tr><tr><td>QDI1</td><td>Phase B</td><td>Hall B</td></tr><tr><td>QDI2</td><td>Index</td><td>Hall C</td></tr><tr><td>Parameter</td><td>Options</td><td>Description</td></tr><tr><td>Invert QDI0/1/2</td><td>on/off</td><td>Invert input polarity</td></tr><tr><td>Swap Pin Phase A & B</td><td>on/off</td><td>Reverse direction (quadrature mode)</td></tr><tr><td>Auto Correction</td><td>on/off</td><td>Automatic phase error correction</td></tr><tr><td>Digital Filter</td><td>disabled or time period</td><td>Input signal filtering</td></tr></tbody></table><h2 id=hall-sensor-operation>Hall Sensor Operation</h2><h3 id=3-phase-hall-sensor-interface>3-Phase Hall Sensor Interface</h3><p>PDEC decodes 3-wire Hall sensor signals for BLDC motor position:
Hall Sensor States (6-step commutation): State | Hall A | Hall B | Hall C | Sector &mdash;&mdash;-|&mdash;&mdash;&ndash;|&mdash;&mdash;&ndash;|&mdash;&mdash;&ndash;|&mdash;&mdash;&ndash; 1 | 0 | 0 | 1 | 0-60° 2 | 0 | 1 | 1 | 60-120° 3 | 0 | 1 | 0 | 120-180° 4 | 1 | 1 | 0 | 180-240° 5 | 1 | 0 | 0 | 240-300° 6 | 1 | 0 | 1 | 300-360° Valid transitions: 1→2→3→4→5→6→1 (CW) 1→6→5→4→3→2→1 (CCW)</p><h2><a href=../block_reference/pwm_blocks.html>PWM Blocks - Block Reference</a></h2><p>Comprehensive PWM (Pulse Width Modulation) blocks for motor control, power conversion, and signal generation across all MCHP Blockset supported families.</p><ul><li><p>[]</p></li><li><p>[]</p></li><li><p>[]</p></li><li><p>[][]</p><pre><code>      dsPIC30F/33F/33E: → MCHP_PWM
      dsPIC33C/CH/CK: → MCHP_PWM_HighSpeed
      dsPIC33A: → MCHP_PWM_HS_FEP
      SAM/ARM: → MCHP_PWM_SAM7x or MCHP_TCC_PWM
</code></pre></li></ul><h2 id=dspic-family-pwm-blocks>dsPIC Family PWM Blocks</h2><p>[<strong>MCHP_PWM</strong> - Standard PWMBasic PWM for dsPIC30F/33F/33E with dead-time and fault protectiondsPIC30FdsPIC33FdsPIC33E][<strong>MCHP_PWM_HighSpeed</strong> - High-Speed PWMAdvanced PWM with independent time bases and 4 output modesdsPIC33CdsPIC33CHdsPIC33CK][<strong>MCHP_PWM_HighSpeed_Override</strong> - PWM Override ControlManual override for emergency shutdown and diagnosticsdsPIC33C/CH/CK][<strong>MCHP_PWM_HS_FEP</strong> - High-Speed PWM with Fine Edge PositioningLatest generation with 16× resolution (High-Resolution mode)dsPIC33A]</p><h2><a href=../block_reference/encoders_counters/qdec_samx.html>QDEC SAMx - Quadrature Decoder for SAM Devices</a></h2><div class=block-icon-container><picture class=block-icon-image><source srcset=../assets/images/blocks/digital/QDEC_SAMx.svg type=image/svg+xml><img src=../assets/images/blocks/digital/QDEC_SAMx.png alt="QDEC SAMx Block Icon"></picture><div class=block-icon-description>Quadrature Decoder Using TC Modules - SAM Device Encoder Interface</div></div><h2 id=overview>Overview</h2><p>The MCHP_QDEC_SAMx block implements quadrature encoder decoding using the Timer/Counter (TC) modules on SAM microcontrollers (E5x, E7x, C2x). Unlike dedicated QEI peripherals, this implementation uses TC modules in quadrature mode to decode encoder signals for position and speed measurement.
<strong>Key Features:</strong></p><ul><li>Quadrature position decoding using TC modules</li><li>32-bit position counter with revolution counter</li><li>Index pulse support for position reset</li><li>Direction detection</li><li>Speed measurement using time base</li><li>Phase error detection (quadrature integrity check)</li><li>Missing pulse error detection</li><li>Configurable digital filtering</li><li>Rotation change flag</li></ul><h3 id=device-support>Device Support</h3><table><thead><tr><th>Family</th><th>TC Modules</th><th>Max QDEC Instances</th><th>Features</th></tr></thead><tbody><tr><td>SAM E54/E53</td><td>TC0-TC7</td><td>2-4</td><td>Position, speed, index, error detection</td></tr><tr><td>SAM E70/S70/V71</td><td>TC0-TC11</td><td>4</td><td>Position, speed, index, error detection</td></tr><tr><td>SAM C21</td><td>TC0-TC7</td><td>2-4</td><td>Position, speed, index, error detection</td></tr></tbody></table><p><strong>Important:</strong> Each QDEC instance requires 3 TC channels (one complete TC module). For example, TC0 uses channels 0, 1, and 2 for phase A/B counting, index counting, and speed time base respectively.</p><h2><a href=../block_reference/encoders_counters/qei.html>QEI - Quadrature Encoder Interface</a></h2><div class=block-icon-container><picture class=block-icon-image><source srcset=../assets/images/blocks/digital/QEI.svg type=image/svg+xml><img src=../assets/images/blocks/digital/QEI.png alt="QEI Block Icon"></picture><div class=block-icon-description>Quadrature Encoder Interface - Position and Velocity Measurement</div></div><h2 id=overview>Overview</h2><p>The MCHP_QEI block provides an interface to the Quadrature Encoder Interface (QEI) peripheral available on dsPIC and PIC32 microcontrollers. This peripheral decodes quadrature encoder signals to measure position, direction, and velocity of rotating shafts, making it ideal for motor control and precision positioning applications.
<strong>Key Features:</strong></p><ul><li>Quadrature decoding (X2 and X4 modes)</li><li>16-bit or 32-bit position counter</li><li>Index pulse detection and position reset</li><li>Direction sensing</li><li>Programmable digital filtering</li><li>Velocity measurement (32-bit QEI only)</li><li>Multiple operating modes: encoder, pulse counter, up/down counter</li><li>Position modulo and reset options</li></ul><h3 id=device-support>Device Support</h3><table><thead><tr><th>Family</th><th>QEI Type</th><th>Max Modules</th><th>Features</th></tr></thead><tbody><tr><td>dsPIC30F</td><td>16-bit</td><td>1-2</td><td>Basic quadrature decoding, index reset</td></tr><tr><td>dsPIC33F</td><td>16-bit</td><td>1-2</td><td>Basic quadrature decoding, index reset</td></tr><tr><td>dsPIC33E</td><td>32-bit</td><td>1-2</td><td>Extended position counter, velocity measurement</td></tr><tr><td>dsPIC33C</td><td>32-bit</td><td>1-2</td><td>Extended position counter, velocity measurement</td></tr><tr><td>dsPIC33A</td><td>32-bit</td><td>1-2</td><td>Enhanced position/velocity, advanced filtering</td></tr><tr><td>PIC32MK</td><td>32-bit</td><td>1-2</td><td>Extended features, modulo with index reset</td></tr></tbody></table><h2 id=block-parameters>Block Parameters</h2><h3 id=operating-mode>Operating Mode</h3><table><thead><tr><th>Parameter</th><th>Options</th><th>Description</th></tr></thead><tbody><tr><td>QEI Mode</td><td>• Quadrature Encoder</td><td>• External Pulse Counter</td></tr><tr><td>X2/X4 Mode</td><td>on/off (16-bit QEI only)</td><td>X2: 2 counts/line, X4: 4 counts/line</td></tr></tbody></table><h3 id=position-counter-configuration>Position Counter Configuration</h3><table><thead><tr><th>Parameter</th><th>Options</th><th>Description</th></tr></thead><tbody><tr><td>Position Output</td><td>• is not an output</td><td>• 16-bit unsigned</td></tr><tr><td>Position Reset Mode</td><td>• Never reset</td><td>• Reset on INDEX</td></tr><tr><td>Modulo Limits</td><td>[Low High] vector</td><td>Position counter modulo boundaries</td></tr><tr><td>Initial Value</td><td>Integer</td><td>Position initialization value</td></tr></tbody></table><h3 id=index-pulse-configuration>Index Pulse Configuration</h3><table><thead><tr><th>Parameter</th><th>Options</th><th>Description</th></tr></thead><tbody><tr><td>Index Counter Output</td><td>• is not an output</td><td>• 16-bit unsigned/signed</td></tr><tr><td>Index Match Value</td><td>QEA/QEB state (00, 01, 10, 11)</td><td>Encoder state when index is valid</td></tr><tr><td>Index Polarity</td><td>Active high/low</td><td>Index pulse polarity</td></tr></tbody></table><h3 id=velocity-measurement-32-bit-qei>Velocity Measurement (32-bit QEI)</h3><table><thead><tr><th>Parameter</th><th>Options</th><th>Description</th></tr></thead><tbody><tr><td>Velocity Output</td><td>• is not an output</td><td>• 16-bit unsigned</td></tr><tr><td>Period Output</td><td>• is not an output</td><td>• 16-bit unsigned</td></tr><tr><td>Max Period</td><td>Time (seconds)</td><td>Maximum period for velocity calculation</td></tr></tbody></table><h3 id=signal-conditioning>Signal Conditioning</h3><table><thead><tr><th>Parameter</th><th>Options</th><th>Description</th></tr></thead><tbody><tr><td>Digital Filter</td><td>on/off</td><td>Enable input signal filtering</td></tr><tr><td>Filter Cutoff Freq</td><td>Frequency (Hz)</td><td>Low-pass filter cutoff frequency</td></tr><tr><td>Swap QEA/QEB</td><td>on/off</td><td>Reverse encoder direction</td></tr><tr><td>Invert Polarity</td><td>QEA, QEB, INDEX, HOME</td><td>Invert input signal polarity</td></tr></tbody></table><h3 id=pin-configuration-remappable-devices>Pin Configuration (Remappable Devices)</h3><table><thead><tr><th>Pin</th><th>Function</th><th>Description</th></tr></thead><tbody><tr><td>QEA/QEIA</td><td>Phase A Input</td><td>Encoder channel A (or pulse input)</td></tr><tr><td>QEB/QEIB</td><td>Phase B Input</td><td>Encoder channel B (or direction input)</td></tr><tr><td>INDEX/QEINDX</td><td>Index Input</td><td>Index pulse for position reset</td></tr><tr><td>HOME/QEIHOM</td><td>Home Input</td><td>Home reference signal (optional)</td></tr></tbody></table><h2 id=quadrature-encoding-principles>Quadrature Encoding Principles</h2><h3 id=x4-quadrature-decoding>X4 Quadrature Decoding</h3><p>In X4 mode, the QEI peripheral counts on both rising and falling edges of both channels, providing 4 counts per encoder line:
QEA <em><strong>┌───┐</strong></em>┌───┐<em><strong>┌───┐</strong></em>┌───┐___ │ │ │ │ │ │ │ │ └───┘ └───┘ └───┘ └───┘ QEB <em><strong><em><strong>┌───┐</strong></em>┌───┐</strong></em>┌───┐___┌─── │ │ │ │ │ │ │ ____└───┘ └───┘ └───┘ └─── Count: 0 1 2 3 4 5 6 7 8 9 10 11 12 Direction: FORWARD (QEA leads QEB by 90°)</p><h2><a href=../block_reference/system/system.html>System Blocks</a></h2><p>System blocks configure the fundamental behavior of MCHP Blockset models, including target selection, clock configuration, multitasking scheduler, and runtime monitoring.</p><h2 id=core-configuration-blocks>Core Configuration Blocks</h2><p><strong>[][][]</strong></p><table><thead><tr><th>Block</th><th>Description</th><th>Required?</th></tr></thead><tbody><tr><td>MCHP_Master</td><td>Main configuration block - chip selection, clock, fuses, build settings</td><td>✓ Yes - ALWAYS required</td></tr><tr><td>MCHP_Scheduler_Options</td><td>Rate monotonic scheduler configuration and overload behavior</td><td>Optional (default settings used)</td></tr><tr><td>MCHP_Interrupt</td><td>Interrupt service routine configuration for triggered subsystems</td><td>Optional (for ISR-driven tasks)</td></tr></tbody></table><h2 id=task-management-blocks>Task Management Blocks</h2><p><strong>[][]</strong></p><h2><a href=../block_reference/pwm_io/index.html>PWM Blocks</a></h2><p>Pulse Width Modulation peripheral blocks</p><h2><a href=../block_reference/communication/index.html>Communication Blocks</a></h2><p>UART, SPI, I2C, and CAN communication blocks</p><h2><a href=../block_reference/digital_io/index.html>Digital I/O Blocks</a></h2><p>GPIO and digital port blocks</p><h2><a href=../block_reference/timers/index.html>Timer Blocks</a></h2><p>Timer and counter peripheral blocks</p><h2><a href=../block_reference/encoders/index.html>Encoder Blocks</a></h2><p>Quadrature Encoder Interface (QEI) blocks</p><h2><a href=../block_reference/system_configuration/index.html>System Configuration Blocks</a></h2><p>Master, Clock, and system-level configuration blocks</p><h2><a href=../block_reference/utility/index.html>Utility Blocks</a></h2><p>Debug, profiling, and utility blocks</p><div class=nav-footer><p>Last updated: January 2025 | MPLAB Blockset Documentation</p><p>&copy; 2025 Microchip Technology Inc. All rights reserved.</p></div></div></div><button class=mobile-nav-toggle onclick=toggleMobileSidebar() aria-label="Toggle navigation">
☰</button></div><script>function toggleTheme(){const t=document.documentElement,n=t.getAttribute("data-theme"),e=n==="dark"?"light":"dark";t.setAttribute("data-theme",e),localStorage.setItem("theme",e),updateThemeButton(e)}function updateThemeButton(e){const t=document.getElementById("theme-icon"),n=document.getElementById("theme-text");e==="dark"?(t.textContent="🌙",n.textContent="Dark"):(t.textContent="☀️",n.textContent="Light")}(function(){const n=localStorage.getItem("theme"),s=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=n||(s?"dark":"light");document.documentElement.setAttribute("data-theme",t),updateThemeButton(t)})(),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{if(!localStorage.getItem("theme")){const t=e.matches?"dark":"light";document.documentElement.setAttribute("data-theme",t),updateThemeButton(t)}}),window.toggleSection=function(e){const t=document.getElementById("section-"+e);if(t&&(t.classList.toggle("expanded"),t.classList.contains("nav-section"))){const n=getExpandedSections();t.classList.contains("expanded")?n.add(e):n.delete(e),localStorage.setItem("expandedSections",JSON.stringify([...n]))}};function getExpandedSections(){const e=localStorage.getItem("expandedSections");return new Set(e?JSON.parse(e):[])}function restoreExpandedSections(){const e=getExpandedSections();e.forEach(e=>{const t=document.getElementById("section-"+e);t&&t.classList.add("expanded")})}function highlightActivePage(){const e=window.location.pathname,t=document.querySelectorAll(".nav-link, .nav-block-link, .nav-section-title[href], .nav-subsection-title[href]");t.forEach(t=>{const n=new URL(t.href,window.location.origin).pathname;if(n===e){t.classList.add("active");const n=t.closest(".nav-subsection");n&&!n.classList.contains("expanded")&&n.classList.add("expanded");const e=t.closest(".nav-section");if(e&&!e.classList.contains("expanded")){e.classList.add("expanded");const n=e.id.replace("section-",""),t=getExpandedSections();t.add(n),localStorage.setItem("expandedSections",JSON.stringify([...t]))}}})}window.toggleMobileSidebar=function(){const e=document.querySelector(".sidebar");e&&e.classList.toggle("mobile-visible")},function(){restoreExpandedSections(),highlightActivePage();const t=document.querySelector(".nav-link.active");if(t){const e=t.closest(".nav-section");if(e&&e.id){const n=e.id.replace("section-",""),t=getExpandedSections();t.has(n)||(t.add(n),localStorage.setItem("expandedSections",JSON.stringify([...t])))}}}()</script></body></html>