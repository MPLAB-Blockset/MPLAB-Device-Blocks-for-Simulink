<!DOCTYPE html>
<html>
<head>
    <title>UART TxMatlab Block - MCHP Blockset</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../../assets/css/navigation.css">
    <script src="../../assets/js/navigation.js"></script>
</head>
<body>
    <!-- Mobile Navigation Toggle -->
    <button class="nav-toggle" aria-label="Toggle navigation">☰</button>

    <!-- Left Navigation Panel -->
    <nav class="doc-nav-container">
        <div class="doc-nav-header">
            <a href="../../index.html">MCHP Blockset Docs</a>
        </div>
        <ul class="doc-nav-menu">
            <li class="nav-item">
                <a href="../../index.html" class="nav-link">Home</a>
            </li>

            <!-- Getting Started Section -->
            <li class="nav-item">
                <div class="nav-category">Getting Started <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../getting_started/overview.html" class="nav-link">Overview</a></li>
                    <li><a href="../../getting_started/installation.html" class="nav-link">Installation</a></li>
                    <li><a href="../../getting_started/quick_start.html" class="nav-link">Quick Start</a></li>
                    <li><a href="../../getting_started/board_templates.html" class="nav-link">Board Templates</a></li>
                    <li><a href="../../getting_started/supported_devices.html" class="nav-link">Supported Devices</a></li>
                </ul>
            </li>

            <!-- User Guide Section -->
            <li class="nav-item">
                <div class="nav-category">User Guide <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../user_guide/index.html" class="nav-link">User Guide Overview</a></li>
                    <li><a href="../../user_guide/code_generation.html" class="nav-link">Code Generation</a></li>
                    <li><a href="../../user_guide/external_mode.html" class="nav-link">External Mode</a></li>
                </ul>
            </li>

            <!-- Block Reference Section -->
            <li class="nav-item">
                <div class="nav-category">Block Reference <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../block_reference/index.html" class="nav-link">Block Reference Overview</a></li>
                </ul>
            </li>

            <!-- Examples Section -->
            <li class="nav-item">
                <div class="nav-category">Examples <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../examples/field_weakening.html" class="nav-link">Field Weakening</a></li>
                </ul>
            </li>

            <!-- Release Notes -->
            <li class="nav-item">
                <a href="../../release_notes.html" class="nav-link">Release Notes</a>
            </li>
        </ul>
    </nav>

    <div class="doc-content-wrapper">
    <h1>UART TxMatlab Block</h1>

    
    <!-- Block Icon -->
    <div class="block-image">
        <img src="../assets/images/blocks/bus_uart/UART_TxMatlab.svg"
             alt="UART_TxMatlab Block Icon"
             onerror="this.onerror=null; this.src='../assets/images/blocks/bus_uart/UART_TxMatlab.png';">
        <div class="block-image-caption">
            UART_TxMatlab Block Icon
        </div>
    </div>
<h2>Block Description</h2>
    <p>The <strong>UART TxMatlab</strong> block transmits numerical data through UART to MATLAB (or alternative hosts) for real-time monitoring, plotting, and recording. This block supports multiple data types (int8, uint8, int16, uint16, int32, uint32, single, double) and implements a packetized protocol for reliable data streaming and visualization using the <strong>picgui</strong> MATLAB interface.</p>

    <div class="note">
        <strong>Tip:</strong> Use <code>picgui</code> at the MATLAB prompt to start a graphical user interface that receives, plots, and records data in real-time. This block is specifically designed for rapid prototyping and debugging.
    </div>

    <h2>Supported Device Families</h2>

    <table>
        <tr>
            <th>Family</th>
            <th>Series</th>
            <th>Architecture ID</th>
            <th>Implementation</th>
        </tr>
        <tr>
            <td><strong>dsPIC</strong></td>
            <td>30F, 24F, 33F, 33E, 33C, 33A</td>
            <td>1, 2, 3, 4, 8</td>
            <td>Same as UART Tx (PIC implementations)</td>
        </tr>
        <tr>
            <td><strong>PIC32</strong></td>
            <td>MK, MZ, MX, PIC32A</td>
            <td>Included in dsPIC arch</td>
            <td>Same as UART Tx (PIC implementations)</td>
        </tr>
        <tr>
            <td><strong>SAM E7x/S7x</strong></td>
            <td>SAME70, SAMS70, V71, PIC32CZ MC70</td>
            <td>5</td>
            <td>USART/UART variants (SAMx7)</td>
        </tr>
        <tr>
            <td><strong>SAM E5x/D5x</strong></td>
            <td>SAME5x, SAMD5x</td>
            <td>6</td>
            <td>SERCOM USART (SAMx5)</td>
        </tr>
        <tr>
            <td><strong>SAM C2x/D2x</strong></td>
            <td>SAMC2x, SAMD2x, SAMDA1</td>
            <td>7</td>
            <td>SERCOM USART (SAMx5 variant)</td>
        </tr>
    </table>

    <h2>Block Inputs</h2>

    <h3>Dynamic Channel Inputs</h3>
    <p>The number and labels of input ports are determined by the <strong>CHANNELS</strong> parameter. Each specified channel creates a corresponding input port.</p>

    <table>
        <tr>
            <th>Port Name</th>
            <th>Supported Data Types</th>
            <th>Description</th>
        </tr>
        <tr>
            <td><strong>CH 1</strong></td>
            <td>int8, uint8, int16, uint16, int32, uint32, single, double, boolean</td>
            <td>Channel 1 data (if channel 1 in CHANNELS)</td>
        </tr>
        <tr>
            <td><strong>CH 2</strong></td>
            <td>Same as above</td>
            <td>Channel 2 data (if channel 2 in CHANNELS)</td>
        </tr>
        <tr>
            <td><strong>...</strong></td>
            <td>Same as above</td>
            <td>Additional channels (up to 16)</td>
        </tr>
        <tr>
            <td><strong>CH 16</strong></td>
            <td>Same as above</td>
            <td>Channel 16 data (if channel 16 in CHANNELS)</td>
        </tr>
    </table>

    <div class="note">
        <strong>Vector Support:</strong> Each channel input can be a scalar or vector. The protocol automatically handles vector transmission with proper byte counts.
    </div>

    <h2>Configuration Parameters</h2>

    <h3>UART Selection</h3>
    <ul>
        <li><strong>UART Module</strong> - Select UART/USART number (must match UART Config block)</li>
        <li>Dropdown automatically populated with available UARTs from selected chip</li>
    </ul>

    <h3>Channel Configuration</h3>
    <table>
        <tr>
            <th>Parameter</th>
            <th>Format</th>
            <th>Description</th>
            <th>Example</th>
        </tr>
        <tr>
            <td>CHANNELS</td>
            <td>Vector [1 to 16]</td>
            <td>List of channel numbers to transmit</td>
            <td>[1 2 5] creates CH 1, CH 2, CH 5 inputs</td>
        </tr>
    </table>

    <h3>Transmission Options</h3>
    <table>
        <tr>
            <th>Parameter</th>
            <th>Options</th>
            <th>Description</th>
        </tr>
        <tr>
            <td>SampleTime</td>
            <td>Numeric (seconds)</td>
            <td>Block execution rate (affects bytes/step calculation)</td>
        </tr>
        <tr>
            <td>AllOrNothing</td>
            <td>On/Off checkbox</td>
            <td>Only transmit if entire packet can be sent</td>
        </tr>
    </table>

    <h2>Packet Protocol</h2>

    <h3>Data Packetization</h3>
    <p>Each channel is packetized with a control character followed by data bytes:</p>

    <h4>Control Character Format (8 bits)</h4>
    <table>
        <tr>
            <th>Bits</th>
            <th>Field</th>
            <th>Description</th>
        </tr>
        <tr>
            <td>0-1</td>
            <td>Signature</td>
            <td>Protocol signature (always <code>0b01</code> = 1)</td>
        </tr>
        <tr>
            <td>2-3</td>
            <td>Data Type</td>
            <td>0=int8/uint8, 1=int16/uint16, 2=int32/uint32, 3=single/double</td>
        </tr>
        <tr>
            <td>4-7</td>
            <td>Channel ID</td>
            <td>Channel number - 1 (0-15 for channels 1-16)</td>
        </tr>
    </table>

    <h4>Data Type Encoding</h4>
    <table>
        <tr>
            <th>Data Type</th>
            <th>Type Code</th>
            <th>Bytes Sent</th>
            <th>Notes</th>
        </tr>
        <tr>
            <td>int8 / uint8</td>
            <td>0</td>
            <td>1 (+1 control)</td>
            <td>8-bit integer</td>
        </tr>
        <tr>
            <td>int16 / uint16</td>
            <td>1</td>
            <td>2 (+1 control)</td>
            <td>16-bit integer</td>
        </tr>
        <tr>
            <td>int32 / uint32</td>
            <td>2</td>
            <td>4 (+1 control)</td>
            <td>32-bit integer</td>
        </tr>
        <tr>
            <td>single</td>
            <td>3</td>
            <td>4 (+1 control)</td>
            <td>32-bit float</td>
        </tr>
        <tr>
            <td>double (64-bit)</td>
            <td>3</td>
            <td>8 (+1 control)</td>
            <td>If doubleIs64Bits enabled</td>
        </tr>
        <tr>
            <td>double (32-bit)</td>
            <td>3</td>
            <td>4 (+1 control)</td>
            <td>If doubleIs64Bits disabled (default dsPIC)</td>
        </tr>
        <tr>
            <td>boolean</td>
            <td>0</td>
            <td>1 (+1 control)</td>
            <td>Treated as uint8</td>
        </tr>
    </table>

    <h3>Bytes Per Step Calculation</h3>
    <p>The block automatically calculates and displays transmission rate:</p>
    <code>
        BytesPerModelStep = TotalBytes × (FixedStep / SampleTime)
    </code>
    <ul>
        <li><strong>TotalBytes</strong>: Sum of all channel data bytes + control bytes</li>
        <li><strong>FixedStep</strong>: Model fixed-step size</li>
        <li><strong>SampleTime</strong>: Block sample time</li>
    </ul>

    <div class="warning">
        <strong>Performance Warning:</strong> High transmission rates (>1000 bytes/step) may cause buffer overruns. Use appropriate UART baud rate and buffer sizing.
    </div>

    <h2>Usage Examples</h2>

    <h3>Example 1: Simple 3-Channel Data Logger</h3>
    <ol>
        <li>Add <strong>UART Config</strong> block:
            <ul>
                <li>UART: 1</li>
                <li>Baud Rate: 115200</li>
                <li>Tx Implementation: Circular Buffer</li>
            </ul>
        </li>
        <li>Add <strong>UART TxMatlab</strong> block:
            <ul>
                <li>UART Module: 1</li>
                <li>CHANNELS: [1 2 3]</li>
                <li>SampleTime: 0.001 (1 kHz)</li>
                <li>AllOrNothing: Off</li>
            </ul>
        </li>
        <li>Connect inputs:
            <ul>
                <li>CH 1: Motor speed (int16)</li>
                <li>CH 2: Motor current (single)</li>
                <li>CH 3: Temperature (uint8)</li>
            </ul>
        </li>
        <li>In MATLAB, run: <code>picgui</code></li>
        <li>Select COM port, baud rate 115200, start acquisition</li>
        <li>Real-time plots appear for all 3 channels</li>
    </ol>

    <h3>Example 2: High-Speed Vector Transmission</h3>
    <ol>
        <li>Configure UART TxMatlab:
            <ul>
                <li>CHANNELS: [1]</li>
                <li>SampleTime: 0.0001 (10 kHz)</li>
            </ul>
        </li>
        <li>Connect CH 1 input to vector [100x1] of type single</li>
        <li>Block calculates:
            <ul>
                <li>Data bytes: 100 × 4 = 400 bytes</li>
                <li>Control byte: 1 byte</li>
                <li>Total: 401 bytes per execution</li>
                <li>If model step = 0.0001s: 401 bytes/step</li>
            </ul>
        </li>
        <li>Required baud rate: 401 × 8 × 10000 = 32 Mbps (needs high-speed UART)</li>
    </ol>

    <h3>Example 3: Mixed Data Type Monitoring</h3>
    <ol>
        <li>UART TxMatlab configuration:
            <ul>
                <li>CHANNELS: [1 2 5 10]</li>
                <li>SampleTime: 0.01 (100 Hz)</li>
            </ul>
        </li>
        <li>Input connections:
            <ul>
                <li>CH 1: Position setpoint (double)</li>
                <li>CH 2: Actual position (double)</li>
                <li>CH 5: Error (single)</li>
                <li>CH 10: Control mode (uint8)</li>
            </ul>
        </li>
        <li>picgui displays:
            <ul>
                <li>Channels 1 & 2: Position tracking plot</li>
                <li>Channel 5: Error magnitude plot</li>
                <li>Channel 10: Mode indicator</li>
            </ul>
        </li>
    </ol>

    <h2>picgui MATLAB Interface</h2>

    <h3>Starting picgui</h3>
    <code>
        >> picgui
    </code>
    <ul>
        <li>Opens graphical interface for UART data reception</li>
        <li>Supports COM port selection and baud rate configuration</li>
        <li>Real-time plotting of received channels</li>
        <li>Data recording to MATLAB workspace or file</li>
    </ul>

    <h3>picgui Features</h3>
    <ul>
        <li><strong>Multi-channel plotting</strong>: Up to 16 channels simultaneously</li>
        <li><strong>Data export</strong>: Save to .mat file or workspace variable</li>
        <li><strong>Auto-scaling</strong>: Automatic Y-axis scaling</li>
        <li><strong>Pause/Resume</strong>: Freeze display while maintaining reception</li>
        <li><strong>Clear buffer</strong>: Reset plots and data buffer</li>
    </ul>

    <h2>Implementation Details</h2>

    <h3>Control Character Generation</h3>
    <code>
        ControlChar = 1 + (DataTypeCode << 2) + (ChannelID << 4)
    </code>
    <p>Example: Channel 3, single precision (type 3):</p>
    <code>
        ControlChar = 1 + (3 << 2) + (2 << 4) = 1 + 12 + 32 = 45 (0x2D)
    </code>

    <h3>Transmission Implementation</h3>
    <p>The block uses the same transmission infrastructure as <strong>UART Tx</strong>:</p>
    <ul>
        <li>Reuses UART Tx implementation (bare, circular buffer, DMA)</li>
        <li>Adds packetization layer with control characters</li>
        <li>Thread protection identical to UART Tx</li>
        <li>Buffer management handled by UART Config settings</li>
    </ul>

    <h2>Troubleshooting</h2>

    <h3>No Data in picgui</h3>
    <p><strong>Problem:</strong> picgui runs but shows no data.<br>
    <strong>Solutions:</strong></p>
    <ul>
        <li>Verify COM port and baud rate match UART Config</li>
        <li>Check UART TX pin connection</li>
        <li>Ensure UART Config block exists</li>
        <li>Verify channels are correctly specified (1-16 range)</li>
    </ul>

    <h3>Corrupted Data / Garbled Plots</h3>
    <p><strong>Problem:</strong> picgui shows incorrect values or noise.<br>
    <strong>Solutions:</strong></p>
    <ul>
        <li>Check baud rate mismatch (must exactly match)</li>
        <li>Increase UART buffer size (high data rates)</li>
        <li>Enable "AllOrNothing" mode to prevent partial packets</li>
        <li>Reduce transmission rate (lower sample frequency or fewer channels)</li>
    </ul>

    <h3>Buffer Overrun Errors</h3>
    <p><strong>Problem:</strong> Data loss or transmission gaps.<br>
    <strong>Solutions:</strong></p>
    <ul>
        <li>Increase baud rate (e.g., 115200 → 921600)</li>
        <li>Reduce bytes/step (lower sample rate or reduce channels)</li>
        <li>Use DMA Ping-Pong mode (if available)</li>
        <li>Increase circular buffer size in UART Config</li>
        <li>Check "Bytes / Step" display on block - should be < buffer size</li>
    </ul>

    <h3>Wrong Data Type Displayed</h3>
    <p><strong>Problem:</strong> picgui shows incorrect data type interpretation.<br>
    <strong>Solutions:</strong></p>
    <ul>
        <li>Verify input signal data types match expected types</li>
        <li>Check double precision setting (doubleIs64Bits)</li>
        <li>Ensure control character calculation is correct</li>
        <li>Recompile model to update MCHP_COMPILED_INFO</li>
    </ul>

    <h2>Related Blocks</h2>
    <ul>
        <li><a href="uart_config.html">UART Config</a> - Configure UART module (required)</li>
        <li><a href="uart_tx.html">UART Tx</a> - Basic UART transmission</li>
        <li><a href="uart_rx.html">UART Rx</a> - Receive data</li>
        <li><a href="uart_brk_autobaud.html">UART Brk/Autobaud</a> - Break detection and autobaud</li>
    </ul>

    <h2>See Also</h2>
    <p>
        <a href="../communication.html">Communication Blocks</a> |
        <a href="uart_config.html">UART Config</a> |
        <a href="../../user_guide/external_mode.html">External Mode</a> |
        <a href="../../user_guide/code_generation.html">Code Generation</a>
    </p>

    </div>
</body>
</html>
