<!DOCTYPE html>
<html>
<head>
    <title>UART Config Block - MCHP Blockset</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../../assets/css/navigation.css">
    <script src="../../assets/js/navigation.js"></script>
</head>
<body>
    <!-- Mobile Navigation Toggle -->
    <button class="nav-toggle" aria-label="Toggle navigation">☰</button>

    <!-- Left Navigation Panel -->
    <nav class="doc-nav-container">
        <div class="doc-nav-header">
            <a href="../../index.html">MCHP Blockset Docs</a>
        </div>
        <ul class="doc-nav-menu">
            <li class="nav-item">
                <a href="../../index.html" class="nav-link">Home</a>
            </li>

            <!-- Getting Started Section -->
            <li class="nav-item">
                <div class="nav-category">Getting Started <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../getting_started/overview.html" class="nav-link">Overview</a></li>
                    <li><a href="../../getting_started/installation.html" class="nav-link">Installation</a></li>
                    <li><a href="../../getting_started/quick_start.html" class="nav-link">Quick Start</a></li>
                    <li><a href="../../getting_started/board_templates.html" class="nav-link">Board Templates</a></li>
                    <li><a href="../../getting_started/supported_devices.html" class="nav-link">Supported Devices</a></li>
                </ul>
            </li>

            <!-- User Guide Section -->
            <li class="nav-item">
                <div class="nav-category">User Guide <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../user_guide/index.html" class="nav-link">User Guide Overview</a></li>
                    <li><a href="../../user_guide/code_generation.html" class="nav-link">Code Generation</a></li>
                    <li><a href="../../user_guide/external_mode.html" class="nav-link">External Mode</a></li>
                </ul>
            </li>

            <!-- Block Reference Section -->
            <li class="nav-item">
                <div class="nav-category">Block Reference <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../block_reference/index.html" class="nav-link">Block Reference Overview</a></li>
                </ul>
            </li>

            <!-- Examples Section -->
            <li class="nav-item">
                <div class="nav-category">Examples <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../examples/field_weakening.html" class="nav-link">Field Weakening</a></li>
                </ul>
            </li>

            <!-- Release Notes -->
            <li class="nav-item">
                <a href="../../release_notes.html" class="nav-link">Release Notes</a>
            </li>
        </ul>
    </nav>

    <div class="doc-content-wrapper">
    <h1>UART Config Block</h1>

    
    <!-- Block Icon -->
    <div class="block-image">
        <img src="../assets/images/blocks/bus_uart/UART_Config.svg"
             alt="UART_Config Block Icon"
             onerror="this.onerror=null; this.src='../assets/images/blocks/bus_uart/UART_Config.png';">
        <div class="block-image-caption">
            UART_Config Block Icon
        </div>
    </div>
<h2>Block Description</h2>
    <p>The <strong>UART Config</strong> block configures a UART (Universal Asynchronous Receiver/Transmitter) module for serial communication. This block sets up baud rate, pin assignments, operating modes, and implementation methods for both transmit and receive operations.</p>

    <div class="note">
        <strong>Note:</strong> This is a configuration block only. Use with <strong>UART Tx</strong> and <strong>UART Rx</strong> blocks for actual data transmission and reception.
    </div>

    <h2>Supported Device Families</h2>

    <table>
        <tr>
            <th>Family</th>
            <th>Series</th>
            <th>Architecture ID</th>
            <th>Notes</th>
        </tr>
        <tr>
            <td><strong>dsPIC</strong></td>
            <td>30F, 24F, 33F, 33E, 33C, 33A</td>
            <td>1, 2, 3, 4, 8</td>
            <td>Full support including IrDA on capable devices</td>
        </tr>
        <tr>
            <td><strong>PIC32</strong></td>
            <td>MK, MZ, MX, PIC32A</td>
            <td>Included in dsPIC arch</td>
            <td>Standard UART functionality</td>
        </tr>
        <tr>
            <td><strong>SAM</strong></td>
            <td>E7x, E5x, D5x, C2x, D2x</td>
            <td>5, 6, 7</td>
            <td>USART peripheral (SAMx callback variants)</td>
        </tr>
    </table>

    <h2>Configuration Parameters</h2>

    <h3>UART Selection</h3>
    <ul>
        <li><strong>UART Module</strong> - Select UART/USART number (1 to N, depending on device)</li>
        <li>Number of available UARTs detected automatically from selected chip</li>
    </ul>

    <h3>Baud Rate Configuration</h3>
    <table>
        <tr>
            <th>Parameter</th>
            <th>Options</th>
            <th>Description</th>
        </tr>
        <tr>
            <td>Baud Rate Selection</td>
            <td>Popup list or Custom</td>
            <td>Choose from standard rates (110 to 12M baud) or enter custom value</td>
        </tr>
        <tr>
            <td>Standard Rates</td>
            <td>110, 300, 1200, 2400, 4800, 9600, 19200, 38400, 57600, 115200, ...</td>
            <td>Up to 12000000 baud on capable devices</td>
        </tr>
        <tr>
            <td>Custom Baud</td>
            <td>User-defined</td>
            <td>Enter any baud rate value (validated against FCY)</td>
        </tr>
        <tr>
            <td>Init Sequence Baud</td>
            <td>Same options</td>
            <td>Optional different baud rate for initialization sequence</td>
        </tr>
    </table>

    <h3>Operating Modes</h3>
    <table>
        <tr>
            <th>Mode</th>
            <th>Description</th>
            <th>Availability</th>
        </tr>
        <tr>
            <td><strong>Full Duplex</strong></td>
            <td>Default mode - independent Tx and Rx</td>
            <td>All devices</td>
        </tr>
        <tr>
            <td><strong>Half Duplex</strong></td>
            <td>One-wire Rx-Tx (shared pin)</td>
            <td>All devices</td>
        </tr>
        <tr>
            <td><strong>IrDA Mode</strong></td>
            <td>Infrared communication (requires IrDA encoder/decoder)</td>
            <td>Only on devices with UxMODE bit 12</td>
        </tr>
    </table>

    <div class="warning">
        <strong>Half-Duplex Mode:</strong> Forces both Tx and Rx to use Circular Buffer implementation.
    </div>

    <h3>Transmit (Tx) Implementation</h3>
    <table>
        <tr>
            <th>Mode</th>
            <th>Description</th>
            <th>Use Case</th>
        </tr>
        <tr>
            <td><strong>Do not implement Tx</strong></td>
            <td>No transmit capability</td>
            <td>Receive-only applications</td>
        </tr>
        <tr>
            <td><strong>Simplest</strong></td>
            <td>1, 4, or 8 byte internal buffer (device dependent)</td>
            <td>Low data rate, minimal overhead</td>
        </tr>
        <tr>
            <td><strong>Circular Buffer</strong></td>
            <td>Software circular buffer with interrupt</td>
            <td>Moderate data rate, reliable</td>
        </tr>
        <tr>
            <td><strong>DMA Ping-Pong</strong></td>
            <td>Two DMA buffers alternating</td>
            <td>High throughput, no data loss</td>
        </tr>
        <tr>
            <td><strong>DMA Circular Buffer</strong></td>
            <td>DMA with circular buffer</td>
            <td>Continuous streaming</td>
        </tr>
        <tr>
            <td><strong>DMA Single Buffer</strong></td>
            <td>Single DMA buffer (possible data loss)</td>
            <td>High speed, can tolerate data loss</td>
        </tr>
    </table>

    <h3>Receive (Rx) Implementation</h3>
    <table>
        <tr>
            <th>Mode</th>
            <th>Description</th>
            <th>Use Case</th>
        </tr>
        <tr>
            <td><strong>Do not implement Rx</strong></td>
            <td>No receive capability</td>
            <td>Transmit-only applications</td>
        </tr>
        <tr>
            <td><strong>Simplest</strong></td>
            <td>1, 4, or 8 byte internal buffer</td>
            <td>Low data rate polling</td>
        </tr>
        <tr>
            <td><strong>Circular Buffer</strong></td>
            <td>Software circular buffer with interrupt</td>
            <td>Reliable reception, moderate rate</td>
        </tr>
        <tr>
            <td><strong>DMA Ping-Pong</strong></td>
            <td>Two DMA buffers alternating</td>
            <td>High throughput reception</td>
        </tr>
    </table>

    <h3>Pin Configuration</h3>
    <ul>
        <li><strong>RX Pin</strong> - Receive data pin (remappable on PPS-capable devices)</li>
        <li><strong>TX Pin</strong> - Transmit data pin (remappable on PPS-capable devices)</li>
        <li><strong>CTS Pin</strong> - Clear To Send (hardware flow control, optional)</li>
        <li><strong>RTS Pin</strong> - Request To Send (hardware flow control, optional)</li>
        <li><strong>DTR Pin</strong> - Data Terminal Ready (dsPIC CK/33A only)</li>
        <li><strong>DSR Pin</strong> - Data Set Ready (dsPIC CK/33A only)</li>
    </ul>

    <div class="note">
        <strong>PPS (Peripheral Pin Select):</strong> On devices with PPS, pins are automatically configured using the MCHP_PORT mechanism. Legacy devices use fixed pin assignments.
    </div>

    <h3>Advanced Options</h3>
    <ul>
        <li><strong>Idle Time Control</strong> (dsPIC CK only) - Insert phantom bytes for idle time on Tx line</li>
        <li><strong>Initialization Sequence</strong> - Configure different settings at startup</li>
        <li><strong>External PIL Communication</strong> - Enable for Processor-in-the-Loop testing</li>
    </ul>

    <h2>Registers Configured</h2>

    <h3>dsPIC/PIC32 Registers</h3>
    <table>
        <tr>
            <th>Register</th>
            <th>Description</th>
            <th>Configured Fields</th>
        </tr>
        <tr>
            <td><code>U<em>x</em>BRG</code></td>
            <td>Baud Rate Generator</td>
            <td>Baud rate divisor (16-bit or 32-bit with BRGH)</td>
        </tr>
        <tr>
            <td><code>U<em>x</em>MODE</code></td>
            <td>Mode Control Register</td>
            <td>UARTEN, STSEL, PDSEL, BRGH, RXINV, ABAUD, LPBACK, WAKE, UEN, IREN, SIDL, etc.</td>
        </tr>
        <tr>
            <td><code>U<em>x</em>STA</code></td>
            <td>Status and Control Register</td>
            <td>UTXEN, URXEN, UTXISEL, URXISEL, ADDEN, UTXBRK, etc.</td>
        </tr>
        <tr>
            <td><code>U<em>x</em>BRGH</code></td>
            <td>Baud Rate High (extended chips)</td>
            <td>Upper 16 bits of baud rate divisor</td>
        </tr>
        <tr>
            <td><code>U<em>x</em>MODEH</code></td>
            <td>Mode High (dsPIC33A/CK)</td>
            <td>Extended mode bits</td>
        </tr>
        <tr>
            <td><code>U<em>x</em>STAH</code></td>
            <td>Status High (dsPIC33A/CK)</td>
            <td>Extended status/control bits</td>
        </tr>
    </table>

    <div class="note">
        <strong>Register Variants:</strong> Some dsPIC33A/CK devices use U<em>x</em>CON instead of U<em>x</em>MODE. The block handles this automatically based on chip detection.
    </div>

    <h3>SAM Registers (USART)</h3>
    <p>SAM devices use USART peripheral with different register structure:</p>
    <ul>
        <li><code>US_CR</code> - Control Register</li>
        <li><code>US_MR</code> - Mode Register</li>
        <li><code>US_BRGR</code> - Baud Rate Generator</li>
        <li><code>US_IER/IDR</code> - Interrupt Enable/Disable</li>
    </ul>

    <h2>Usage Example</h2>

    <h3>Basic UART Setup (9600 baud, Full Duplex)</h3>
    <ol>
        <li>Add <strong>UART Config</strong> block to model</li>
        <li>Configure parameters:
            <ul>
                <li>UART Module: 1</li>
                <li>Baud Rate: 9600</li>
                <li>Duplex Mode: Full duplex</li>
                <li>Tx Implementation: Circular Buffer</li>
                <li>Rx Implementation: Circular Buffer</li>
                <li>RX Pin: Select from dropdown (e.g., RP36/RB4)</li>
                <li>TX Pin: Select from dropdown (e.g., RP37/RB5)</li>
            </ul>
        </li>
        <li>Add <strong>UART Tx</strong> block (same UART number)</li>
        <li>Add <strong>UART Rx</strong> block (same UART number)</li>
        <li>Build and deploy</li>
    </ol>

    <h3>High-Speed UART with DMA (115200 baud)</h3>
    <ol>
        <li>Configure UART Config block:
            <ul>
                <li>Baud Rate: 115200</li>
                <li>Tx Implementation: DMA Ping-Pong Mode</li>
                <li>Rx Implementation: DMA Ping-Pong</li>
            </ul>
        </li>
        <li>Ensure DMA channels are available on selected device</li>
        <li>Configure buffer sizes in Tx/Rx blocks</li>
    </ol>

    <h2>Implementation Details</h2>

    <h3>Baud Rate Calculation</h3>
    <p>For dsPIC/PIC32 devices:</p>
    <code>
        UxBRG = (FCY / (4 * BaudRate)) - 1    (BRGH = 1)<br>
        UxBRG = (FCY / (16 * BaudRate)) - 1   (BRGH = 0)
    </code>

    <p>The block automatically selects BRGH mode for best accuracy.</p>

    <h3>Buffer Management</h3>
    <ul>
        <li><strong>Circular Buffer</strong>: Size configurable in Tx/Rx blocks, uses interrupts</li>
        <li><strong>DMA</strong>: Requires DMA-capable device, minimal CPU overhead</li>
        <li><strong>Ping-Pong</strong>: Two buffers alternate, prevents data loss during buffer swap</li>
    </ul>

    <h2>Related Blocks</h2>
    <ul>
        <li><a href="uart_tx.html">UART Tx</a> - Transmit data</li>
        <li><a href="uart_rx.html">UART Rx</a> - Receive data</li>
        <li><a href="uart_txmatlab.html">UART TxMatlab</a> - MATLAB interface for testing</li>
        <li><a href="uart_brk_autobaud.html">UART Brk/Autobaud</a> - Break detection and autobaud</li>
    </ul>

    <h2>Troubleshooting</h2>

    <h3>Baud Rate Error Too High</h3>
    <p><strong>Problem:</strong> Desired baud rate cannot be achieved with acceptable error.<br>
    <strong>Solution:</strong> Adjust system clock (FCY) or choose a different baud rate that divides evenly.</p>

    <h3>Pin Not Available</h3>
    <p><strong>Problem:</strong> Selected pin not available for UART function.<br>
    <strong>Solution:</strong> Check device datasheet for UART pin mapping. Ensure PPS is configured correctly on remappable devices.</p>

    <h3>DMA Not Working</h3>
    <p><strong>Problem:</strong> DMA mode selected but not functioning.<br>
    <strong>Solution:</strong> Verify device has DMA capability. Check DMA channel availability in model (other blocks may use DMA).</p>

    <h2>See Also</h2>
    <p>
        <a href="../communication.html">Communication Blocks</a> |
        <a href="uart_tx.html">UART Tx</a> |
        <a href="uart_rx.html">UART Rx</a> |
        <a href="../../user_guide/code_generation.html">Code Generation</a>
    </p>

    </div>
</body>
</html>
