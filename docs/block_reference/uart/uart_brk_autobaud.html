<!DOCTYPE html>
<html>
<head>
    <title>UART Break/Autobaud - MCHP Blockset</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../../assets/css/navigation.css">
    <script src="../../assets/js/navigation.js"></script>
</head>
<body>
    <!-- Mobile Navigation Toggle -->
    <button class="nav-toggle" aria-label="Toggle navigation">☰</button>

    <!-- Left Navigation Panel -->
    <nav class="doc-nav-container">
        <div class="doc-nav-header">
            <a href="../../index.html">MCHP Blockset Docs</a>
        </div>
        <ul class="doc-nav-menu">
            <li class="nav-item">
                <a href="../../index.html" class="nav-link">Home</a>
            </li>

            <!-- Getting Started Section -->
            <li class="nav-item">
                <div class="nav-category">Getting Started <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../getting_started/overview.html" class="nav-link">Overview</a></li>
                    <li><a href="../../getting_started/installation.html" class="nav-link">Installation</a></li>
                    <li><a href="../../getting_started/quick_start.html" class="nav-link">Quick Start</a></li>
                    <li><a href="../../getting_started/board_templates.html" class="nav-link">Board Templates</a></li>
                    <li><a href="../../getting_started/supported_devices.html" class="nav-link">Supported Devices</a></li>
                </ul>
            </li>

            <!-- User Guide Section -->
            <li class="nav-item">
                <div class="nav-category">User Guide <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../user_guide/index.html" class="nav-link">User Guide Overview</a></li>
                    <li><a href="../../user_guide/code_generation.html" class="nav-link">Code Generation</a></li>
                    <li><a href="../../user_guide/external_mode.html" class="nav-link">External Mode</a></li>
                </ul>
            </li>

            <!-- Block Reference Section -->
            <li class="nav-item">
                <div class="nav-category">Block Reference <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../block_reference/index.html" class="nav-link">Block Reference Overview</a></li>
                </ul>
            </li>

            <!-- Examples Section -->
            <li class="nav-item">
                <div class="nav-category">Examples <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../examples/field_weakening.html" class="nav-link">Field Weakening</a></li>
                </ul>
            </li>

            <!-- Release Notes -->
            <li class="nav-item">
                <a href="../../release_notes.html" class="nav-link">Release Notes</a>
            </li>
        </ul>
    </nav>

    <div class="doc-content-wrapper">
    <h1>UART Break and Auto-Baud Features</h1>

    <div class="info">
        <strong>Note:</strong> This page documents UART Break and Auto-Baud hardware features available on Microchip devices. These features may be configured through the <strong>UART Config</strong> block or accessed via direct register configuration.
    </div>

    
    <!-- Block Icon -->
    <div class="block-image">
        <img src="../assets/images/blocks/bus_uart/UART_Brk_Autobaud.svg"
             alt="UART_Brk_Autobaud Block Icon"
             onerror="this.onerror=null; this.src='../assets/images/blocks/bus_uart/UART_Brk_Autobaud.png';">
        <div class="block-image-caption">
            UART_Brk_Autobaud Block Icon
        </div>
    </div>
<h2>Overview</h2>
    <p>Microchip UART modules support advanced communication features including <strong>Break character transmission/detection</strong> and <strong>Auto-Baud rate detection</strong>. These features enable robust communication in systems where baud rates are unknown or need synchronization, and provide special signaling capabilities for protocol implementations.</p>

    <h2>Supported Device Families</h2>

    <table>
        <tr>
            <th>Family</th>
            <th>Series</th>
            <th>Break Support</th>
            <th>Auto-Baud Support</th>
        </tr>
        <tr>
            <td><strong>dsPIC30F</strong></td>
            <td>30F series</td>
            <td>Yes (basic)</td>
            <td>Yes (basic)</td>
        </tr>
        <tr>
            <td><strong>dsPIC33F/E/C</strong></td>
            <td>33F, 33E, 33C series</td>
            <td>Yes (standard)</td>
            <td>Yes (standard)</td>
        </tr>
        <tr>
            <td><strong>dsPIC33A</strong></td>
            <td>33A, 33AK series</td>
            <td>Yes (enhanced with configurable detection)</td>
            <td>Yes (enhanced with overflow detection)</td>
        </tr>
        <tr>
            <td><strong>PIC32</strong></td>
            <td>MK, MZ, MX</td>
            <td>Yes</td>
            <td>Yes</td>
        </tr>
        <tr>
            <td><strong>SAM</strong></td>
            <td>E7x, E5x, C2x, D2x</td>
            <td>Device-dependent</td>
            <td>Device-dependent</td>
        </tr>
    </table>

    <h2>Break Character Feature</h2>

    <h3>What is a Break Character?</h3>
    <p>A <strong>Break character</strong> is a special UART signal consisting of a continuous low (or high if polarity inverted) state for an extended period - typically 11 to 13 bit times. It's used for:</p>
    <ul>
        <li>Communication synchronization and initialization</li>
        <li>Protocol signaling (LIN, DMX512, etc.)</li>
        <li>Error recovery and attention signaling</li>
        <li>Multi-drop bus addressing</li>
    </ul>

    <h3>Break Transmission</h3>

    <h4>Method 1: Automatic Break (SENDB)</h4>
    <p>Set the <code>SENDB</code> bit (UxCON[8]) and write any value to UxTXB:</p>
    <code>
        U1CON |= 0x0100;  // Set SENDB bit<br>
        U1TXB = 0x00;     // Trigger Break transmission (value ignored)<br>
        // Break (13 bit times) is sent, followed by UxTXB contents
    </code>

    <h4>Method 2: Manual Override (BRKOVR)</h4>
    <p>Use <code>BRKOVR</code> bit (UxCON[9]) for custom-duration Break:</p>
    <code>
        U1CON |= 0x0200;  // Set BRKOVR - manually drive TX line<br>
        // TX line driven low (if TXPOL=0) or high (if TXPOL=1)<br>
        delay_us(break_duration);<br>
        U1CON &= ~0x0200; // Clear BRKOVR - release TX line
    </code>
    <ul>
        <li><strong>TXPOL=0</strong>: TX line driven LOW</li>
        <li><strong>TXPOL=1</strong>: TX line driven HIGH</li>
        <li>Any duration possible (not limited to 13 bit times)</li>
    </ul>

    <h3>Break Reception/Detection</h3>

    <p>The UART continuously monitors for Break sequences, even during normal reception:</p>

    <h4>Detection Modes (RXBIMD bit)</h4>
    <table>
        <tr>
            <th>RXBIMD</th>
            <th>Detection Criteria</th>
            <th>RXBKIF Flag Sets When...</th>
        </tr>
        <tr>
            <td><strong>0</strong> (default)</td>
            <td>End-of-Break detection</td>
            <td>Line transitions LOW→HIGH after ≥11 bit times low</td>
        </tr>
        <tr>
            <td><strong>1</strong></td>
            <td>Start-of-Break detection</td>
            <td>11th consecutive low bit time detected</td>
        </tr>
    </table>

    <h4>Break Interrupt Configuration</h4>
    <code>
        // Enable Break detection interrupt<br>
        U1STAT |= 0x0400;  // Set RXBKIE bit (UxSTAT[10])<br>
        <br>
        // In ISR, check Break flag<br>
        if (U1STAT & 0x0004) {  // RXBKIF bit (UxSTAT[2])<br>
        &nbsp;&nbsp;&nbsp;&nbsp;// Break detected - handle protocol<br>
        &nbsp;&nbsp;&nbsp;&nbsp;U1STAT &= ~0x0004;  // Clear RXBKIF flag<br>
        }
    </code>

    <h2>Auto-Baud Feature</h2>

    <h3>What is Auto-Baud?</h3>
    <p><strong>Auto-Baud</strong> (Automatic Baud Rate Detection) allows the UART receiver to automatically determine and synchronize to the transmitter's baud rate without prior configuration. This is essential for:</p>
    <ul>
        <li>Systems where baud rate is unknown at startup</li>
        <li>Multi-device communication with varying speeds</li>
        <li>Plug-and-play serial interfaces</li>
        <li>LIN bus and other automotive protocols</li>
    </ul>

    <h3>Auto-Baud Detection Process</h3>

    <h4>Step 1: Transmitter Sends Sync Byte</h4>
    <p>Transmitter sends <code>0x55</code> (binary: <code>0b01010101</code>) - alternating bit pattern:</p>
    <code>
        // Transmitter (known baud rate)<br>
        U1TXB = 0x55;  // Sync byte for auto-baud
    </code>

    <h4>Step 2: Receiver Enables Auto-Baud</h4>
    <code>
        // Receiver (unknown baud rate)<br>
        U1CON |= 0x0040;  // Set ABDEN bit (UxCON[6])<br>
        // UART state machine enters Idle, waiting for Start bit
    </code>

    <h4>Step 3: Automatic BRG Calculation</h4>
    <p>On detecting the Start bit of 0x55, the UART:</p>
    <ol>
        <li>Counts BRG clock cycles between 5 falling edges (0x55 pattern)</li>
        <li>Calculates average bit time</li>
        <li>Writes appropriate value to UxBRG register</li>
        <li>Clears ABDEN bit (hardware auto-clear)</li>
        <li>Sets ABDIF flag (UxUIR[6])</li>
    </ol>

    <div class="note">
        <strong>Note:</strong> The Sync byte (0x55) is NOT stored in the receive buffer. It is consumed by the auto-baud process.
    </div>

    <h4>Step 4: Completion Handling</h4>
    <code>
        // Check auto-baud completion<br>
        if (U1UIR & 0x0040) {  // ABDIF flag (UxUIR[6])<br>
        &nbsp;&nbsp;&nbsp;&nbsp;// Auto-baud successful<br>
        &nbsp;&nbsp;&nbsp;&nbsp;calculated_baud = FCY / (4 * (U1BRG + 1));  // If BRGH=1<br>
        &nbsp;&nbsp;&nbsp;&nbsp;U1UIR &= ~0x0040;  // Clear ABDIF flag<br>
        }
    </code>

    <h3>Auto-Baud with Break Preamble</h3>
    <p>The Sync byte (0x55) may optionally be preceded by a Break character for additional synchronization:</p>
    <code>
        // Transmitter sequence<br>
        U1CON |= 0x0100;  // Set SENDB<br>
        U1TXB = 0x55;     // Send Break followed by Sync byte
    </code>

    <h3>Error Handling: BRG Overflow</h3>
    <p>If the 5th falling edge is not detected before BRG counter rolls over:</p>
    <ul>
        <li><strong>ABDOVIF</strong> flag (UxSTAT[5]) sets - indicates overflow</li>
        <li>ABDOVIF cannot be cleared until ABDEN is cleared</li>
        <li>If <strong>ABDOVIE</strong> bit (UxSTAT[13]) set → error interrupt generated</li>
    </ul>

    <h3>Supported Baud Rate Modes</h3>
    <p>Auto-baud works in both baud rate generation modes:</p>
    <ul>
        <li><strong>Legacy Mode</strong> (CLKMOD=1): Standard BRG calculation</li>
        <li><strong>Fractional Mode</strong> (CLKMOD=0): Enhanced fractional BRG</li>
    </ul>

    <h2>Register Summary</h2>

    <h3>UxCON (Mode Control Register)</h3>
    <table>
        <tr>
            <th>Bit</th>
            <th>Name</th>
            <th>Function</th>
        </tr>
        <tr>
            <td>6</td>
            <td>ABDEN</td>
            <td>Auto-Baud Enable (set to start, cleared by hardware when done)</td>
        </tr>
        <tr>
            <td>8</td>
            <td>SENDB</td>
            <td>Send Break (13-bit Break + UxTXB contents)</td>
        </tr>
        <tr>
            <td>9</td>
            <td>BRKOVR</td>
            <td>Break Override (manual TX line control)</td>
        </tr>
        <tr>
            <td>11</td>
            <td>RXBIMD</td>
            <td>RX Break Interrupt Mode (0=end detect, 1=start detect)</td>
        </tr>
        <tr>
            <td>18</td>
            <td>TXPOL</td>
            <td>TX Polarity (affects BRKOVR line state)</td>
        </tr>
    </table>

    <h3>UxSTAT (Status Register)</h3>
    <table>
        <tr>
            <th>Bit</th>
            <th>Name</th>
            <th>Function</th>
        </tr>
        <tr>
            <td>2</td>
            <td>RXBKIF</td>
            <td>RX Break Interrupt Flag (cleared by software)</td>
        </tr>
        <tr>
            <td>5</td>
            <td>ABDOVIF</td>
            <td>Auto-Baud Overflow Flag (BRG rollover during detection)</td>
        </tr>
        <tr>
            <td>10</td>
            <td>RXBKIE</td>
            <td>RX Break Interrupt Enable</td>
        </tr>
        <tr>
            <td>13</td>
            <td>ABDOVIE</td>
            <td>Auto-Baud Overflow Interrupt Enable</td>
        </tr>
    </table>

    <h3>UxUIR (UART Interrupt Register)</h3>
    <table>
        <tr>
            <th>Bit</th>
            <th>Name</th>
            <th>Function</th>
        </tr>
        <tr>
            <td>2</td>
            <td>ABDIE</td>
            <td>Auto-Baud Detection Interrupt Enable</td>
        </tr>
        <tr>
            <td>6</td>
            <td>ABDIF</td>
            <td>Auto-Baud Detection Interrupt Flag (set when complete)</td>
        </tr>
    </table>

    <h2>Application Examples</h2>

    <h3>Example 1: LIN Bus Communication</h3>
    <p>LIN (Local Interconnect Network) uses Break + Sync pattern:</p>
    <code>
        // Master node - send LIN Break field<br>
        U1CON |= 0x0100;  // SENDB=1<br>
        U1TXB = 0x55;     // Break (≥13 bits) + Sync byte (0x55)<br>
        <br>
        // Slave node - detect Break and auto-baud<br>
        U1STAT |= 0x0400;  // RXBKIE=1 (enable Break interrupt)<br>
        <br>
        // In ISR<br>
        if (U1STAT & 0x0004) {  // RXBKIF=1<br>
        &nbsp;&nbsp;&nbsp;&nbsp;U1CON |= 0x0040;  // ABDEN=1 (enable auto-baud)<br>
        &nbsp;&nbsp;&nbsp;&nbsp;U1STAT &= ~0x0004;  // Clear RXBKIF<br>
        }
    </code>

    <h3>Example 2: DMX512 Protocol</h3>
    <p>DMX512 uses Break for frame start signaling:</p>
    <code>
        // Send DMX Break (Mark-After-Break timing)<br>
        U1CON |= 0x0200;  // BRKOVR=1<br>
        delay_us(88);     // Break: 88-1000 μs<br>
        U1CON &= ~0x0200; // BRKOVR=0<br>
        delay_us(8);      // MAB: 8-1000 μs<br>
        U1TXB = 0x00;     // Start code
    </code>

    <h3>Example 3: Unknown Baud Rate Detection</h3>
    <code>
        // Receiver with unknown baud rate<br>
        void uart_autobaud_init(void) {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;U1CON |= 0x0040;  // ABDEN=1<br>
        &nbsp;&nbsp;&nbsp;&nbsp;U1UIR |= 0x0004;  // ABDIE=1 (enable interrupt)<br>
        &nbsp;&nbsp;&nbsp;&nbsp;// Wait for transmitter to send 0x55<br>
        }<br>
        <br>
        void __attribute__((__interrupt__, auto_psv)) _U1EventInterrupt(void) {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;if (U1UIR & 0x0040) {  // ABDIF=1<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Auto-baud complete, BRG configured<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uart_ready = 1;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;U1UIR &= ~0x0040;  // Clear ABDIF<br>
        &nbsp;&nbsp;&nbsp;&nbsp;}<br>
        &nbsp;&nbsp;&nbsp;&nbsp;IFS4bits.U1EIF = 0;  // Clear interrupt flag<br>
        }
    </code>

    <h2>Configuration in MCHP Blockset</h2>

    <p>While a dedicated Break/Autobaud block may be available, these features are typically configured through:</p>
    <ul>
        <li><strong>UART Config block</strong> - Auto-baud enable option (device-dependent)</li>
        <li><strong>Direct register access</strong> - Use embedded code blocks for manual configuration</li>
        <li><strong>S-Function blocks</strong> - Custom implementations for protocol-specific needs</li>
    </ul>

    <div class="warning">
        <strong>Important:</strong> Not all UART implementations support all Break/Autobaud features. Check device datasheet for specific capabilities (UxCON, UxSTAT register availability).
    </div>

    <h2>Troubleshooting</h2>

    <h3>Auto-Baud Not Working</h3>
    <p><strong>Problem:</strong> ABDEN set but no auto-baud completion.<br>
    <strong>Solutions:</strong></p>
    <ul>
        <li>Verify transmitter sends exactly 0x55 (alternating bit pattern)</li>
        <li>Check UART clock source (FUART) is correct</li>
        <li>Ensure no framing errors (check FERR flag)</li>
        <li>Verify ABDOVIF flag - if set, BRG rolled over (increase clock speed or lower baud range)</li>
    </ul>

    <h3>Break Not Detected</h3>
    <p><strong>Problem:</strong> Break sent but RXBKIF never sets.<br>
    <strong>Solutions:</strong></p>
    <ul>
        <li>Check Break duration ≥11 bit times (use oscilloscope)</li>
        <li>Verify RXBIMD setting matches detection criteria needed</li>
        <li>Ensure UART RX pin correctly configured</li>
        <li>Check line polarity (RXPOL bit if available)</li>
    </ul>

    <h3>Incorrect Baud Rate After Auto-Baud</h3>
    <p><strong>Problem:</strong> Auto-baud completes but calculated rate is wrong.<br>
    <strong>Solutions:</strong></p>
    <ul>
        <li>Verify peripheral clock (FCY/FUART) setting</li>
        <li>Check BRGH and CLKMOD bit settings</li>
        <li>Ensure Sync byte 0x55 transmitted correctly (verify with logic analyzer)</li>
        <li>Read UxBRG value after auto-baud to debug calculation</li>
    </ul>

    <h2>Related Documentation</h2>
    <ul>
        <li><a href="uart_config.html">UART Config</a> - Configure UART module</li>
        <li><a href="uart_tx.html">UART Tx</a> - Transmit data</li>
        <li><a href="uart_rx.html">UART Rx</a> - Receive data</li>
        <li>Device Datasheet - Detailed UART register descriptions</li>
        <li>LIN 2.2 Specification - LIN protocol implementation</li>
        <li>DMX512 Standard - DMX protocol timing requirements</li>
    </ul>

    <h2>See Also</h2>
    <p>
        <a href="../communication.html">Communication Blocks</a> |
        <a href="uart_config.html">UART Config</a> |
        <a href="../../user_guide/code_generation.html">Code Generation</a>
    </p>

    </div>
</body>
</html>
