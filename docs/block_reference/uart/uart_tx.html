<!DOCTYPE html>
<html>
<head>
    <title>UART Tx Block - MCHP Blockset</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../../assets/css/navigation.css">
    <script src="../../assets/js/navigation.js"></script>
</head>
<body>
    <!-- Mobile Navigation Toggle -->
    <button class="nav-toggle" aria-label="Toggle navigation">☰</button>

    <!-- Left Navigation Panel -->
    <nav class="doc-nav-container">
        <div class="doc-nav-header">
            <a href="../../index.html">MCHP Blockset Docs</a>
        </div>
        <ul class="doc-nav-menu">
            <li class="nav-item">
                <a href="../../index.html" class="nav-link">Home</a>
            </li>

            <!-- Getting Started Section -->
            <li class="nav-item">
                <div class="nav-category">Getting Started <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../getting_started/overview.html" class="nav-link">Overview</a></li>
                    <li><a href="../../getting_started/installation.html" class="nav-link">Installation</a></li>
                    <li><a href="../../getting_started/quick_start.html" class="nav-link">Quick Start</a></li>
                    <li><a href="../../getting_started/board_templates.html" class="nav-link">Board Templates</a></li>
                    <li><a href="../../getting_started/supported_devices.html" class="nav-link">Supported Devices</a></li>
                </ul>
            </li>

            <!-- User Guide Section -->
            <li class="nav-item">
                <div class="nav-category">User Guide <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../user_guide/index.html" class="nav-link">User Guide Overview</a></li>
                    <li><a href="../../user_guide/code_generation.html" class="nav-link">Code Generation</a></li>
                    <li><a href="../../user_guide/external_mode.html" class="nav-link">External Mode</a></li>
                </ul>
            </li>

            <!-- Block Reference Section -->
            <li class="nav-item">
                <div class="nav-category">Block Reference <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../block_reference/index.html" class="nav-link">Block Reference Overview</a></li>
                </ul>
            </li>

            <!-- Examples Section -->
            <li class="nav-item">
                <div class="nav-category">Examples <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../examples/field_weakening.html" class="nav-link">Field Weakening</a></li>
                </ul>
            </li>

            <!-- Release Notes -->
            <li class="nav-item">
                <a href="../../release_notes.html" class="nav-link">Release Notes</a>
            </li>
        </ul>
    </nav>

    <div class="doc-content-wrapper">
    <h1>UART Tx Block</h1>

    
    <!-- Block Icon -->
    <div class="block-image">
        <img src="../assets/images/blocks/bus_uart/UART_Tx.svg"
             alt="UART_Tx Block Icon"
             onerror="this.onerror=null; this.src='../assets/images/blocks/bus_uart/UART_Tx.png';">
        <div class="block-image-caption">
            UART_Tx Block Icon
        </div>
    </div>
<h2>Block Description</h2>
    <p>The <strong>UART Tx</strong> block transmits data through a configured UART module. This block sends 8-bit data (uint8 type) and supports variable-length transmission with optional feedback on bytes sent. It works in conjunction with the <strong>UART Config</strong> block to provide flexible, efficient serial transmission.</p>

    <div class="note">
        <strong>Note:</strong> Use <code>picgui</code> at the MATLAB prompt in "raw" mode to receive this data with MATLAB for testing and debugging.
    </div>

    <h2>Supported Device Families</h2>

    <table>
        <tr>
            <th>Family</th>
            <th>Series</th>
            <th>Architecture ID</th>
            <th>Implementation Files</th>
        </tr>
        <tr>
            <td><strong>dsPIC</strong></td>
            <td>30F, 24F, 33F, 33E, 33C, 33A</td>
            <td>1, 2, 3, 4, 8</td>
            <td>PIC bare, Interrupt, DMA variants</td>
        </tr>
        <tr>
            <td><strong>PIC32</strong></td>
            <td>MK, MZ, MX, PIC32A</td>
            <td>Included in dsPIC arch</td>
            <td>Same as dsPIC (PIC implementations)</td>
        </tr>
        <tr>
            <td><strong>SAM E7x/S7x</strong></td>
            <td>SAME70, SAMS70, V71, PIC32CZ MC70</td>
            <td>5</td>
            <td>SAMx7 bare, Interrupt, DMA ping-pong</td>
        </tr>
        <tr>
            <td><strong>SAM E5x/D5x</strong></td>
            <td>SAME5x, SAMD5x</td>
            <td>6</td>
            <td>SAMx5 bare, Interrupt, DMA ping-pong</td>
        </tr>
        <tr>
            <td><strong>SAM C2x/D2x</strong></td>
            <td>SAMC2x, SAMD2x, SAMDA1</td>
            <td>7</td>
            <td>SAMx5 implementations (shared)</td>
        </tr>
    </table>

    <h2>Block Inputs and Outputs</h2>

    <h3>Inputs</h3>
    <table>
        <tr>
            <th>Port Name</th>
            <th>Data Type</th>
            <th>Description</th>
            <th>Optional</th>
        </tr>
        <tr>
            <td><strong>N</strong></td>
            <td>uint8/uint16</td>
            <td>Number of bytes to send (variable length mode)</td>
            <td>Yes (enable via parameter)</td>
        </tr>
        <tr>
            <td><strong>Tx</strong></td>
            <td>uint8 (vector or scalar)</td>
            <td>Data to transmit</td>
            <td>No (always present)</td>
        </tr>
        <tr>
            <td><strong>$</strong></td>
            <td>any</td>
            <td>Function-Call input (triggers execution)</td>
            <td>Yes (based on ordering)</td>
        </tr>
    </table>

    <h3>Outputs</h3>
    <table>
        <tr>
            <th>Port Name</th>
            <th>Data Type</th>
            <th>Description</th>
            <th>Optional</th>
        </tr>
        <tr>
            <td><strong>N</strong></td>
            <td>uint8/uint16</td>
            <td>Number of bytes actually sent</td>
            <td>Yes (enable via parameter)</td>
        </tr>
        <tr>
            <td><strong>$</strong></td>
            <td>function-call</td>
            <td>Function-Call output (execution chain)</td>
            <td>Yes (based on ordering)</td>
        </tr>
    </table>

    <h2>Configuration Parameters</h2>

    <h3>UART Selection</h3>
    <ul>
        <li><strong>UART Module</strong> - Select UART/USART number (must match UART Config block)</li>
        <li>Dropdown automatically populated with available UARTs from selected chip</li>
    </ul>

    <h3>Data Transmission Options</h3>
    <table>
        <tr>
            <th>Parameter</th>
            <th>Options</th>
            <th>Description</th>
        </tr>
        <tr>
            <td>NSend Input</td>
            <td>On/Off checkbox</td>
            <td>Enable 'N' input port for variable-length transmission</td>
        </tr>
        <tr>
            <td>NSend Output</td>
            <td>On/Off checkbox</td>
            <td>Enable 'N' output port (bytes actually sent)</td>
        </tr>
        <tr>
            <td>UART String Mode</td>
            <td>On/Off checkbox</td>
            <td>When enabled: '0' (null character) marks end of string</td>
        </tr>
        <tr>
            <td>All or Nothing</td>
            <td>On/Off checkbox</td>
            <td>Only transmit if entire buffer can be sent (no partial sends)</td>
        </tr>
    </table>

    <h2>Implementation Modes</h2>

    <p>Transmission behavior depends on the implementation mode selected in the <strong>UART Config</strong> block:</p>

    <table>
        <tr>
            <th>Mode ID</th>
            <th>Implementation</th>
            <th>Description</th>
            <th>Thread Protection</th>
        </tr>
        <tr>
            <td>1</td>
            <td><strong>Bare (Simplest)</strong></td>
            <td>Direct write to hardware FIFO (1/4/8 bytes)</td>
            <td>Optional delay protection</td>
        </tr>
        <tr>
            <td>2</td>
            <td><strong>Circular Buffer</strong></td>
            <td>Software buffer with interrupt-driven transmission</td>
            <td>Critical section protection</td>
        </tr>
        <tr>
            <td>3</td>
            <td><strong>DMA Ping-Pong</strong></td>
            <td>Two DMA buffers alternating (no data loss)</td>
            <td>DMA channel management</td>
        </tr>
        <tr>
            <td>4</td>
            <td><strong>DMA Single Buffer</strong></td>
            <td>Single DMA buffer (possible data loss if full)</td>
            <td>DMA channel management</td>
        </tr>
        <tr>
            <td>5</td>
            <td><strong>DMA Circular Buffer</strong></td>
            <td>DMA with circular buffer (same as mode 2)</td>
            <td>Critical section protection</td>
        </tr>
    </table>

    <h3>Thread Protection</h3>
    <p>The block provides configurable thread protection for multitasking environments:</p>
    <ul>
        <li><strong>Bit 0</strong>: Delay protection for tasks</li>
        <li><strong>Bit 1</strong>: Don't send from tasks</li>
        <li><strong>Bit 2-3</strong>: Same for asynchronous interrupts</li>
        <li><strong>Common Values</strong>:
            <ul>
                <li><code>0x1</code>: Delay task, don't care interrupts</li>
                <li><code>0x5</code>: Delay all interrupts</li>
                <li><code>0x9</code>: Delay task, don't send on interrupts</li>
                <li><code>0xA</code>: Don't send (disabled)</li>
            </ul>
        </li>
    </ul>

    <h2>Usage Examples</h2>

    <h3>Basic Transmission (Fixed Length)</h3>
    <ol>
        <li>Add <strong>UART Config</strong> block (configure for UART 1, Circular Buffer Tx)</li>
        <li>Add <strong>UART Tx</strong> block</li>
        <li>Configure UART Tx:
            <ul>
                <li>UART Module: 1</li>
                <li>NSend Input: Off</li>
                <li>NSend Output: Off</li>
                <li>UART String Mode: Off</li>
                <li>All or Nothing: Off</li>
            </ul>
        </li>
        <li>Connect uint8 vector [5x1] to Tx input</li>
        <li>Build and deploy</li>
    </ol>

    <h3>Variable Length String Transmission</h3>
    <ol>
        <li>Configure UART Tx block:
            <ul>
                <li>NSend Input: On</li>
                <li>NSend Output: On (monitor bytes sent)</li>
                <li>UART String Mode: On</li>
                <li>All or Nothing: Off</li>
            </ul>
        </li>
        <li>Connect N input with dynamic length (e.g., from lookup table)</li>
        <li>Connect Tx input with uint8 buffer [maxSize x 1]</li>
        <li>Monitor N output to verify transmission</li>
    </ol>

    <h3>High-Reliability Transmission (DMA Ping-Pong)</h3>
    <ol>
        <li>UART Config: Select "DMA Ping-Pong Mode" for Tx</li>
        <li>UART Tx: Enable "All or Nothing" mode</li>
        <li>Connect fixed-size data packets</li>
        <li>Result: No partial transmissions, guaranteed delivery</li>
    </ol>

    <h2>Implementation Details</h2>

    <h3>Bare Mode (Mode 1)</h3>
    <p>Writes directly to hardware FIFO:</p>
    <code>
        U%<UARTRef>TXREG = data[i];  /* Direct write to transmit register */
    </code>
    <ul>
        <li>No buffering - immediate transmission</li>
        <li>Limited to hardware FIFO size (1/4/8 bytes)</li>
        <li>Fastest response, lowest overhead</li>
    </ul>

    <h3>Circular Buffer (Mode 2 & 5)</h3>
    <ul>
        <li>Software buffer with head/tail pointers</li>
        <li>Interrupt-driven: TX interrupt sends next byte when ready</li>
        <li>Buffer size configurable in UART Config block</li>
        <li>Thread-safe with critical section protection</li>
    </ul>

    <h3>DMA Modes (Mode 3 & 4)</h3>
    <ul>
        <li><strong>Ping-Pong</strong>: Two buffers alternate (buffer A → DMA → buffer B → DMA...)</li>
        <li><strong>Single Buffer</strong>: One buffer (faster but can lose data if full)</li>
        <li>DMA channel automatically configured</li>
        <li>Minimal CPU overhead during transmission</li>
    </ul>

    <h2>Error Handling</h2>

    <h3>Missing UART Config Block</h3>
    <p>If no UART Config block is found for the selected UART:</p>
    <ul>
        <li>Block display shows "MISSING UART X Config"</li>
        <li>Warning printed to console</li>
        <li>Compilation error: "UART TX is not configured"</li>
    </ul>

    <h3>Buffer Overflow</h3>
    <ul>
        <li><strong>Circular Buffer</strong>: New data discarded if buffer full</li>
        <li><strong>DMA Single</strong>: Data lost if DMA busy</li>
        <li><strong>DMA Ping-Pong</strong>: Always accepts data (switches buffers)</li>
        <li><strong>All or Nothing</strong>: Entire packet rejected if insufficient space</li>
    </ul>

    <h2>Related Blocks</h2>
    <ul>
        <li><a href="uart_config.html">UART Config</a> - Configure UART module (required)</li>
        <li><a href="uart_rx.html">UART Rx</a> - Receive data</li>
        <li><a href="uart_txmatlab.html">UART TxMatlab</a> - MATLAB interface for testing</li>
        <li><a href="uart_brk_autobaud.html">UART Brk/Autobaud</a> - Break detection and autobaud</li>
    </ul>

    <h2>Troubleshooting</h2>

    <h3>Data Not Transmitting</h3>
    <p><strong>Problem:</strong> UART Tx block present but no data on TX line.<br>
    <strong>Solutions:</strong></p>
    <ul>
        <li>Verify UART Config block exists for same UART number</li>
        <li>Check TX pin configuration in UART Config block</li>
        <li>Verify UART enable (UARTEN bit)</li>
        <li>Check baud rate matches receiver</li>
    </ul>

    <h3>Partial Data Loss</h3>
    <p><strong>Problem:</strong> Some bytes missing from transmission.<br>
    <strong>Solutions:</strong></p>
    <ul>
        <li>Increase buffer size in UART Config (Circular Buffer mode)</li>
        <li>Switch to DMA Ping-Pong mode (no data loss)</li>
        <li>Enable "All or Nothing" mode (reject partial sends)</li>
        <li>Reduce transmission rate or increase UART baud rate</li>
    </ul>

    <h3>Multitasking Issues</h3>
    <p><strong>Problem:</strong> Data corruption in multitasking model.<br>
    <strong>Solutions:</strong></p>
    <ul>
        <li>Check thread protection settings in UART Config</li>
        <li>Ensure only one task writes to same UART</li>
        <li>Use DMA mode to avoid interrupt conflicts</li>
    </ul>

    <h2>See Also</h2>
    <p>
        <a href="../communication.html">Communication Blocks</a> |
        <a href="uart_config.html">UART Config</a> |
        <a href="uart_rx.html">UART Rx</a> |
        <a href="../../user_guide/code_generation.html">Code Generation</a>
    </p>

    </div>
</body>
</html>
