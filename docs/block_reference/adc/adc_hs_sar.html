<!DOCTYPE html>
<html>
<head>
    <title>MCHP_ADC_HighSpeed_SAR - High-Speed SAR ADC Block</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../../assets/css/navigation.css">
    <script src="../../assets/js/navigation.js"></script>
</head>
<body>
    <!-- Mobile Navigation Toggle -->
    <button class="nav-toggle" aria-label="Toggle navigation">☰</button>

    <!-- Left Navigation Panel -->
    <nav class="doc-nav-container">
        <div class="doc-nav-header">
            <a href="../../index.html">MCHP Blockset Docs</a>
        </div>
        <ul class="doc-nav-menu">
            <li class="nav-item">
                <a href="../../index.html" class="nav-link">Home</a>
            </li>

            <!-- Getting Started Section -->
            <li class="nav-item">
                <div class="nav-category">Getting Started <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../getting_started/overview.html" class="nav-link">Overview</a></li>
                    <li><a href="../../getting_started/installation.html" class="nav-link">Installation</a></li>
                    <li><a href="../../getting_started/quick_start.html" class="nav-link">Quick Start</a></li>
                    <li><a href="../../getting_started/board_templates.html" class="nav-link">Board Templates</a></li>
                    <li><a href="../../getting_started/supported_devices.html" class="nav-link">Supported Devices</a></li>
                </ul>
            </li>

            <!-- User Guide Section -->
            <li class="nav-item">
                <div class="nav-category">User Guide <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../user_guide/index.html" class="nav-link">User Guide Overview</a></li>
                    <li><a href="../../user_guide/code_generation.html" class="nav-link">Code Generation</a></li>
                    <li><a href="../../user_guide/external_mode.html" class="nav-link">External Mode</a></li>
                </ul>
            </li>

            <!-- Block Reference Section -->
            <li class="nav-item">
                <div class="nav-category">Block Reference <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../block_reference/index.html" class="nav-link">Block Reference Overview</a></li>
                </ul>
            </li>

            <!-- Examples Section -->
            <li class="nav-item">
                <div class="nav-category">Examples <span class="nav-category-icon">▼</span></div>
                <ul class="nav-list">
                    <li><a href="../../examples/field_weakening.html" class="nav-link">Field Weakening</a></li>
                </ul>
            </li>

            <!-- Release Notes -->
            <li class="nav-item">
                <a href="../../release_notes.html" class="nav-link">Release Notes</a>
            </li>
        </ul>
    </nav>

    <div class="doc-content-wrapper">
    <div class="container">
        <h1>MCHP_ADC_HighSpeed_SAR - High-Speed SAR ADC Block</h1>

        
    <!-- Block Icon -->
    <div class="block-image">
        <img src="../assets/images/blocks/analog/ADC_PIC32_High_Speed_SAR.svg"
             alt="ADC_PIC32_High_Speed_SAR Block Icon"
             onerror="this.onerror=null; this.src='../assets/images/blocks/analog/ADC_PIC32_High_Speed_SAR.png';">
        <div class="block-image-caption">
            ADC_PIC32_High_Speed_SAR Block Icon
        </div>
    </div>
<h2>Block Description</h2>
        <p>The <strong>MCHP_ADC_HighSpeed_SAR</strong> block implements the high-performance Successive Approximation Register (SAR) ADC peripheral found in PIC32MK, PIC32MZ, and dsPIC33C devices. This advanced ADC architecture features <strong>dedicated ADC cores</strong> (ADC0-ADC6) plus a <strong>shared ADC7</strong> with software-configurable inputs, providing exceptional flexibility for high-speed multi-channel acquisition.</p>

        <div class="highlight">
            <strong>Key Advantage:</strong> Dedicated ADC cores allow truly simultaneous sampling across multiple channels without multiplexing delays, ideal for high-performance motor control and multi-phase power conversion applications.
        </div>

        <h2>Supported Device Families</h2>
        <table>
            <tr>
                <th>Device Family</th>
                <th>Module Type</th>
                <th>Dedicated Cores</th>
                <th>Shared ADC</th>
            </tr>
            <tr>
                <td><strong>PIC32MK</strong></td>
                <td>DOS_02508_adc_sar_ctrl_upb_v1_PIC32MK</td>
                <td>6 (ADC0-ADC5)</td>
                <td>ADC7 (configurable)</td>
            </tr>
            <tr>
                <td><strong>dsPIC33C (WACP)</strong></td>
                <td>DOS_02508_WACP_adc_sar_ctrl_upb_v1</td>
                <td>3 (ADC0-ADC2)</td>
                <td>ADC7 (configurable)</td>
            </tr>
            <tr>
                <td><strong>dsPIC33C (Standard)</strong></td>
                <td>DOS_02508_adc_sar_ctrl_upb_v1</td>
                <td>5 (ADC0-ADC4)</td>
                <td>ADC7 (configurable)</td>
            </tr>
        </table>

        <div class="note">
            <strong>Note:</strong> For PIC32MZ devices with similar architecture, this block is also supported. For newer dsPIC33A devices, use the <a href="adc_hs_12b.html">MCHP_ADC_HS_12b</a> block instead.
        </div>

        <h2>Key Features</h2>
        <div class="feature-grid">
            <div class="feature-item">
                <strong>Resolution</strong><br>
                6/8/10/12-bit selectable per core
            </div>
            <div class="feature-item">
                <strong>Dedicated Cores</strong><br>
                3-6 dedicated ADC cores (chip dependent)
            </div>
            <div class="feature-item">
                <strong>Shared ADC7</strong><br>
                Software-configurable multiplexed core
            </div>
            <div class="feature-item">
                <strong>Speed</strong><br>
                Up to 3.25 Msps per core
            </div>
            <div class="feature-item">
                <strong>Triggers</strong><br>
                Independent triggers per core
            </div>
            <div class="feature-item">
                <strong>Special Inputs</strong><br>
                VBat, IVref, Temperature, CTMU
            </div>
        </div>

        <h2>ADC Architecture</h2>

        <h3>Dedicated ADC Cores (ADC0-ADC6)</h3>
        <ul>
            <li><strong>Hard-wired inputs:</strong> Each dedicated core has a fixed analog input pin</li>
            <li><strong>Independent operation:</strong> Each core can sample simultaneously with different triggers</li>
            <li><strong>No multiplexing:</strong> Zero channel switching delay</li>
            <li><strong>Ideal for:</strong> Multi-phase motor current sensing, multi-channel synchronous acquisition</li>
        </ul>

        <h3>Shared ADC7</h3>
        <ul>
            <li><strong>Flexible input selection:</strong> Can be connected to any available ANx input</li>
            <li><strong>Software-controlled multiplexing:</strong> Select input channel via mask parameters</li>
            <li><strong>Excluded inputs:</strong> Cannot use same inputs as dedicated cores (AN0-AN6 typically reserved)</li>
            <li><strong>Ideal for:</strong> Auxiliary measurements, voltage monitoring, additional channels</li>
        </ul>

        <h2>Configuration Parameters</h2>

        <h3>Dedicated Core Settings (ADC0-ADC6)</h3>
        <table>
            <tr>
                <th>Parameter</th>
                <th>Description</th>
                <th>Options</th>
            </tr>
            <tr>
                <td><strong>ADC0_Enable</strong></td>
                <td>Enable ADC0 dedicated core</td>
                <td>on / off</td>
            </tr>
            <tr>
                <td><strong>ADC0_pin</strong></td>
                <td>Analog input pin assignment for ADC0</td>
                <td>Displays pin mapping (e.g., "AN0 / PA0 / Pin[46]")</td>
            </tr>
            <tr>
                <td><strong>ADC0_SELRES</strong></td>
                <td>Resolution for ADC0</td>
                <td>6-bit / 8-bit / 10-bit / 12-bit</td>
            </tr>
            <tr>
                <td><strong>ADC0_SAMC</strong></td>
                <td>Sample time (in TAD cycles)</td>
                <td>0-1023 TAD</td>
            </tr>
            <tr>
                <td><strong>ADC0_Trig</strong></td>
                <td>Trigger source for ADC0</td>
                <td>Manual, PWM, Timer, External (dynamic list)</td>
            </tr>
            <tr>
                <td colspan="3"><em>... Similar parameters for ADC1-ADC6 (if available on chip)</em></td>
            </tr>
        </table>

        <h3>Shared ADC7 Configuration</h3>
        <table>
            <tr>
                <th>Parameter</th>
                <th>Description</th>
                <th>Options</th>
            </tr>
            <tr>
                <td><strong>ADC7_Enable</strong></td>
                <td>Enable shared ADC7</td>
                <td>on / off</td>
            </tr>
            <tr>
                <td><strong>ADC7_ANx checkboxes</strong></td>
                <td>Select which analog inputs to connect to ADC7</td>
                <td>Individual checkboxes for each available ANx (typically AN7+)</td>
            </tr>
            <tr>
                <td><strong>ADC7_SELRES</strong></td>
                <td>Resolution for ADC7</td>
                <td>6-bit / 8-bit / 10-bit / 12-bit</td>
            </tr>
            <tr>
                <td><strong>ADC7_SAMC</strong></td>
                <td>Sample time (in TAD cycles)</td>
                <td>0-1023 TAD</td>
            </tr>
            <tr>
                <td><strong>ADC7_Trig</strong></td>
                <td>Trigger source for ADC7</td>
                <td>Manual, PWM, Timer, External (dynamic list)</td>
            </tr>
        </table>

        <h3>Special Input Channels</h3>
        <table>
            <tr>
                <th>Parameter</th>
                <th>Description</th>
                <th>Availability</th>
            </tr>
            <tr>
                <td><strong>Vbat</strong></td>
                <td>Battery voltage monitoring</td>
                <td>PIC32MK, dsPIC33C-WACP</td>
            </tr>
            <tr>
                <td><strong>IVref</strong></td>
                <td>Internal voltage reference</td>
                <td>All variants</td>
            </tr>
            <tr>
                <td><strong>IVTemp</strong></td>
                <td>Internal temperature sensor</td>
                <td>All variants</td>
            </tr>
            <tr>
                <td><strong>CTMU_Temp</strong></td>
                <td>CTMU temperature measurement</td>
                <td>PIC32MK, dsPIC33C-WACP</td>
            </tr>
        </table>

        <h3>Timing Configuration</h3>
        <table>
            <tr>
                <th>Parameter</th>
                <th>Description</th>
                <th>Formula/Range</th>
            </tr>
            <tr>
                <td><strong>ADC_R (impedance)</strong></td>
                <td>Source impedance selection</td>
                <td>&lt;200Ω to &lt;50kΩ (determines min TAD)</td>
            </tr>
            <tr>
                <td><strong>SAMC</strong></td>
                <td>Sample time in TAD cycles</td>
                <td>Calculated: <code>SAMC ≥ (0.002 × Impedance + 3)</code></td>
            </tr>
            <tr>
                <td><strong>TAD</strong></td>
                <td>ADC clock period</td>
                <td>Function of system clock and dividers</td>
            </tr>
        </table>

        <div class="note">
            <strong>Sample Time Calculation:</strong> The block automatically calculates minimum SAMC based on source impedance using:
            <br><code>SAMC_min = 0.002 × R_source (Ω) + 3</code>
            <br>This ensures accurate conversion for high-impedance sources.
        </div>

        <h2>Trigger Sources</h2>

        <h3>Available Trigger Types</h3>
        <table>
            <tr>
                <th>Trigger Type</th>
                <th>Description</th>
                <th>Use Case</th>
            </tr>
            <tr>
                <td><strong>Manual</strong></td>
                <td>Software-initiated conversion</td>
                <td>On-demand sampling, debugging</td>
            </tr>
            <tr>
                <td><strong>PWM Special Event</strong></td>
                <td>Triggered by PWM generator at specific phase</td>
                <td>Motor control - current sensing at exact PWM point</td>
            </tr>
            <tr>
                <td><strong>Timer Compare</strong></td>
                <td>Triggered by timer match event</td>
                <td>Periodic sampling with precise timing</td>
            </tr>
            <tr>
                <td><strong>External Pin</strong></td>
                <td>Hardware trigger from external source</td>
                <td>Synchronization with external events</td>
            </tr>
            <tr>
                <td><strong>Scan Trigger</strong></td>
                <td>Sequential triggering of multiple cores</td>
                <td>Multi-channel coordinated acquisition</td>
            </tr>
        </table>

        <div class="example">
            <strong>Independent Triggering Example:</strong>
            <ul>
                <li>ADC0 triggered by PWM1 Special Event (phase current U)</li>
                <li>ADC1 triggered by PWM1 Special Event (phase current V)</li>
                <li>ADC2 triggered by PWM2 Special Event (phase current W)</li>
                <li>ADC7 triggered by Timer3 Compare (DC bus voltage monitoring)</li>
            </ul>
            All cores sample independently based on their respective triggers.
        </div>

        <h2>PWM-ADC Synchronization Strategies</h2>

        <p>Proper synchronization between PWM generation and ADC sampling is essential for motor control and power conversion. The High-Speed SAR ADC with dedicated cores provides exceptional flexibility for implementing optimal sampling strategies. Understanding when and how to trigger ADC conversions directly impacts control accuracy and system performance.</p>

        <h3>Synchronization Strategy Overview</h3>

        <p>The MCHP_ADC_HighSpeed_SAR block supports four fundamental synchronization strategies for different control requirements:</p>

        <h4>Strategy 1: Timer-Based Trigger (Independent Sampling)</h4>
        <div style="text-align: center; margin: 20px 0;">
            <picture>
                <source srcset="../assets/images/toolbox_concepts/synchronization/MCHP_TimeStep_0TrigTimer.svg" type="image/svg+xml">
                <img src="../assets/images/toolbox_concepts/synchronization/MCHP_TimeStep_0TrigTimer.png"
                     alt="Timer-Based ADC Trigger"
                     style="max-width: 800px; width: 100%; border: 1px solid #ddd;">
            </picture>
        </div>

        <p><strong>ADC Configuration:</strong></p>
        <ul>
            <li>Set <code>ADCx_Trig = 'Timer3 Compare'</code> (or any timer)</li>
            <li>Timer runs at fixed frequency independent of PWM</li>
            <li>Control task triggered by ADC interrupt or DMA completion</li>
        </ul>

        <p><strong>When to Use:</strong></p>
        <ul>
            <li>General-purpose data acquisition</li>
            <li>Sensor monitoring at fixed sample rates</li>
            <li>Multi-rate control systems (different loops at different frequencies)</li>
            <li>Applications where PWM synchronization is not critical</li>
        </ul>

        <p><strong>Limitations:</strong></p>
        <ul>
            <li>❌ Not synchronized with PWM switching edges</li>
            <li>❌ May sample during switching noise transients</li>
            <li>❌ Not suitable for phase current sensing in motor control</li>
        </ul>

        <h4>Strategy 2: Timer → ADC → Task (Synchronized Acquisition)</h4>
        <div style="text-align: center; margin: 20px 0;">
            <picture>
                <source srcset="../assets/images/toolbox_concepts/synchronization/MCHP_TimeStep_1TrigTimerADC.svg" type="image/svg+xml">
                <img src="../assets/images/toolbox_concepts/synchronization/MCHP_TimeStep_1TrigTimerADC.png"
                     alt="Timer-ADC-Task Synchronization"
                     style="max-width: 800px; width: 100%; border: 1px solid #ddd;">
            </picture>
        </div>

        <p><strong>ADC Configuration:</strong></p>
        <ul>
            <li>Timer trigger starts ADC conversion</li>
            <li>ADC interrupt triggers control task execution</li>
            <li>Ensures fresh data before control algorithm runs</li>
        </ul>

        <p><strong>Key Benefit:</strong> Zero latency - control task always uses most recent ADC data (no stale samples).</p>

        <p><strong>Configuration Example:</strong></p>
        <div class="example">
<pre><code>% ADC Block Configuration:
ADC0_Enable = 'on';
ADC1_Enable = 'on';
ADC0_Trig = 'Timer3 Compare';  % Timer trigger
ADC1_Trig = 'Timer3 Compare';  % Same timer

% Timer3 Configuration:
Period = 1/10e3;  % 10 kHz sampling rate

% Scheduler Configuration:
% Set control task to trigger on ADC0 interrupt
% Task sample time = 'Inherited' (follows ADC trigger rate)
</code></pre>
        </div>

        <p><strong>Best For:</strong></p>
        <ul>
            <li>Feedback control systems requiring minimum latency</li>
            <li>Data logging applications</li>
            <li>Sensor monitoring with immediate processing</li>
        </ul>

        <h4>Strategy 3: PWM → ADC → Task (Motor Control Standard) ⭐ RECOMMENDED</h4>
        <div style="text-align: center; margin: 20px 0;">
            <picture>
                <source srcset="../assets/images/toolbox_concepts/synchronization/MCHP_TimeStep_2TrigPWMADC.svg" type="image/svg+xml">
                <img src="../assets/images/toolbox_concepts/synchronization/MCHP_TimeStep_2TrigPWMADC.png"
                     alt="PWM-ADC-Task Synchronization"
                     style="max-width: 800px; width: 100%; border: 1px solid #ddd;">
            </picture>
        </div>

        <p><strong>⭐ This is the STANDARD approach for motor control and power conversion applications.</strong></p>

        <p><strong>Key Benefits:</strong></p>
        <ul>
            <li>✅ <strong>Optimal sampling timing:</strong> Sample when PWM low-side FET is ON</li>
            <li>✅ <strong>Noise immunity:</strong> Avoid switching transients</li>
            <li>✅ <strong>Accurate current sensing:</strong> Sample during shunt current flow</li>
            <li>✅ <strong>Automatic synchronization:</strong> Control rate matches PWM frequency</li>
            <li>✅ <strong>Simultaneous sampling:</strong> Dedicated cores sample all phases at same instant</li>
        </ul>

        <p><strong>ADC Configuration Example (3-Phase FOC with Dedicated Cores):</strong></p>
        <div class="example">
<pre><code>% PWM Block Configuration (MCHP_PWM_HighSpeed or MCHP_MCPWM):
PWM_Mode = 'Center-aligned';
PWM_Frequency = 20e3;  % 20 kHz
SEVTCMP = 0;  % Trigger at PWM valley (center point)

% ADC Block Configuration (Dedicated Cores):
ADC0_Enable = 'on';  % Phase A current (AN0)
ADC1_Enable = 'on';  % Phase B current (AN1)
ADC2_Enable = 'on';  % Phase C current (AN2)

% All triggered by PWM valley for simultaneous sampling:
ADC0_Trig = 'PWM1 Special Event';
ADC1_Trig = 'PWM1 Special Event';
ADC2_Trig = 'PWM1 Special Event';

% All use 12-bit resolution:
ADC0_SELRES = '12-bit';
ADC1_SELRES = '12-bit';
ADC2_SELRES = '12-bit';

% Appropriate sample time for low-impedance shunt:
ADC0_SAMC = 10;  % TAD cycles
ADC1_SAMC = 10;
ADC2_SAMC = 10;

% Result: All 3 phase currents sampled simultaneously at PWM valley (20 kHz rate)
% Control task triggered by ADC0 interrupt completion
</code></pre>
        </div>

        <div class="highlight">
            <strong>💡 Why Sample at PWM Valley?</strong><br>
            In center-aligned PWM for 3-phase motor control, the valley (center) is when <strong>all three low-side FETs are simultaneously ON</strong>. This is the <strong>only time</strong> when phase currents flow through shunt resistors, enabling accurate current measurement. The dedicated ADC cores allow <strong>true simultaneous sampling</strong> with zero multiplexing delay.
        </div>

        <p><strong>Configuration Example with Shared ADC7 for Auxiliary Measurements:</strong></p>
        <div class="example">
<pre><code>% Dedicated cores for critical signals (simultaneous):
ADC0_Enable = 'on';  % Phase A current
ADC1_Enable = 'on';  % Phase B current
ADC2_Enable = 'on';  % Phase C current
ADC0_Trig = ADC1_Trig = ADC2_Trig = 'PWM1 Special Event';

% Shared ADC7 for slower auxiliary measurements:
ADC7_Enable = 'on';
ADC7_ANx = [AN10, AN15];  % DC bus voltage, temperature
ADC7_Trig = 'PWM1 Special Event';  % Same instant or slower rate

% Result: 3 phase currents + 2 auxiliary channels sampled at PWM valley
</code></pre>
        </div>

        <p><strong>Trigger Source Mapping (Device-Specific):</strong></p>
        <table>
            <tr>
                <th>PWM Block</th>
                <th>PWM Configuration</th>
                <th>ADC Trigger Selection</th>
            </tr>
            <tr>
                <td><strong>MCHP_PWM_HighSpeed</strong></td>
                <td>Set <code>TrigOut</code> array</td>
                <td><code>'PWM1 Trigger 1'</code> or<br><code>'PWM1 Special Event'</code></td>
            </tr>
            <tr>
                <td><strong>MCHP_MCPWM</strong></td>
                <td>Set <code>TRIG1/2/3</code> or <code>SEVTCMP</code></td>
                <td><code>'PWM1 TRIG1'</code>,<br><code>'PWM1 Special Event'</code></td>
            </tr>
            <tr>
                <td><strong>MCHP_PWM (Standard)</strong></td>
                <td>Set <code>PxSECMP</code></td>
                <td><code>'PWM Special Event'</code></td>
            </tr>
        </table>

        <h4>Strategy 4: Multiple Triggers per PWM Period (Advanced Control)</h4>
        <div style="text-align: center; margin: 20px 0;">
            <picture>
                <source srcset="../assets/images/toolbox_concepts/synchronization/MCHP_TimeStep_3TrigPWMADC.svg" type="image/svg+xml">
                <img src="../assets/images/toolbox_concepts/synchronization/MCHP_TimeStep_3TrigPWMADC.png"
                     alt="Multiple ADC Triggers per PWM Period"
                     style="max-width: 800px; width: 100%; border: 1px solid #ddd;">
            </picture>
        </div>

        <p><strong>Use Case:</strong> High-performance control requiring multiple measurements per PWM cycle.</p>

        <p><strong>Key Applications:</strong></p>
        <ul>
            <li><strong>Single-shunt FOC:</strong> Sample currents at multiple PWM sector transitions</li>
            <li><strong>Dual sampling:</strong> Measure phase currents at peak and valley</li>
            <li><strong>Sensorless FOC:</strong> Sample back-EMF at multiple rotor positions</li>
            <li><strong>Digital power:</strong> Monitor voltage/current at different switching states</li>
        </ul>

        <p><strong>ADC Configuration Example (Single-Shunt FOC):</strong></p>
        <div class="example">
<pre><code>% PWM Block (MCHP_PWM_HighSpeed or MCHP_MCPWM):
PWM_Mode = 'Center-aligned';
TrigOut = [1 1 1];  % Enable 3 trigger outputs
TRIG1 = Period * 0.4;   % Before valley (sector 1)
SEVTCMP = 0;            % Valley (sector 2)
TRIG2 = Period * 0.6;   % After valley (sector 3)

% ADC Block Configuration (Dedicated cores for parallel sampling):
ADC0_Enable = 'on';  % Shunt current - Sector 1
ADC0_Trig = 'PWM1 TRIG1';

ADC1_Enable = 'on';  % Shunt current - Sector 2
ADC1_Trig = 'PWM1 Special Event';  % Valley

ADC2_Enable = 'on';  % Shunt current - Sector 3
ADC2_Trig = 'PWM1 TRIG2';

% All measure same shunt at different PWM sectors
% Reconstruct 3-phase currents from single shunt
</code></pre>
        </div>

        <p><strong>Advantages:</strong></p>
        <ul>
            <li>Maximum information extraction per PWM cycle</li>
            <li>Cost reduction (single shunt vs. 3 shunts)</li>
            <li>Improved state estimation for sensorless control</li>
            <li>Faster transient response</li>
        </ul>

        <p><strong>Considerations:</strong></p>
        <ul>
            <li>⚠️ Increased CPU load (multiple ADC interrupts per PWM cycle)</li>
            <li>⚠️ Careful timing analysis required (ensure ADC completes before next trigger)</li>
            <li>⚠️ Complex current reconstruction algorithms</li>
        </ul>

        <h3>Application-Specific Recommendations</h3>

        <table>
            <tr>
                <th>Application</th>
                <th>Recommended Strategy</th>
                <th>ADC Configuration</th>
            </tr>
            <tr>
                <td><strong>3-Phase FOC Motor Control</strong></td>
                <td>PWM → ADC → Task (Strategy 3)</td>
                <td>
                    • ADC0-2: 3 phase currents (dedicated cores)<br>
                    • ADC7: DC bus voltage<br>
                    • All triggered by PWM Special Event
                </td>
            </tr>
            <tr>
                <td><strong>Single-Shunt FOC</strong></td>
                <td>Multiple Triggers (Strategy 4)</td>
                <td>
                    • ADC0-2: Shunt current at 3 PWM sectors<br>
                    • Triggers: TRIG1, SEVTCMP, TRIG2<br>
                    • Reconstruct phases from single shunt
                </td>
            </tr>
            <tr>
                <td><strong>BLDC Motor Control</strong></td>
                <td>PWM → ADC → Task (Strategy 3)</td>
                <td>
                    • ADC0: DC bus current<br>
                    • Trigger: PWM Special Event<br>
                    • Sample during active commutation
                </td>
            </tr>
            <tr>
                <td><strong>Multi-Motor Control (2+ motors)</strong></td>
                <td>Multiple independent PWM→ADC chains</td>
                <td>
                    • ADC0-2: Motor 1 (PWM1 trigger)<br>
                    • ADC3-5: Motor 2 (PWM2 trigger)<br>
                    • Independent control loops
                </td>
            </tr>
            <tr>
                <td><strong>PFC Boost Converter</strong></td>
                <td>PWM → ADC → Task (Strategy 3)</td>
                <td>
                    • ADC0: Input current<br>
                    • ADC1: Output voltage<br>
                    • Trigger: PWM Special Event at 85% period
                </td>
            </tr>
            <tr>
                <td><strong>Interleaved DC-DC Converters</strong></td>
                <td>PWM → ADC → Task (Strategy 3)</td>
                <td>
                    • ADC0: Phase 1 current (PWM1 trigger)<br>
                    • ADC1: Phase 2 current (PWM2 trigger)<br>
                    • Phase-shifted PWM triggers
                </td>
            </tr>
            <tr>
                <td><strong>General Data Acquisition</strong></td>
                <td>Timer → ADC → Task (Strategy 2)</td>
                <td>
                    • ADC0-6: Multiple sensors at fixed rate<br>
                    • Trigger: Timer Compare<br>
                    • Independent of PWM
                </td>
            </tr>
        </table>

        <h3>Troubleshooting Synchronization Issues</h3>

        <table>
            <tr>
                <th>Problem</th>
                <th>Likely Cause</th>
                <th>ADC Configuration Fix</th>
            </tr>
            <tr>
                <td>Phase currents read as zero</td>
                <td>ADC not triggered at PWM valley</td>
                <td>
                    • Verify: <code>ADCx_Trig = 'PWM1 Special Event'</code><br>
                    • In PWM block: <code>SEVTCMP = 0</code> (valley)<br>
                    • Check PWM mode is center-aligned
                </td>
            </tr>
            <tr>
                <td>Noisy ADC readings during operation</td>
                <td>Sampling during switching transients</td>
                <td>
                    • Change trigger to PWM valley or after settling<br>
                    • Avoid sampling immediately after PWM edge<br>
                    • Increase SAMC for longer settling time<br>
                    • Add hardware RC filter on ADC inputs
                </td>
            </tr>
            <tr>
                <td>No PWM triggers in dropdown</td>
                <td>PWM block not configured with triggers</td>
                <td>
                    • In PWM block: Enable <code>TrigOut</code> or <code>SEVTCMP</code><br>
                    • Add PWM block to model before ADC block<br>
                    • Rebuild model (triggers dynamically populated)
                </td>
            </tr>
            <tr>
                <td>Control task not synchronized with ADC</td>
                <td>Task triggered by timer, not ADC interrupt</td>
                <td>
                    • In Scheduler: Set task trigger source to ADC interrupt<br>
                    • Task sample time = 'Inherited'<br>
                    • Verify ADC interrupt priority allows task execution
                </td>
            </tr>
            <tr>
                <td>Missing ADC samples (overrun)</td>
                <td>Next trigger before conversion complete</td>
                <td>
                    • Calculate total conversion time: SAMC + Resolution_TAD<br>
                    • Reduce SAMC if source impedance allows<br>
                    • Lower resolution (12-bit → 10-bit)<br>
                    • Increase PWM period (lower frequency)
                </td>
            </tr>
            <tr>
                <td>Simultaneous sampling not working</td>
                <td>Cores not triggered by same source</td>
                <td>
                    • Verify all cores use identical trigger:<br>
                    • <code>ADC0_Trig = ADC1_Trig = ADC2_Trig</code><br>
                    • Check for hardware limitation on chip variant
                </td>
            </tr>
            <tr>
                <td>ADC7 channels interfering</td>
                <td>ADC7 scanning during dedicated core conversion</td>
                <td>
                    • Use different trigger for ADC7 (slower rate)<br>
                    • Stagger ADC7 trigger from dedicated cores<br>
                    • Minimize ADC7 channels to reduce scan time
                </td>
            </tr>
        </table>

        <h3>Performance Optimization Tips</h3>

        <ul>
            <li><strong>Simultaneous Sampling:</strong> Assign critical signals (e.g., 3-phase currents) to dedicated cores ADC0-2 for true simultaneous acquisition</li>
            <li><strong>Core Distribution:</strong> Balance channel assignment across available cores to maximize parallel conversion</li>
            <li><strong>Resolution Selection:</strong> Use lowest resolution meeting accuracy requirements (10-bit often sufficient for motor control)</li>
            <li><strong>SAMC Optimization:</strong> Calculate minimum SAMC based on source impedance: <code>SAMC_min = 0.002 × R_source + 3</code></li>
            <li><strong>DMA Integration:</strong> Enable DMA for ADC results to minimize CPU overhead in high-speed applications</li>
            <li><strong>Interrupt Priority:</strong> Set ADC interrupt priority higher than control task for immediate data availability</li>
            <li><strong>ADC7 Management:</strong> Use shared ADC7 for slower auxiliary measurements to avoid interfering with fast dedicated cores</li>
        </ul>

        <div class="highlight">
            <strong>🎯 Quick Start Recommendation:</strong><br>
            For 3-phase motor control applications, start with <strong>Strategy 3 (PWM → ADC → Task)</strong>:
            <ul>
                <li>Configure PWM with center-aligned mode and <code>SEVTCMP = 0</code></li>
                <li>Assign phase currents to dedicated cores ADC0-2</li>
                <li>Set all ADC triggers to <code>'PWM1 Special Event'</code></li>
                <li>Use 12-bit resolution with SAMC=10 for shunt resistors</li>
                <li>Set control task to trigger on ADC0 interrupt</li>
            </ul>
            This configuration provides optimal current measurement with minimal setup complexity and leverages the dedicated core architecture for true simultaneous sampling.
        </div>

        <h3>Comparison with Other ADC Architectures</h3>

        <table>
            <tr>
                <th>Feature</th>
                <th>HS SAR (This Block)</th>
                <th>dsPIC33A HS 12b</th>
                <th>Standard ADC</th>
            </tr>
            <tr>
                <td><strong>Simultaneous Sampling</strong></td>
                <td>✅ Yes (dedicated cores)</td>
                <td>❌ No (software sequencing)</td>
                <td>❌ No (multiplexed)</td>
            </tr>
            <tr>
                <td><strong>Multiple Triggers/Period</strong></td>
                <td>✅ Yes (per core)</td>
                <td>✅ Yes (6 sequences)</td>
                <td>⚠️ Limited (1 special event)</td>
            </tr>
            <tr>
                <td><strong>Channel Flexibility</strong></td>
                <td>⚠️ Dedicated + 1 shared</td>
                <td>✅ Any channel, any sequence</td>
                <td>✅ Any channel</td>
            </tr>
            <tr>
                <td><strong>Best For</strong></td>
                <td>Multi-phase FOC, high-speed parallel acquisition</td>
                <td>Complex sequencing, single-shunt FOC</td>
                <td>Legacy support, simple acquisition</td>
            </tr>
        </table>

        <h3>Related PWM Blocks for Synchronization</h3>
        <ul>
            <li><a href="../pwm/pwm_high_speed.html"><strong>MCHP_PWM_HighSpeed</strong></a> - High-speed PWM for dsPIC33C/CH/CK with multiple triggers</li>
            <li><a href="../pwm/mcpwm.html"><strong>MCHP_MCPWM</strong></a> - Motor Control PWM with advanced trigger capabilities</li>
            <li><a href="../pwm/pwm_standard.html"><strong>MCHP_PWM</strong></a> - Standard PWM with special event trigger</li>
        </ul>

        <h2>Block Inputs/Outputs</h2>

        <h3>Dynamic Output Configuration</h3>
        <p>The block automatically creates output ports based on enabled ADC cores:</p>

        <ul>
            <li><strong>Dedicated cores:</strong> One output per enabled ADC (ADC0_out, ADC1_out, etc.)</li>
            <li><strong>Shared ADC7:</strong> One output per selected analog input</li>
            <li><strong>Data type:</strong> Configurable (typically uint16)</li>
            <li><strong>Output format:</strong> Raw ADC counts (right-aligned)</li>
        </ul>

        <div class="example">
            <strong>Example Output Configuration:</strong>
            <ul>
                <li>ADC0 enabled → Output: ADC0_out (AN0 / PA0)</li>
                <li>ADC1 enabled → Output: ADC1_out (AN1 / PA1)</li>
                <li>ADC2 enabled → Output: ADC2_out (AN2 / PA2)</li>
                <li>ADC7 with AN10, AN15 selected → Outputs: AN10_out, AN15_out</li>
            </ul>
            Total: 5 output ports
        </div>

        <h2>Implementation Details</h2>

        <h3>Key Registers Configured</h3>
        <table>
            <tr>
                <th>Register</th>
                <th>Purpose</th>
                <th>Key Fields</th>
            </tr>
            <tr>
                <td><strong>ADCCONx</strong></td>
                <td>ADC control for each core</td>
                <td>ON, AICEN, VREFSEL</td>
            </tr>
            <tr>
                <td><strong>ADCTIMEx</strong></td>
                <td>Timing configuration</td>
                <td>SAMC, ADCDIV, SELRES</td>
            </tr>
            <tr>
                <td><strong>ADCTRGx</strong></td>
                <td>Trigger source selection</td>
                <td>TRGSRC[4:0], STRGSRC</td>
            </tr>
            <tr>
                <td><strong>ADCDATAx</strong></td>
                <td>ADC result register</td>
                <td>DATA[11:0] (right-aligned)</td>
            </tr>
            <tr>
                <td><strong>ADCIMCON1-3</strong></td>
                <td>Input mode control (ADC7)</td>
                <td>Channel selection for shared ADC</td>
            </tr>
            <tr>
                <td><strong>ADCCSS1-2</strong></td>
                <td>Channel scan selection (ADC7)</td>
                <td>Bit-mapped channel enable</td>
            </tr>
        </table>

        <h3>Conversion Process</h3>
        <ol>
            <li><strong>Trigger received</strong> → Core enters sampling phase</li>
            <li><strong>Sample for SAMC TADs</strong> → Acquire input voltage on S&H capacitor</li>
            <li><strong>Hold and convert</strong> → SAR conversion (12/10/8/6 TAD depending on resolution)</li>
            <li><strong>Result available</strong> → ADCDATAx register updated, interrupt/DMA triggered</li>
        </ol>

        <div class="note">
            <strong>Simultaneous Sampling:</strong> Because each core has dedicated hardware, ADC0-ADC6 can all sample at the exact same instant when triggered together, providing true simultaneous acquisition critical for multi-phase measurements.
        </div>

        <h2>Usage Examples</h2>

        <h3>Example 1: 3-Phase Motor Current Sensing</h3>
        <div class="example">
            <strong>Configuration:</strong>
            <ul>
                <li><strong>ADC0:</strong> Enabled, 12-bit, AN0 (Phase U current)</li>
                <li><strong>ADC1:</strong> Enabled, 12-bit, AN1 (Phase V current)</li>
                <li><strong>ADC2:</strong> Enabled, 12-bit, AN2 (Phase W current)</li>
                <li><strong>ADC0/1/2 Trigger:</strong> PWM1 Special Event (valley sampling)</li>
                <li><strong>ADC0/1/2 SAMC:</strong> 10 TAD (for &lt;1kΩ source impedance)</li>
            </ul>
            <strong>Result:</strong> Three phase currents sampled simultaneously at PWM valley, zero multiplexing delay, perfect for FOC algorithms.
        </div>

        <h3>Example 2: Multi-Channel Data Acquisition</h3>
        <div class="example">
            <strong>Configuration:</strong>
            <ul>
                <li><strong>ADC0-ADC4:</strong> All enabled, 10-bit, dedicated inputs AN0-AN4</li>
                <li><strong>ADC7:</strong> Enabled, scan mode with AN10, AN15, AN20</li>
                <li><strong>ADC0-4 Trigger:</strong> Timer3 Compare (100kHz)</li>
                <li><strong>ADC7 Trigger:</strong> Scan trigger (auto-sequenced)</li>
            </ul>
            <strong>Result:</strong> 5 dedicated channels sampled at 100kHz + 3 scanned channels on ADC7 for auxiliary measurements.
        </div>

        <h3>Example 3: Battery Monitoring with Temperature Compensation</h3>
        <div class="example">
            <strong>Configuration:</strong>
            <ul>
                <li><strong>Vbat:</strong> Enabled (battery voltage)</li>
                <li><strong>IVTemp:</strong> Enabled (junction temperature)</li>
                <li><strong>ADC7:</strong> Enabled, 12-bit, trigger: Timer2 (1kHz)</li>
            </ul>
            <strong>Result:</strong> Periodic monitoring of battery voltage and chip temperature for thermal management.
        </div>

        <h3>Example 4: High-Impedance Sensor Interface</h3>
        <div class="example">
            <strong>Configuration:</strong>
            <ul>
                <li><strong>ADC0:</strong> Enabled, 12-bit, AN0</li>
                <li><strong>ADC_R:</strong> &lt;50kΩ (high-impedance source)</li>
                <li><strong>SAMC:</strong> Auto-calculated to 103 TAD</li>
                <li><strong>Trigger:</strong> Manual (software controlled)</li>
            </ul>
            <strong>Result:</strong> Accurate conversion from 50kΩ source with sufficient sampling time.
        </div>

        <h2>Performance Considerations</h2>

        <h3>Conversion Speed vs Resolution</h3>
        <table>
            <tr>
                <th>Resolution</th>
                <th>Conversion Time</th>
                <th>Max Sample Rate (SAMC=3)</th>
            </tr>
            <tr>
                <td>6-bit</td>
                <td>6 TAD</td>
                <td>~3.25 Msps (@ TAD=307ns)</td>
            </tr>
            <tr>
                <td>8-bit</td>
                <td>8 TAD</td>
                <td>~2.4 Msps</td>
            </tr>
            <tr>
                <td>10-bit</td>
                <td>10 TAD</td>
                <td>~1.9 Msps</td>
            </tr>
            <tr>
                <td>12-bit</td>
                <td>12 TAD</td>
                <td>~1.6 Msps</td>
            </tr>
        </table>

        <div class="note">
            <strong>Performance Note:</strong> Total acquisition time = SAMC + Conversion Time. For maximum speed, use minimum SAMC that meets source impedance requirements.
        </div>

        <h3>Multi-Core Throughput</h3>
        <ul>
            <li><strong>Parallel operation:</strong> All dedicated cores can convert simultaneously</li>
            <li><strong>Aggregate throughput:</strong> Up to 6 cores × 1.6 Msps = 9.6 Msps total (PIC32MK)</li>
            <li><strong>ADC7 scan mode:</strong> Adds sequential throughput for auxiliary channels</li>
        </ul>

        <h2>Troubleshooting</h2>

        <h3>Common Issues</h3>

        <div class="warning">
            <strong>Issue:</strong> "This Chip does not support this ADC block"<br>
            <strong>Solution:</strong> Verify chip has high-speed SAR ADC module. Check if using correct block for chip family (HS SAR vs HS SAR dsPIC vs HS 12b).
        </div>

        <div class="warning">
            <strong>Issue:</strong> ADC7 inputs not visible in mask<br>
            <strong>Solution:</strong>
            <ul>
                <li>Ensure chip has ADC7 shared core capability</li>
                <li>Check that desired ANx pins exist on selected chip</li>
                <li>Verify ANx not already used by dedicated cores</li>
            </ul>
        </div>

        <div class="warning">
            <strong>Issue:</strong> Inaccurate conversion results with high-impedance source<br>
            <strong>Solution:</strong>
            <ul>
                <li>Increase ADC_R impedance selection</li>
                <li>Verify SAMC auto-calculation meets minimum for source impedance</li>
                <li>Consider using buffer amplifier for sources &gt;10kΩ</li>
            </ul>
        </div>

        <div class="warning">
            <strong>Issue:</strong> No trigger sources available in dropdown<br>
            <strong>Solution:</strong> Add PWM or Timer blocks with trigger output capability before configuring ADC block.
        </div>

        <h3>Device-Specific Notes</h3>
        <ul>
            <li><strong>PIC32MK:</strong> 6 dedicated cores (ADC0-5), full ADC7 scan capability, VBat/CTMU support</li>
            <li><strong>dsPIC33C (WACP):</strong> 3 dedicated cores (ADC0-2), reduced ADC7 options, VBat/CTMU support</li>
            <li><strong>dsPIC33C (Standard):</strong> 5 dedicated cores (ADC0-4), standard ADC7, no VBat/CTMU</li>
        </ul>

        <h2>Related Blocks</h2>
        <ul>
            <li><a href="adc_standard.html">MCHP_ADC</a> - Standard ADC for dsPIC30F/33F/33E</li>
            <li><a href="adc_hs_sar_dspic.html">MCHP_ADC_HighSpeed_SAR_dsPIC</a> - Alternative HS SAR for dsPIC33C</li>
            <li><a href="adc_hs_12b.html">MCHP_ADC_HS_12b</a> - 12-bit high-speed ADC for dsPIC33A</li>
            <li><a href="../pwm/pwm_hs_fep.html">MCHP_PWM_HS_FEP</a> - PWM with ADC trigger capability</li>
        </ul>

        <h2>See Also</h2>
        <p>
            <a href="../adc_blocks.html">ADC Blocks Overview</a> |
            <a href="../index.html">Block Reference</a> |
            <a href="../../motor_control_guide.html">Motor Control Application Guide</a>
        </p>

        <hr>
        <p style="font-size: 0.9em; color: #666;">
            <strong>MCHP Blockset Documentation</strong> |
            Last updated: 2025 |
            <a href="../../index.html">Documentation Home</a>
        </p>
    </div>
    </div>
</body>
</html>
